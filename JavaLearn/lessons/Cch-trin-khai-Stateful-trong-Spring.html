<html><head><title>C√°ch tri·ªÉn khai Stateful trong Spring</title></head><body><h1>C√°ch tri·ªÉn khai Stateful trong Spring</h1><pre>	Spring h·ªó tr·ª£ nhi·ªÅu c√°ch ƒë·ªÉ l∆∞u tr·ªØ tr·∫°ng th√°i, t√πy v√†o y√™u c·∫ßu c·ªßa h·ªá th·ªëng:

	## üîπ a) L∆∞u tr·ªØ tr·∫°ng th√°i trong Session (@SessionAttributes, HttpSession) 
			C√°ch n√†y gi√∫p gi·ªØ tr·∫°ng th√°i trong session c·ªßa ng∆∞·ªùi d√πng.
			S·ª≠ d·ª•ng @SessionAttributes ƒë·ªÉ l∆∞u d·ªØ li·ªáu gi·ªØa c√°c request c·ªßa m·ªôt user.


		@Controller
		@SessionAttributes("cart")
		public class CartController {
		
			@ModelAttribute("cart")
			public List<String> createCart() {
				return new ArrayList<>();
			}
		
			@PostMapping("/add")
			public String addToCart(@ModelAttribute("cart") List<String> cart, 
									@RequestParam String item) {
				cart.add(item);
				return "cartView";
			}
		}


			üí° Gi·∫£i th√≠ch:
			
			@SessionAttributes("cart") l∆∞u tr·∫°ng th√°i c·ªßa cart trong session c·ªßa user.
			Khi user th√™m s·∫£n ph·∫©m, gi·ªè h√†ng s·∫Ω gi·ªØ nguy√™n tr·∫°ng th√°i cho ƒë·∫øn khi session b·ªã h·ªßy.
			‚û° Nh∆∞·ª£c ƒëi·ªÉm: Kh√¥ng ph√π h·ª£p v·ªõi h·ªá th·ªëng c√≥ nhi·ªÅu server (horizontal scaling) v√¨ session l∆∞u tr√™n t·ª´ng server ri√™ng l·∫ª.






	## üîπ b) L∆∞u tr·∫°ng th√°i v·ªõi HttpSession (Th·ªß c√¥ng h∆°n, nh∆∞ng linh ho·∫°t h∆°n)
			@Controller
			public class SessionController {
			
				@GetMapping("/setSession")
				public String setSession(HttpSession session) {
					session.setAttribute("username", "User123");
					return "sessionView";
				}
			
				@GetMapping("/getSession")
				@ResponseBody
				public String getSession(HttpSession session) {
					return "Hello, " + session.getAttribute("username");
				}
			}

			
					üí° Gi·∫£i th√≠ch:
					
					session.setAttribute("username", "User123") l∆∞u gi√° tr·ªã trong session.
					Khi g·ªçi /getSession, n√≥ l·∫•y l·∫°i gi√° tr·ªã username.
					Ph√π h·ª£p v·ªõi c√°c h·ªá th·ªëng c·∫ßn l∆∞u d·ªØ li·ªáu t·∫°m th·ªùi cho user ƒëƒÉng nh·∫≠p.




	## üîπ c) L∆∞u tr·∫°ng th√°i b·∫±ng Stateful Bean (@Scope("session") ho·∫∑c @Scope("prototype"))
	Spring h·ªó tr·ª£ Bean c√≥ tr·∫°ng th√°i th√¥ng qua scope:
	

		Scope						M√¥ t·∫£
		singleton				Ch·ªâ c√≥ m·ªôt instance duy nh·∫•t trong to√†n b·ªô ·ª©ng d·ª•ng (Stateless).
		prototype				M·ªói request t·∫°o m·ªôt instance m·ªõi (Stateful).
		session					M·ªôt instance duy tr√¨ trong su·ªët phi√™n l√†m vi·ªác c·ªßa user (Stateful).
		request					M·ªôt instance t·ªìn t·∫°i trong m·ªôt HTTP request (Stateless).



		### V√≠ d·ª•: L∆∞u tr·∫°ng th√°i trong session b·∫±ng @SessionScope 

		@Component
		@SessionScope
		public class UserSession {
			private String username;
		
			public String getUsername() {
				return username;
			}
		
			public void setUsername(String username) {
				this.username = username;
			}
		}
		

		### Controller s·ª≠ d·ª•ng Stateful Bean
		
		@Controller
		public class UserController {
		
			private final UserSession userSession;
		
			public UserController(UserSession userSession) {
				this.userSession = userSession;
			}
		
			@GetMapping("/setUser")
			public String setUser(@RequestParam String name) {
				userSession.setUsername(name);
				return "userView";
			}
		
			@GetMapping("/getUser")
			@ResponseBody
			public String getUser() {
				return "User: " + userSession.getUsername();
			}
		}
				

			@Controller
			public class UserController {
			
				private final UserSession userSession;
			
				public UserController(UserSession userSession) {
					this.userSession = userSession;
				}
			
				@GetMapping("/setUser")
				public String setUser(@RequestParam String name) {
					userSession.setUsername(name);
					return "userView";
				}
			
				@GetMapping("/getUser")
				@ResponseBody
				public String getUser() {
					return "User: " + userSession.getUsername();
				}
			}




	##  üîπ d) L∆∞u tr·∫°ng th√°i v·ªõi Redis (H·ªó tr·ª£ Scaling t·ªët h∆°n) 
		Khi ch·∫°y h·ªá th·ªëng tr√™n nhi·ªÅu server (distributed system), s·ª≠ d·ª•ng session s·∫Ω g√¢y l·ªói v√¨ m·ªói server c√≥ session ri√™ng. ƒê·ªÉ gi·∫£i quy·∫øt, ta d√πng Redis ƒë·ªÉ l∆∞u session.
		
			
	### C·∫•u h√¨nh Redis Session trong application.properties	
		spring.session.store-type=redis
		spring.redis.host=localhost
		spring.redis.port=6379


	### Controller s·ª≠ d·ª•ng Redis Session 
		@RestController
		@RequestMapping("/session")
		public class RedisSessionController {
		
			@GetMapping("/set")
			public String setSession(HttpSession session) {
				session.setAttribute("message", "Hello from Redis");
				return "Session set!";
			}
		
			@GetMapping("/get")
			public String getSession(HttpSession session) {
				return (String) session.getAttribute("message");
			}
		}
		üí° Gi·∫£i th√≠ch:
		D·ªØ li·ªáu session ƒë∆∞·ª£c l∆∞u v√†o Redis, gi√∫p c√≥ th·ªÉ scale ngang h·ªá th·ªëng m√† v·∫´n gi·ªØ session.



</pre></body></html>