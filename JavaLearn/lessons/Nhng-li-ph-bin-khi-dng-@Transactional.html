<html><head><title>Nhá»¯ng lá»—i phá»• biáº¿n khi dÃ¹ng @Transactional</title></head><body><h1>Nhá»¯ng lá»—i phá»• biáº¿n khi dÃ¹ng @Transactional</h1><pre>
	## âŒ 2.1. Gá»i @Transactional tá»« chÃ­nh class cá»§a nÃ³ 
		Spring dÃ¹ng proxy Ä‘á»ƒ quáº£n lÃ½ @Transactional. Náº¿u báº¡n gá»i method tá»« cÃ¹ng má»™t class, transaction sáº½ khÃ´ng hoáº¡t Ä‘á»™ng 
		
			### âš  Sai cÃ¡ch

				@Service
				public class UserService {
					@Transactional
					public void createUser(User user) {
						userRepository.save(user);
					}
				
					public void registerUser(User user) {
						createUser(user); // âŒ Gá»i tá»« chÃ­nh class -> Transaction khÃ´ng hoáº¡t Ä‘á»™ng!
					}
				}



			### âœ… ÄÃºng cÃ¡ch
				- Gá»i tá»« class khÃ¡c hoáº·c dÃ¹ng @Autowired chÃ­nh class cá»§a nÃ³ 
				
						@Service
						public class UserService {
							@Autowired
							private UserService self; // Inject chÃ­nh nÃ³
						
							@Transactional
							public void createUser(User user) {
								userRepository.save(user);
							}
						
							public void registerUser(User user) {
								self.createUser(user); // âœ… Transaction hoáº¡t Ä‘á»™ng
							}
						}



			### ğŸ’¡ CÃ¡ch tá»‘t hÆ¡n: TÃ¡ch thÃ nh má»™t service khÃ¡c. 
			
			
						@Service
						public class UserTransactionService {
							@Transactional
							public void createUser(User user) {
								userRepository.save(user);
							}
						}
						
						
						
						@Service
						public class UserService {
							@Autowired
							private UserTransactionService userTransactionService;
						
							public void registerUser(User user) {
								userTransactionService.createUser(user); // âœ… Transaction hoáº¡t Ä‘á»™ng
							}
						}





	## âŒ 2.2. KhÃ´ng Ä‘áº·t @Transactional á»Ÿ má»©c public 
		Spring chá»‰ Ã¡p dá»¥ng transactional trÃªn cÃ¡c method public. Náº¿u dÃ¹ng private hoáº·c protected, transaction khÃ´ng cÃ³ hiá»‡u lá»±c 
			
			
			### âš  Sai cÃ¡ch 
			
			
					@Service
					public class UserService {
						@Transactional
						private void createUser(User user) { // âŒ KhÃ´ng hoáº¡t Ä‘á»™ng vÃ¬ khÃ´ng pháº£i public
							userRepository.save(user);
						}
					}

			### âœ… CÃ¡ch Ä‘Ãºng 
			
					@Service
					public class UserService {
						@Transactional
						public void createUser(User user) { // âœ… Báº¯t buá»™c pháº£i lÃ  public
							userRepository.save(user);
						}
					}

				


	## âŒ 2.3. Chá»‰ RuntimeException má»›i kÃ­ch hoáº¡t rollback 
	
		Máº·c Ä‘á»‹nh, @Transactional chá»‰ rollback khi gáº·p RuntimeException hoáº·c Error. Náº¿u method nÃ©m Checked Exception , nÃ³ sáº½ khÃ´ng rollback 
		
		
			### âš  Sai cÃ¡ch
				

					@Service
					public class UserService {
						@Transactional
						public void createUser(User user) throws Exception { 
							userRepository.save(user);
							throw new Exception("Checked Exception xáº£y ra"); // âŒ KhÃ´ng rollback!
						}
					}

			### âœ… CÃ¡ch Ä‘Ãºng 
				Cáº¥u hÃ¬nh @Transactional(rollbackFor = Exception.class):
				
					@Service
					public class UserService {
						@Transactional(rollbackFor = Exception.class)
						public void createUser(User user) throws Exception {
							userRepository.save(user);
							throw new Exception("Checked Exception xáº£y ra"); // âœ… Rollback hoáº¡t Ä‘á»™ng
						}
					}
					


	## âŒ 2.4. KhÃ´ng Ä‘áº·t @Transactional Ä‘Ãºng chá»—
		
		### âš  Sai: Äáº·t trÃªn Controller 
			
				@RestController
				@RequestMapping("/users")
				public class UserController {
					@Transactional // âŒ Sai! KhÃ´ng nÃªn Ä‘áº·t á»Ÿ Controller
					@PostMapping
					public void createUser(@RequestBody User user) {
						userService.createUser(user);
					}
				}

		
		### âœ… ÄÃºng: Äáº·t trÃªn Service
		
				@Service
				public class UserService {
					@Transactional // âœ… Äáº·t á»Ÿ Service
					public void createUser(User user) {
						userRepository.save(user);
					}
				}



</pre></body></html>