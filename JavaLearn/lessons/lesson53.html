<html><head><title>Lession 53  ThreadLocal & Stateless Servlet //</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px; white-space: pre-wrap; transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 3em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 2em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../java-learning-list.html'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><h1>Lession 53  ThreadLocal & Stateless Servlet //</h1><pre>
# KhÃ¡i niá»‡m 
	Trong thiáº¿t káº¿ há»‡ thá»‘ng hiá»‡u suáº¥t cao, viá»‡c quáº£n lÃ½ dá»¯ liá»‡u thread-safe mÃ  váº«n Ä‘áº£m báº£o hiá»‡u suáº¥t tá»‘t lÃ  má»™t bÃ i toÃ¡n quan trá»ng. ThreadLocal vÃ  Stateless Servlet lÃ  hai cÃ¡ch phá»• biáº¿n giÃºp giáº£i quyáº¿t váº¥n Ä‘á» nÃ y. 
	
//------------------ ThreadLocal - Quáº£n lÃ½ biáº¿n theo tá»«ng thread 

# ğŸ”¹ KhÃ¡i niá»‡m  
		ThreadLocal<T> lÃ  má»™t biáº¿n cá»¥c bá»™ theo thread, cÃ³ nghÄ©a lÃ  má»—i thread cÃ³ má»™t báº£n sao riÃªng biá»‡t cá»§a biáº¿n Ä‘Ã³. NÃ³ giÃºp lÆ°u dá»¯ liá»‡u Ä‘á»™c láº­p cho tá»«ng thread, trÃ¡nh tÃ¬nh tráº¡ng race condition trong mÃ´i trÆ°á»ng Ä‘a luá»“ng
		
# ğŸ”¹ á»¨ng dá»¥ng chÃ­nh cá»§a ThreadLocal : 
		- LÆ°u thÃ´ng tin request, user session, transaction trong Ä‘a luá»“ng 
		- Táº¡o má»™t bá»™ nhá»› cache cá»¥c bá»™ theo tá»«ng thread 
		- Quáº£n lÃ½ context nhÆ° database connection hoáº·c Spring Security Context 
		
# 	ğŸ”¹ CÃ¡ch sá»­ dá»¥ng ThreadLocal 

		## ğŸ“Œ DÃ¹ng ThreadLocal Ä‘á»ƒ lÆ°u biáº¿n user cho tá»«ng request

			public class UserContext {
				private static final ThreadLocal<String> currentUser = ThreadLocal.withInitial(() -> "Guest");
			
				public static void setUser(String user) {
					currentUser.set(user);
				}
			
				public static String getUser() {
					return currentUser.get();
				}
			
				public static void clear() {
					currentUser.remove(); // Giáº£i phÃ³ng tÃ i nguyÃªn trÃ¡nh memory leak
				}
			}


		## ğŸ“Œ CÃ¡ch sá»­ dá»¥ng ThreadLocal trong servlet 
			@WebServlet("/threadlocal")
			public class ThreadLocalServlet extends HttpServlet {
				protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
					String user = req.getParameter("user");
					UserContext.setUser(user); // LÆ°u user vÃ o ThreadLocal
			
					resp.getWriter().println("Current User: " + UserContext.getUser());
			
					UserContext.clear(); // XÃ³a sau khi dÃ¹ng Ä‘á»ƒ trÃ¡nh memory leak
				}
			}
			

# âœ… Lá»£i Ã­ch: 
		Má»—i thread cÃ³ má»™t biáº¿n (curentUser) riÃªng, trÃ¡nh lá»—i race condition . 
		KhÃ´ng cáº§n Ä‘á»“ng bá»™ hÃ³a(synchronized), giÃºp cáº£i thiá»‡n hiá»‡u suáº¥t . 


# âš  LÆ°u Ã½ quan trá»ng 
		- Nhá»› gá»i remove() sau khi sá»­ dá»¥ng ! Náº¿u khÃ´ng, dá»¯ liá»‡u cá»§a thread cÅ© cÃ³ thá»ƒ bá»‹ tÃ¡i sá»­ dá»¥ng trong thread pool, gÃ¢y lá»—i báº£o máº­t 
		- KhÃ´ng sá»­ dá»¥ng trong á»©ng dá»¥ng cÃ³ nhiá»u táº§ng (distributed system), vÃ¬ ThreadLocal chá»‰ hoáº¡t Ä‘á»™ng trong JVM 
		
		

# ğŸ”¹ á»¨ng dá»¥ng thá»±c táº¿ cá»§a ThreadLocal 
	
	## Quáº£n lÃ½ Transactional trong JDBC 
		public class ConnectionManager {
			private static final ThreadLocal<Connection> connectionHolder = new ThreadLocal<>();
		
			public static void setConnection(Connection conn) {
				connectionHolder.set(conn);
			}
		
			public static Connection getConnection() {
				return connectionHolder.get();
			}
		
			public static void clear() {
				connectionHolder.remove();
			}
		}
		
		ğŸ”¥ Trong há»‡ thá»‘ng thá»±c táº¿, Spring Ä‘Ã£ tÃ­ch há»£p ThreadLocal Ä‘á»ƒ quáº£n lÃ½ transaction trong Hibernate.	



//------------------ @Transactional thá»±c sá»± lÃ m gÃ¬ 
	
# KhÃ¡i niá»‡m 
	Khi báº¡n gáº¯n @Transactional vÃ o má»™t method hoáº·c class trong Spring:
	âœ… Spring báº¯t Ä‘áº§u má»™t transaction trÆ°á»›c khi method cháº¡y.
	âœ… Náº¿u method cháº¡y thÃ nh cÃ´ng, transaction sáº½ commit (lÆ°u thay Ä‘á»•i vÃ o DB).
	âœ… Náº¿u method gáº·p lá»—i (throw Exception), transaction sáº½ rollback (há»§y bá» thay Ä‘á»•i).


# VÃ­ dá»¥ cÆ¡ báº£n 
	
		@Service
		public class UserService {
			@Transactional
			public void createUser(User user) {
				userRepository.save(user); // LÆ°u vÃ o DB
				sendEmail(user.getEmail()); // Náº¿u lá»—i á»Ÿ Ä‘Ã¢y, transaction sáº½ rollback
			}
		}
			
		â¡ Náº¿u sendEmail() nÃ©m lá»—i (Exception), userRepository.save(user) cÅ©ng bá»‹ rollback, tá»©c lÃ  dá»¯ liá»‡u sáº½ khÃ´ng lÆ°u vÃ o DB.



# Nhá»¯ng lá»—i phá»• biáº¿n khi dÃ¹ng @Transactional

	## âŒ 2.1. Gá»i @Transactional tá»« chÃ­nh class cá»§a nÃ³ 
		Spring dÃ¹ng proxy Ä‘á»ƒ quáº£n lÃ½ @Transactional. Náº¿u báº¡n gá»i method tá»« cÃ¹ng má»™t class, transaction sáº½ khÃ´ng hoáº¡t Ä‘á»™ng 
		
			### âš  Sai cÃ¡ch

				@Service
				public class UserService {
					@Transactional
					public void createUser(User user) {
						userRepository.save(user);
					}
				
					public void registerUser(User user) {
						createUser(user); // âŒ Gá»i tá»« chÃ­nh class -> Transaction khÃ´ng hoáº¡t Ä‘á»™ng!
					}
				}



			### âœ… ÄÃºng cÃ¡ch
				- Gá»i tá»« class khÃ¡c hoáº·c dÃ¹ng @Autowired chÃ­nh class cá»§a nÃ³ 
				
						@Service
						public class UserService {
							@Autowired
							private UserService self; // Inject chÃ­nh nÃ³
						
							@Transactional
							public void createUser(User user) {
								userRepository.save(user);
							}
						
							public void registerUser(User user) {
								self.createUser(user); // âœ… Transaction hoáº¡t Ä‘á»™ng
							}
						}



			### ğŸ’¡ CÃ¡ch tá»‘t hÆ¡n: TÃ¡ch thÃ nh má»™t service khÃ¡c. 
			
			
						@Service
						public class UserTransactionService {
							@Transactional
							public void createUser(User user) {
								userRepository.save(user);
							}
						}
						
						
						
						@Service
						public class UserService {
							@Autowired
							private UserTransactionService userTransactionService;
						
							public void registerUser(User user) {
								userTransactionService.createUser(user); // âœ… Transaction hoáº¡t Ä‘á»™ng
							}
						}





	## âŒ 2.2. KhÃ´ng Ä‘áº·t @Transactional á»Ÿ má»©c public 
		Spring chá»‰ Ã¡p dá»¥ng transactional trÃªn cÃ¡c method public. Náº¿u dÃ¹ng private hoáº·c protected, transaction khÃ´ng cÃ³ hiá»‡u lá»±c 
			
			
			### âš  Sai cÃ¡ch 
			
			
					@Service
					public class UserService {
						@Transactional
						private void createUser(User user) { // âŒ KhÃ´ng hoáº¡t Ä‘á»™ng vÃ¬ khÃ´ng pháº£i public
							userRepository.save(user);
						}
					}

			### âœ… CÃ¡ch Ä‘Ãºng 
			
					@Service
					public class UserService {
						@Transactional
						public void createUser(User user) { // âœ… Báº¯t buá»™c pháº£i lÃ  public
							userRepository.save(user);
						}
					}

				


	## âŒ 2.3. Chá»‰ RuntimeException má»›i kÃ­ch hoáº¡t rollback 
	
		Máº·c Ä‘á»‹nh, @Transactional chá»‰ rollback khi gáº·p RuntimeException hoáº·c Error. Náº¿u method nÃ©m Checked Exception , nÃ³ sáº½ khÃ´ng rollback 
		
		
			### âš  Sai cÃ¡ch
				

					@Service
					public class UserService {
						@Transactional
						public void createUser(User user) throws Exception { 
							userRepository.save(user);
							throw new Exception("Checked Exception xáº£y ra"); // âŒ KhÃ´ng rollback!
						}
					}

			### âœ… CÃ¡ch Ä‘Ãºng 
				Cáº¥u hÃ¬nh @Transactional(rollbackFor = Exception.class):
				
					@Service
					public class UserService {
						@Transactional(rollbackFor = Exception.class)
						public void createUser(User user) throws Exception {
							userRepository.save(user);
							throw new Exception("Checked Exception xáº£y ra"); // âœ… Rollback hoáº¡t Ä‘á»™ng
						}
					}
					


	## âŒ 2.4. KhÃ´ng Ä‘áº·t @Transactional Ä‘Ãºng chá»—
		
		### âš  Sai: Äáº·t trÃªn Controller 
			
				@RestController
				@RequestMapping("/users")
				public class UserController {
					@Transactional // âŒ Sai! KhÃ´ng nÃªn Ä‘áº·t á»Ÿ Controller
					@PostMapping
					public void createUser(@RequestBody User user) {
						userService.createUser(user);
					}
				}

		
		### âœ… ÄÃºng: Äáº·t trÃªn Service
		
				@Service
				public class UserService {
					@Transactional // âœ… Äáº·t á»Ÿ Service
					public void createUser(User user) {
						userRepository.save(user);
					}
				}



# CÃ¡c má»©c cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a Transactional 
		
		
		Má»©c Ä‘á»™ Isolation					MÃ´ táº£
		DEFAULT						DÃ¹ng má»©c cá»§a DB (thÆ°á»ng lÃ  READ COMMITTED).
		READ UNCOMMITTED			Tháº¥p nháº¥t, Ä‘á»c dá»¯ liá»‡u chÆ°a commit (dá»… bá»‹ lá»—i Dirty Read).
		READ COMMITTED				Chá»‰ Ä‘á»c dá»¯ liá»‡u Ä‘Ã£ commit (trÃ¡nh Dirty Read).
		REPEATABLE READ				Äá»c dá»¯ liá»‡u giá»‘ng nhau trong cÃ¹ng má»™t transaction (trÃ¡nh Phantom Read).
		SERIALIZABLE				Cao nháº¥t, Ä‘áº£m báº£o khÃ´ng cÃ³ xung Ä‘á»™t dá»¯ liá»‡u.




		### ğŸ“Œ VÃ­ dá»¥: Cáº¥u hÃ¬nh Isolation Level 
		
		
			@Transactional(isolation = Isolation.REPEATABLE_READ)
			public void updateUserBalance(Long userId, BigDecimal amount) {
				User user = userRepository.findById(userId).orElseThrow();
				user.setBalance(user.getBalance().add(amount));
				userRepository.save(user);
			}


# Káº¿t luáº­n : DÃ¹ng @Transactional tháº¿ nÃ o cho Ä‘Ãºng ? 
	
		âœ… LuÃ´n Ä‘áº·t @Transactional á»Ÿ Service, khÃ´ng Ä‘áº·t á»Ÿ Controller.
		âœ… KhÃ´ng gá»i method @Transactional tá»« chÃ­nh class cá»§a nÃ³.
		âœ… Chá»‰ rollback vá»›i RuntimeException, náº¿u muá»‘n rollback Exception thÃ¬ pháº£i dÃ¹ng rollbackFor = Exception.class.
		âœ… Nhá»› Ä‘áº·t method lÃ  public, vÃ¬ Spring chá»‰ quáº£n lÃ½ giao dá»‹ch trÃªn method public.
		âœ… Cáº©n tháº­n vá»›i thread pool, async hoáº·c cÃ¡c method cháº¡y song song, vÃ¬ @Transactional chá»‰ hoáº¡t Ä‘á»™ng trong cÃ¹ng má»™t thread.





//----------------------- Stateless Servlet -  Kiáº¿n trÃºc khÃ´ng lÆ°u tráº¡ng thÃ¡i 

# KhÃ¡i niá»‡m 
	ğŸ”¹ Stateless Servlet lÃ  gÃ¬? 
		Trong thiáº¿t káº¿ web hiá»‡n Ä‘áº¡i, Stateless Servlet lÃ  má»™t servlet khÃ´ng lÆ°u tráº¡ng thÃ¡i trÃªn instance, nghÄ©a lÃ : 
			- KhÃ´ng lÆ°u biáº¿n instance(private int counter;) Ä‘á»ƒ trÃ¡nh lá»—i Ä‘á»“ng bá»™ hÃ³a.
			- Dá»¯ liá»‡u request Ä‘áº¿n vÃ  Ä‘i má»™t cÃ¡ch Ä‘á»™c láº­p, khÃ´ng phá»¥ thuá»™c vÃ o tráº¡ng thÃ¡i cÅ©. 
			
	ğŸ’¡ á»¨ng dá»¥ng chÃ­nh cá»§a Stateless Servlet 
		XÃ¢y dá»±ng RESTful API.
		Thiáº¿t káº¿ há»‡ thá»‘ng má»Ÿ rá»™ng dá»… dÃ ng (scalable)
		TÃ­ch há»£p vá»›i microservices Ä‘á»ƒ giáº£m phá»¥ thuá»™c 

	
# CÃ¡ch triá»ƒn khai State Servlet 
	
	###ğŸ“Œ VÃ­ dá»¥ 1: Stateless Servlet chá»‰ xá»­ lÃ½ request mÃ  khÃ´ng lÆ°u tráº¡ng thÃ¡i  
	
			@WebServlet("/stateless")
			public class StatelessServlet extends HttpServlet {
				protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
					String user = req.getParameter("user");
					resp.getWriter().println("Hello, " + user);
				}
			}


		ğŸ”¥ Æ¯u Ä‘iá»ƒm cá»§a Stateless Servlet:
		âœ” KhÃ´ng lÆ°u biáº¿n instance â†’ KhÃ´ng cáº§n Ä‘á»“ng bá»™ hÃ³a.
		âœ” Dá»… má»Ÿ rá»™ng, phÃ¹ há»£p vá»›i microservices, cloud-based.
		âœ” TÄƒng hiá»‡u suáº¥t, giáº£m tÃ i nguyÃªn bá»™ nhá»›.


	### ğŸ“Œ VÃ­ dá»¥ 2: Stateless Servlet xá»­ lÃ½ tÃ­nh toÃ¡n nhÆ°ng khÃ´ng giá»¯ tráº¡ng thÃ¡i 
	
			@WebServlet("/calculate")
			public class CalculationServlet extends HttpServlet {
				protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
					int a = Integer.parseInt(req.getParameter("a"));
					int b = Integer.parseInt(req.getParameter("b"));
					int sum = a + b;
					
					resp.getWriter().println("Sum: " + sum);
				}
			}

		ğŸš€ Äiá»ƒm máº¡nh:

		Dá»¯ liá»‡u Ä‘Æ°á»£c truyá»n qua request, khÃ´ng lÆ°u trÃªn server.
		CÃ³ thá»ƒ scale out dá»… dÃ ng báº±ng load balancer.



# Stateless Servlet trong Java EE 
	
Trong Java EE truyá»n thá»‘ng, báº¡n cÃ³ thá»ƒ táº¡o má»™t Stateless Servlet báº±ng cÃ¡ch sá»­ dá»¥ng @WebServlet. VÃ­ dá»¥:

		@WebServlet("/stateless")
		public class StatelessServlet extends HttpServlet {
		
			private static final long serialVersionUID = 1L;
		
			@Override
			protected void doGet(HttpServletRequest request, HttpServletResponse response)
					throws ServletException, IOException {
				response.getWriter().write("Hello from Stateless Servlet");
			}
		}

	## Äiá»ƒm chÃ­nh cá»§a Stateless Servlet 
		
			- KhÃ´ng lÆ°u tráº¡ng thÃ¡i giá»¯a cÃ¡c request.
			- Má»—i request Ä‘Æ°á»£c xá»­ lÃ½ Ä‘á»™c láº­p, khÃ´ng cÃ³ session hoáº·c dá»¯ liá»‡u cá»¥c bá»™ (instance variables).
			- CÃ³ thá»ƒ má»Ÿ rá»™ng dá»… dÃ ng mÃ  khÃ´ng lo váº¥n Ä‘á» Ä‘á»“ng bá»™ dá»¯ liá»‡u giá»¯a cÃ¡c thread.





# Stateless Servlet trong Spring 
	Trong Spring, báº¡n khÃ´ng cáº§n dÃ¹ng Servlet trá»±c tiáº¿p mÃ  thay tháº¿ báº±ng Spring Controller, vÃ¬ Spring Boot sá»­ dá»¥ng DispatcherServlet Ä‘á»ƒ xá»­ lÃ½ request.
	
			@RestController
			@RequestMapping("/stateless")
			public class StatelessController {
			
				@GetMapping
				public String statelessResponse() {
					return "Hello from Stateless Controller";
				}
			}

	# ğŸ”¹ KhÃ¡c biá»‡t giá»¯a Stateless Servlet vÃ  Spring Controller 
	
	
	Feature				Stateless Servlet (Java EE)								Spring Controller
	Triá»ƒn khai				Káº¿ thá»«a HttpServlet										DÃ¹ng @RestController
	Xá»­ lÃ½ request			DÃ¹ng doGet(), doPost()									DÃ¹ng @GetMapping, @PostMapping
	Cáº¥u hÃ¬nh				web.xml hoáº·c @WebServlet								Spring Boot tá»± Ä‘á»™ng cáº¥u hÃ¬nh
	Quáº£n lÃ½ lifecycle		Java EE container quáº£n lÃ½								Spring container quáº£n lÃ½

	
	
# 	Stateless vs Stateful trong Spring 
	
	
	## Stateless (KhÃ´ng cÃ³ tráº¡ng thÃ¡i)
		
		- Má»—i request Ä‘Æ°á»£c xá»­ lÃ½ Ä‘á»™c láº­p.
		
		- KhÃ´ng giá»¯ dá»¯ liá»‡u giá»¯a cÃ¡c request (VD: khÃ´ng dÃ¹ng instance variables).
		
		- Dá»… dÃ ng scale vÃ¬ khÃ´ng cÃ³ tráº¡ng thÃ¡i cáº§n Ä‘á»“ng bá»™.
		
		
		
	## Stateful (CÃ³ tráº¡ng thÃ¡i) 
		
		- Giá»¯ dá»¯ liá»‡u giá»¯a cÃ¡c request báº±ng session hoáº·c shared state.
		
		- Cáº§n cÆ¡ cháº¿ Ä‘á»“ng bá»™ náº¿u cháº¡y trÃªn nhiá»u instance.
	
	
	
	
	## VÃ­ dá»¥ vá» Stateful Bean (KhÃ´ng pháº£i Stateless!) 
	
		@RestController
		@RequestMapping("/stateful")
		@SessionScope  // âš ï¸ LÆ°u tráº¡ng thÃ¡i trÃªn session (Stateful)
		public class StatefulController {
			private int counter = 0; // âš ï¸ LÆ°u dá»¯ liá»‡u giá»¯a cÃ¡c request
		
			@GetMapping
			public String statefulResponse() {
				counter++;
				return "Request count: " + counter;
			}
		}
		â¡ Má»—i request sáº½ tÄƒng giÃ¡ trá»‹ counter, nghÄ©a lÃ  servlet nÃ y cÃ³ tráº¡ng thÃ¡i.
	
	
	
âœ” Náº¿u há»‡ thá»‘ng cáº§n hiá»‡u nÄƒng cao, dá»… scale, thÃ¬ nÃªn dÃ¹ng stateless (@RestController).
âœ” Náº¿u cáº§n giá»¯ tráº¡ng thÃ¡i giá»¯a cÃ¡c request (VD: shopping cart), thÃ¬ cÃ³ thá»ƒ dÃ¹ng stateful, nhÆ°ng cáº§n cÃ¢n nháº¯c vá» Ä‘á»“ng bá»™ dá»¯ liá»‡u.

ğŸ‘‰ TÃ³m láº¡i: Trong Spring, khÃ´ng cáº§n dÃ¹ng @WebServlet, thay vÃ o Ä‘Ã³, dÃ¹ng @RestController vÃ  giá»¯ kiáº¿n trÃºc stateless cho há»‡ thá»‘ng linh hoáº¡t hÆ¡n. ğŸš€	




# 3. So sÃ¡nh ThreadLocal vÃ  Stateless Servlet 


	ğŸ”¥ TiÃªu chÃ­							ğŸ† ThreadLocal												ğŸš€ Stateless Servlet
	LÆ°u tráº¡ng thÃ¡i		âœ… CÃ³ (cho tá»«ng thread)													âŒ KhÃ´ng lÆ°u tráº¡ng thÃ¡i
	Thread safety		âœ… An toÃ n (vÃ¬ má»—i thread cÃ³ má»™t báº£n sao riÃªng)							âœ… An toÃ n (vÃ¬ khÃ´ng lÆ°u biáº¿n instance)
	á»¨ng dá»¥ng chÃ­nh		LÆ°u thÃ´ng tin user session, transaction, DB connection					REST API, microservices, scalable system
	Hiá»‡u suáº¥t			âš¡ Cao (vÃ¬ khÃ´ng cáº§n synchronized) nhÆ°ng cÃ³ nguy cÆ¡ memory leak			âš¡ Cao (vÃ¬ khÃ´ng lÆ°u tráº¡ng thÃ¡i)
	Kháº£ nÄƒng má»Ÿ rá»™ng	âŒ KhÃ´ng tá»‘t (chá»‰ hoáº¡t Ä‘á»™ng trong pháº¡m vi JVM)							âœ… Tá»‘t, dá»… scale
	Báº£o máº­t				âŒ Náº¿u khÃ´ng remove(), cÃ³ thá»ƒ bá»‹ rÃ² rá»‰ dá»¯ liá»‡u giá»¯a cÃ¡c request			âœ… Báº£o máº­t tá»‘t, khÃ´ng lÆ°u dá»¯ liá»‡u dÃ i háº¡n



# Khi nÃ o dÃ¹ng ThreadLocal & Stateless Servlet?
 


ğŸš€ TÃ¬nh huá»‘ng						âœ… NÃªn dÃ¹ng ThreadLocal															âœ… NÃªn dÃ¹ng Stateless Servlet
LÆ°u dá»¯ liá»‡u theo request		Náº¿u cáº§n giá»¯ biáº¿n trong cÃ¹ng má»™t thread (VD: User Session, Transaction).			Náº¿u chá»‰ cáº§n xá»­ lÃ½ request Ä‘á»™c láº­p, khÃ´ng giá»¯ tráº¡ng thÃ¡i.
á»¨ng dá»¥ng REST API				âŒ KhÃ´ng phÃ¹ há»£p																âœ… Cá»±c ká»³ phÃ¹ há»£p
á»¨ng dá»¥ng Microservices			âŒ KhÃ´ng phÃ¹ há»£p (ThreadLocal chá»‰ hoáº¡t Ä‘á»™ng trong JVM)							âœ… Ráº¥t phÃ¹ há»£p
Giao dá»‹ch database				âœ… DÃ¹ng Ä‘á»ƒ quáº£n lÃ½ transaction trong JDBC										âŒ KhÃ´ng phÃ¹ há»£p
Há»‡ thá»‘ng scale lá»›n				âŒ KhÃ´ng má»Ÿ rá»™ng tá»‘t															âœ… Ráº¥t dá»… scale
	



# ğŸ”¥ Káº¿t luáº­n 

- Náº¿u cáº§n lÆ°u dá»¯ liá»‡u trong tá»«ng thread, hÃ£y dÃ¹ng ThreadLocal.
- Náº¿u muá»‘n há»‡ thá»‘ng dá»… scale, tá»‘i Æ°u REST API hoáº·c microservices, hÃ£y dÃ¹ng Stateless Servlet.






//-------------------- @Controller vÃ  @RestController 


Annotation							MÃ´ táº£
@RestController				Tráº£ vá» dá»¯ liá»‡u JSON/XML (RESTful API)
@Controller					Tráº£ vá» View (thÆ°á»ng dÃ¹ng vá»›i JSP, Thymeleaf)


</pre><a id='backBottom' href='../java-learning-list.html' style='display:none;'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><button onclick='toggleTheme()'>ğŸŒ™ Chuyá»ƒn giao diá»‡n</button></div><script>function toggleTheme() {let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';document.body.className = mode; localStorage.setItem('theme', mode);syncTheme();}function applyTheme() {let savedTheme = localStorage.getItem('theme') || 'dark-mode';document.body.className = savedTheme;syncTheme();}function syncTheme() {let preElement = document.querySelector('pre');if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {let contentHeight = document.body.scrollHeight;let windowHeight = window.innerHeight;if (contentHeight > windowHeight * 1.2) {document.getElementById('backBottom').style.display = 'block';} else {document.getElementById('backBottom').style.display = 'none';}}</script></body></html>