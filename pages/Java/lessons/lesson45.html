<html><head><title>Lesson 45 == CopyOnWriteArrayList ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../java-learning-list.html'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><h1>Lesson 45 -- CopyOnWriteArrayList -//</h1><pre># KhÃ¡i niá»‡m  
	CopyOnWriteArrayList lÃ  má»™t trong nhá»¯ng Implementations cá»§a List trong Java, Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘áº·c biá»‡t Ä‘á»ƒ há»— trá»£ thao tÃ¡c an toÃ n trong mÃ´i trÆ°á»ng Ä‘a luá»“ng (multi-threadeding) mÃ  khÃ´ng cáº§n sá»­ dá»¥ng cÆ¡ cháº¿ synchronization phá»©c táº¡p. 
	
# Äáº·c Ä‘iá»ƒm chÃ­nh cá»§a CopyOnWriteArrayList 
	## Dá»¯ liá»‡u Ä‘Æ°á»£c sao chÃ©p khi cÃ³ thao tÃ¡c ghi(write)
		- Má»—i khi má»—i pháº§n tá»­ Ä‘Æ°á»£c thÃªm, sá»­a , hoáº·c xÃ³a, má»™t báº£n sao má»›i cá»§a danh sÃ¡ch array sáº½ Ä‘Æ°á»£c táº¡o ra 
		- Äiá»u nÃ y giÃºp Ä‘áº£m báº£o ráº±ng cÃ¡c luá»“ng Ä‘á»c(read operations) váº«n cÃ³ thá»ƒ cháº¡y mÃ  khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng bá»Ÿi luá»“ng ghi(write operations)
		
	## KhÃ´ng cáº§n Ä‘á»“ng bá»™ hÃ³a thá»§ cÃ´ng(synchronized)	 
		Do cÆ¡ cháº¿ copy-on-write, cÃ¡c thao tÃ¡c Ä‘á»™c khÃ´ng cáº§n dÃ¹ng Ä‘áº¿n khÃ³a(lock), trÃ¡nh Ä‘Æ°á»£c váº¥n Ä‘á» deadlock vÃ  perfomance bottleneck trong mÃ´i trÆ°á»ng Ä‘a luá»“ng. 
		
	## Chi phÃ­ cao khi ghi(write operations Ä‘áº¯t Ä‘á»)
		VÃ¬ má»—i láº§n thay Ä‘á»•i danh sÃ¡ch(add, set, remove()) Ä‘á»u táº¡o  ra má»™t báº£n sao má»›i, nÃªn nÃ³ khÃ´ng phÃ¹ há»£p khi cÃ³ nhiá»u thao tÃ¡c ghi 
		
	## Duyá»‡t pháº§n tá»­ an toÃ n mÃ  khÃ´ng cáº§n ConcurrentModificationException 
		- Náº¿u báº¡n dÃ¹ng Iterator Ä‘á»ƒ duyá»‡t qua danh sÃ¡ch má»™t ArrayList thÃ´ng thÆ°á»ng, mÃ  Ä‘á»“ng thá»i cÃ³ má»™t luá»“ng khÃ¡c sá»­a danh sÃ¡ch, báº¡n cÃ³ thá»ƒ gáº·p lá»—i  ConcurrentModificationException  
		
		- Vá»›i CopyOnWriteArrayList, cÃ¡c luá»“ng Ä‘á»c khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng bá»Ÿi cÃ¡c thay Ä‘á»•i trong danh danh sÃ¡ch vÃ¬ chÃºng lÃ m viá»‡c vá»›i báº£n sao cÅ©  


#  CÃ¡ch sá»­ dá»¥ng CopyOnWriteArrayList 
	
	## VÃ­ dá»¥ 1 : DUyá»‡t qua danh sÃ¡ch mÃ  khÃ´ng bá»‹ ConcurrentModificationException 
		
	import java.util.concurrent.CopyOnWriteArrayList;

		public class CopyOnWriteArrayListExample {
			public static void main(String[] args) {
				CopyOnWriteArrayList<String> list = new CopyOnWriteArrayList<>();
				list.add("Java");
				list.add("Python");
				list.add("C++");
		
				// Duyá»‡t danh sÃ¡ch báº±ng Iterator mÃ  khÃ´ng gáº·p ConcurrentModificationException
				for (String lang : list) {
					System.out.println(lang);
					list.add("JavaScript");  // KhÃ´ng lá»—i ConcurrentModificationException
				}
		
				System.out.println("Final list: " + list);
			}
		}

		Khi for-each duyá»‡t danh sÃ¡ch, CopyOnWriteArrayList sá»­ dá»¥ng má»™t báº£n sao cá»‘ Ä‘á»‹nh, vÃ¬ váº­y nÃ³ khÃ´ng bá»‹ lá»—i ConcurrentModificationException, máº·c dÃ¹ chÃºng ta Ä‘ang thÃªm pháº§n tá»­ má»›i trong khi duyá»‡t.
		
		
	## VÃ­ dá»¥ 2: So sÃ¡nh 	 CopyOnWriteArrayList vá»›i ArrayList trong mÃ´i trÆ°á»ng Ä‘a luá»“ng 
		Náº¿u dÃ¹ng ArrayList trong mÃ´i trÆ°á»ng Ä‘a luá»“ng mÃ  khÃ´ng cÃ³ Ä‘á»“ng bá»™ hÃ³a, sáº½ cÃ³ thá»ƒ xáº£y ra lá»—i ConcurrentModificationException 
		
			import java.util.ArrayList;
			import java.util.List;
			
			public class ArrayListMultiThreading {
				public static void main(String[] args) {
					List<Integer> list = new ArrayList<>();
					list.add(1);
					list.add(2);
					list.add(3);
			
					Thread thread1 = new Thread(() -> {
						for (int num : list) {
							System.out.println(num);
							list.add(4); // Lá»—i ConcurrentModificationException
						}
					});
			
					thread1.start();
				}
			}

	
	## VÃ­ dá»¥ 3: Sá»­ dá»¥ng CopyOnWriteArrayList trong mÃ´i trÆ°á»ng Ä‘a luá»“ng (KhÃ´ng Lá»—i)
		import java.util.concurrent.CopyOnWriteArrayList;
	
		public class CopyOnWriteArrayListMultiThreading {
			public static void main(String[] args) {
				CopyOnWriteArrayList<Integer> list = new CopyOnWriteArrayList<>();
				list.add(1);
				list.add(2);
				list.add(3);
		
				Thread thread1 = new Thread(() -> {
					for (int num : list) {
						System.out.println(num);
						list.add(4);  // KhÃ´ng lá»—i
					}
				});
		
				thread1.start();
			}
		}
	
		
		âœ… KhÃ´ng bá»‹ lá»—i ConcurrentModificationException
ğŸ’¡ LÃ½ do: VÃ¬ CopyOnWriteArrayList táº¡o má»™t báº£n sao má»›i khi cÃ³ thao tÃ¡c ghi (write), nÃªn Iterator váº«n duyá»‡t danh sÃ¡ch cÅ© mÃ  khÃ´ng bá»‹ lá»—i.


# Khi nÃ o nÃªn sá»­ dá»¥ng  
CopyOnWriteArrayList 

	ğŸ“Œ DÃ¹ng khi:
	âœ… Khi cÃ³ nhiá»u luá»“ng Ä‘á»c (read-heavy operations) nhÆ°ng Ã­t luá»“ng ghi
	âœ… Khi muá»‘n trÃ¡nh ConcurrentModificationException mÃ  khÃ´ng cáº§n sá»­ dá»¥ng synchronization
	âœ… Khi cáº§n duyá»‡t danh sÃ¡ch an toÃ n trong mÃ´i trÆ°á»ng Ä‘a luá»“ng mÃ  khÃ´ng cáº§n synchronized
	
	ğŸš« KhÃ´ng nÃªn dÃ¹ng khi:
	âŒ Khi cÃ³ nhiá»u thao tÃ¡c ghi (add(), remove(), set()) vÃ¬ má»—i láº§n ghi sáº½ táº¡o má»™t báº£n sao má»›i, tá»‘n bá»™ nhá»› vÃ  hiá»‡u suáº¥t tháº¥p.
	âŒ Khi cáº§n danh sÃ¡ch thay Ä‘á»•i thÆ°á»ng xuyÃªn, ConcurrentLinkedQueue hoáº·c synchronized List cÃ³ thá»ƒ phÃ¹ há»£p hÆ¡n.	
	
	
	
	
# So sÃ¡nh CopyOnWriteArrayList vá»›i cÃ¡c Collection khÃ¡c  
	
	
Collection				Äa luá»“ng?			CÆ¡ cháº¿ Ä‘á»“ng bá»™ hÃ³a					Hiá»‡u suáº¥t Ä‘á»c			Hiá»‡u suáº¥t ghi
ArrayList				âŒ KhÃ´ng			KhÃ´ng Ä‘á»“ng bá»™						Nhanh ğŸš€				Nhanh ğŸš€
Vector					âœ… CÃ³				synchronized toÃ n bá»™ phÆ°Æ¡ng thá»©c	Trung bÃ¬nh âš¡			Cháº­m ğŸ¢
CopyOnWriteArrayList	âœ… CÃ³				Copy-on-Write						Nhanh ğŸš€				Cháº­m ğŸ¢
ConcurrentLinkedQueue	âœ… CÃ³				KhÃ´ng khÃ³a (lock-free)				Nhanh ğŸš€				Nhanh ğŸš€	
	

# TÃ³m táº¯t kiáº¿n thá»©c dÃ nh cho Java Gold vÃ  Silver 
âœ… Äiá»ƒm quan trá»ng cáº§n nhá»› cho ká»³ thi:
- CopyOnWriteArrayList lÃ  má»™t danh sÃ¡ch an toÃ n trong mÃ´i trÆ°á»ng Ä‘a luá»“ng sá»­ dá»¥ng cÆ¡ cháº¿ Copy-on-Write.
- Khi cÃ³ thao tÃ¡c ghi (add(), set(), remove()), má»™t báº£n sao má»›i cá»§a danh sÃ¡ch Ä‘Æ°á»£c táº¡o.
- KhÃ´ng cáº§n synchronized thá»§ cÃ´ng vÃ¬ cÆ¡ cháº¿ Copy-on-Write Ä‘áº£m báº£o an toÃ n cho Ä‘a luá»“ng.
- Hiá»‡u suáº¥t ghi kÃ©m vÃ¬ táº¡o báº£n sao má»›i tá»‘n bá»™ nhá»› vÃ  CPU, nhÆ°ng hiá»‡u suáº¥t Ä‘á»c ráº¥t cao.
- KhÃ´ng bá»‹ lá»—i ConcurrentModificationException khi duyá»‡t danh sÃ¡ch, vÃ¬ cÃ¡c luá»“ng Ä‘á»c khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng bá»Ÿi cÃ¡c thay Ä‘á»•i trong danh sÃ¡ch.


ğŸ¯ Káº¿t luáº­n
Náº¿u chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n cÃ³ nhiá»u thao tÃ¡c Ä‘á»c, Ã­t thao tÃ¡c ghi, CopyOnWriteArrayList lÃ  má»™t lá»±a chá»n tuyá»‡t vá»i.
Náº¿u cÃ³ nhiá»u thao tÃ¡c ghi, hÃ£y cÃ¢n nháº¯c sá»­ dá»¥ng ConcurrentLinkedQueue hoáº·c synchronized List thay vÃ¬ CopyOnWriteArrayList.
Trong ká»³ thi Java Gold & Silver, hÃ£y chÃº Ã½ Ä‘áº¿n cÃ¡ch CopyOnWriteArrayList xá»­ lÃ½ vÃ²ng láº·p vÃ  thao tÃ¡c ghi trong mÃ´i trÆ°á»ng Ä‘a luá»“ng.	
	

// Má»‘i quan há»‡ giá»¯a List vÃ  cÃ¡c Implementations cá»§a nÃ³ 

java.util.List (Interface)
â”‚
â”œâ”€â”€ java.util.ArrayList (implements List, RandomAccess)
â”‚
â”œâ”€â”€ java.util.LinkedList (implements List, Deque)
â”‚
â”œâ”€â”€ java.util.Vector (implements List, RandomAccess)
â”‚   â”œâ”€â”€ java.util.Stack (extends Vector)
â”‚
â”œâ”€â”€ java.util.CopyOnWriteArrayList (implements List, RandomAccess)
	
	
	
// Má»—i quan há»‡ giá»¯a List vÃ  RandomAccess 	
	
	
            java.util.List (Interface)
                  â”‚
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚                                 â”‚
 â”‚                     java.util.LinkedList
 â”‚                                 â–²
 â”‚                                 â”‚
 â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
 â”‚           â”‚               â”‚           â”‚
 â”‚           â”‚               â”‚           â”‚
 â–¼           â–¼               â–¼           â–¼
 java.util.ArrayList   java.util.Vector   java.util.CopyOnWriteArrayList
        â”‚                   â”‚                   â”‚
        â”‚                   â–¼                   â–¼
        â”‚          java.util.Stack          (implements RandomAccess)
        â”‚
        â–¼
  (implements RandomAccess)
	
	
	
</pre><a id='backBottom' href='../java-learning-list.html' style='display:none;'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><button onclick='toggleTheme()'>ğŸŒ™ Chuyá»ƒn giao diá»‡n</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>