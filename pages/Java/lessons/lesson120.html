<html><head><title>Lesson 120 == Concurrent Tree ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../java-learning-list.html'>üîô Quay l·∫°i danh s√°ch</a><br><h1>Lesson 120 -- Concurrent Tree -//</h1><pre>
# Kh√°i ni·ªám 
	Concurrent Tree l√† m·ªôt nh√°nh n√¢ng cao trong thi·∫øt k·∫ø c·∫•u tr√∫c d·ªØ li·ªáu d√πng cho ƒëa lu·ªìng (multi-threading), n∆°i m√† c√°c c√¢y nh∆∞ Binary Search Tree, AVL, Red-Black Tree, B-Tree... ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ h·ªó tr·ª£ truy c·∫≠p v√† c·∫≠p nh·∫≠t song song m√† v·∫´n ƒë·∫£m b·∫£o ƒë√∫ng logic v√† kh√¥ng x·∫£y ra race condition.
	
	T·∫°i level senior system architect, b·∫°n c·∫ßn hi·ªÉu:

		T·∫°i sao Concurrent Tree l·∫°i kh√≥.
		C√°c k·ªπ thu·∫≠t ƒë·ªìng b·ªô h√≥a v√† t·ªëi ∆∞u ƒë∆∞·ª£c d√πng ƒë·ªÉ gi·∫£i quy·∫øt.
		C√°ch tri·ªÉn khai m·ªôt c√¢y d·ªØ li·ªáu c√≥ th·ªÉ ch·ªãu ƒë∆∞·ª£c t·∫£i cao trong m√¥i tr∆∞·ªùng ƒëa lu·ªìng.
		Nh·ªØng trade-off gi·ªØa hi·ªáu nƒÉng v√† t√≠nh ƒë·ªìng b·ªô


# üß† V·∫§N ƒê·ªÄ C·ªêT L√ïI KHI D√ôNG TREE TRONG MULTITHREADING

	‚ùå V·∫•n ƒë·ªÅ: 
		Race condition: 2 thread ch·∫°m c√πng 1 node ho·∫∑c subtree.
		Deadlock: n·∫øu locking kh√¥ng ƒë√∫ng th·ª© t·ª±.
		Starvation: thread b·ªã ƒë√≥i t√†i nguy√™n
		Cache coherence v√† false sharing ·∫£nh h∆∞·ªüng hi·ªáu nƒÉng.
		
		
# 	‚úÖ Y√äU C·∫¶U C·ª¶A 1 CONCURRENT TREE 
| Y√™u c·∫ßu                     | Di·ªÖn gi·∫£i                                |
| --------------------------- | ---------------------------------------- |
| **Thread-safe**             | ƒê·∫£m b·∫£o truy c·∫≠p ƒë√∫ng khi c√≥ nhi·ªÅu lu·ªìng |
| **Non-blocking (t√πy ch·ªçn)** | C√≥ th·ªÉ d√πng lock-free n·∫øu c·∫ßn            |
| **Hi·ªáu nƒÉng cao**           | Scale v·ªõi s·ªë thread                      |
| **Consistency**             | C√¢y lu√¥n gi·ªØ ƒë√∫ng tr·∫°ng th√°i             |


# üîß C√ÅC CHI·∫æN L∆Ø·ª¢C ƒê·ªíNG B·ªò (LOCKING STRATEGIES)


	## 1 . Global Lock
		Lock to√†n b·ªô c√¢y m·ªói l·∫ßn truy c·∫≠p 
		ƒê∆°n gi·∫£n, hi·ªáu nƒÉng th·∫•p ‚Üí bottleneck 
		
	## 	2. Fine-Grained Locking 
		M·ªói node c√≥ lock ri√™ng (ReentrantLock) 
		
node.lock();
try {
   if (key < node.key)
       go left;
   else
       go right;
} finally {
   node.unlock();
}

	Cho ph√©p truy c·∫≠p song song ·ªü c√°c nh√°nh kh√°c nhau
	D·ªÖ deadlock n·∫øu kh√¥ng c·∫©n th·∫≠n v·ªõi th·ª© t·ª± lock
	

	## 3. Hand-over-hand locking (Lock Coupling)
		Lock node hi·ªán t·∫°i ‚Üí lock node ti·∫øp theo ‚Üí r·ªìi m·ªõi unlock node hi·ªán t·∫°i 
		
		-> Gi·ªØ t√≠nh nh·∫•t qu√°n khi duy·ªát
		-> T·ªët h∆°n fine-grained nh∆∞ng v·∫´n blocking 




## üî• LOCK-FREE TREE (ADVANCED) 
	‚ú® Kh√¥ng d√πng lock (d√πng CAS ‚Äì Compare and Swap) 
			- D·ª±a v√†o AtomicReference, VarHandle, Unsafe 
			- D√πng versioned pointers, logical deletion, marking flags
			- R·∫•t kh√≥ debug, ch·ªâ d√πng trong h·ªá th·ªëng c·ª±c k·ª≥ y√™u c·∫ßu hi·ªáu su·∫•t 
			
		V√≠ d·ª•: Concurrent Skip List trong Java (ConcurrentSkipListMap) l√† lock-free tree-based structure.



# üå≥ LO·∫†I C√ÇY PH√ô H·ª¢P MULTITHREADING 
| C√¢y                    | C√≥ d√πng concurrent version kh√¥ng?        | Ghi ch√∫                            |
| ---------------------- | ---------------------------------------- | ---------------------------------- |
| BST                    | C√≥ (t√πy ch·ªânh locking)                   | Kh√≥ c√¢n b·∫±ng                       |
| AVL                    | C√≥ (ph·ª©c t·∫°p do rotation)                | C·∫ßn ph·ªëi h·ª£p lock xoay c√¢y         |
| Red-Black Tree         | C√≥, nh∆∞ng rotation ph·ª©c t·∫°p              | Ch·ªâ d√πng n·∫øu c·∫ßn sorted map        |
| Treap                  | C√≥, ƒë∆°n gi·∫£n rotation                    | Randomized balance gi·∫£m tranh ch·∫•p |
| Skip List              | ‚úÖ D·ªÖ lock-free                           | Java d√πng cho ConcurrentMap        |
| B-Tree / B+Tree        | ‚úÖ D√πng trong database (RocksDB, LevelDB) | H·ªó tr·ª£ concurrent insert/scan      |
| Segment Tree / Fenwick | Hi·∫øm (√≠t use case concurrent)            | Ch·ªß y·∫øu ƒë·ªçc nhi·ªÅu, √≠t ghi          |



# üì¶ JAVA EXAMPLE: Concurrent Skip List
Java c√≥ s·∫µn ConcurrentSkipListMap<K, V> l√† 1 lock-free sorted map:

ConcurrentSkipListMap<Integer, String> map = new ConcurrentSkipListMap<>();
map.put(10, "A");
map.put(20, "B");
map.remove(10);


	ƒê∆∞·ª£c d√πng trong ConcurrentHashMap, ConcurrentNavigableMap
	Cho ph√©p insert/search/delete ƒë·ªìng th·ªùi
	
	
	
# 	üî¨ EXAMPLE: Concurrent Red-Black Tree (Kh√≥)
	
	B·∫°n ph·∫£i:
	
		Lock theo t·ª´ng node (fine-grain)
		Trong xoay c√¢y (rotation), lock 2-3 node c√πng l√∫c
		Ghi nh·ªõ vi·ªác ƒë·ªïi m√†u v√† gi·ªØ c√¢y balanced
	
	Pseudo-code Lock Coupling (insert) 
	
parent.lock();
Node curr = parent.left;

while (curr != null) {
    curr.lock();
    parent.unlock();
    parent = curr;
    curr = (key < curr.key) ? curr.left : curr.right;
}
insert node;
parent.unlock();
	
# 	‚öñÔ∏è TRADE-OFF KHI D√ôNG CONCURRENT TREE
	
| ∆Øu ƒëi·ªÉm                        | Nh∆∞·ª£c ƒëi·ªÉm                              |
| ------------------------------ | --------------------------------------- |
| H·ªó tr·ª£ truy c·∫≠p song song      | Ph·ª©c t·∫°p v·ªÅ locking                     |
| D·ªØ li·ªáu lu√¥n ƒë√∫ng              | D·ªÖ deadlock ho·∫∑c starvation             |
| T·ªët h∆°n Hashtable (n·∫øu sorted) | T·ªën b·ªô nh·ªõ (extra lock fields)          |
| C√≥ th·ªÉ lock-free (SkipList)    | Kh√¥ng ph√π h·ª£p cho update-heavy workload |
	
	
# 	üìò KI·∫æN TH·ª®C C·∫¶N N·∫ÆM V·ªÆNG ƒê·ªÇ L√ÄM CH·ª¶ CONCURRENT TREE 
| Ki·∫øn th·ª©c                  | M·ª•c ti√™u                                               |
| -------------------------- | ------------------------------------------------------ |
| Tree Rotation, Balance     | Hi·ªÉu logic t·ª± c√¢n b·∫±ng khi c√≥ nhi·ªÅu thread             |
| Concurrency in Java        | Lock, volatile, atomic, `ReentrantLock`, `StampedLock` |
| CAS operation              | D√πng `AtomicReference`, `compareAndSet()`              |
| Memory model               | Happens-before, visibility                             |
| Lock-free data structure   | SkipList, Treiber Stack, Michael-Scott Queue           |
| Thread-safe design pattern | Copy-on-write, immutable tree                          |


# üéØ ·ª®NG D·ª§NG TH·ª∞C T·∫æ

	Database: RocksDB, LevelDB d√πng concurrent B+Tree
	Search engine: Lucene s·ª≠ d·ª•ng concurrent tree structures
	In-memory cache: Sorted LRU caches c·∫ßn concurrent AVL / RBT
	Realtime analytics: D·ªØ li·ªáu streaming c·∫ßn update/scan song song


</pre><a id='backBottom' href='../java-learning-list.html' style='display:none;'>üîô Quay l·∫°i danh s√°ch</a><br><button onclick='toggleTheme()'>üåô Chuy·ªÉn giao di·ªán</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>