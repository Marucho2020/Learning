<html><head><title>Lesson 115 == Segment Tree ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../java-learning-list.html'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><h1>Lesson 115 -- Segment Tree -//</h1><pre># KhÃ¡i niá»‡m 
	Segment Tree lÃ  má»™t cáº¥u trÃºc dá»¯ liá»‡u cÃ¢y cá»±c ká»³ máº¡nh máº½, Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ xá»­ lÃ½ nhanh cÃ¡c bÃ i toÃ¡n dáº¡ng range query + update. á» level senior system engineer / backend optimization, hiá»ƒu vÃ  sá»­ dá»¥ng Segment Tree giÃºp báº¡n:
	
	-  Giáº£m Ä‘á»™ phá»©c táº¡p tá»« O(n) xuá»‘ng O(log n) cho cÃ¡c bÃ i toÃ¡n range
	-  Tá»‘i Æ°u xá»­ lÃ½ dá»¯ liá»‡u lá»›n (data stream, time-series)
	-  á»¨ng dá»¥ng trong database engine, game engine, analytics, real-time monitoring...

# ğŸ§  1. Má»¤C TIÃŠU Cá»¦A SEGMENT TREE

	Cho 1 máº£ng sá»‘ A[0...n-1], báº¡n cáº§n xá»­ lÃ½ nhiá»u truy váº¥n dáº¡ng:
		- query(l, r) â†’ tá»•ng, min, max, GCD, XOR, Ä‘áº¿m sá»‘ Ã¢mâ€¦ 
		- update(i, val) â†’ thay Ä‘á»•i pháº§n tá»­ á»Ÿ vá»‹ trÃ­ i 
		
	Náº¿u xá»­ lÃ½ báº±ng cÃ¡ch duyá»‡t Ä‘oáº¡n [l, r] thÃ¬ má»—i truy váº¥n lÃ  O(n) â†’ khÃ´ng cháº¥p nháº­n Ä‘Æ°á»£c náº¿u cÃ³ tá»›i hÃ ng triá»‡u láº§n gá»i.
	â¡ï¸ Segment Tree giáº£i quyáº¿t báº±ng cÃ¡ch chia máº£ng ra thÃ nh cÃ¡c Ä‘oáº¡n (segment), lÆ°u thÃ´ng tin cá»§a tá»«ng Ä‘oáº¡n.
	
	
	
# ğŸŒ² 2. Cáº¤U TRÃšC VÃ€ Ã TÆ¯á»NG 
	LÃ  cÃ¢y nhá»‹ phÃ¢n, má»—i node quáº£n lÃ½ 1 Ä‘oáº¡n con cá»§a máº£ng.
	
		Root quáº£n lÃ½ Ä‘oáº¡n [0, n-1]
		Má»—i node chia Ä‘Ã´i thÃ nh hai Ä‘oáº¡n con: [l, mid] vÃ  [mid+1, r]
		LÃ¡ tÆ°Æ¡ng á»©ng vá»›i tá»«ng pháº§n tá»­ Ä‘Æ¡n láº».
		Má»—i node lÆ°u thÃ´ng tin Ä‘Ã£ xá»­ lÃ½ (tá»•ng, min, maxâ€¦) 
		
VÃ­ dá»¥: A = [5, 8, 6, 3, 2, 7, 4, 6]
		
                            [0,7]
                          /       \
                     [0,3]         [4,7]
                    /    \         /    \
                [0,1]  [2,3]   [4,5]   [6,7]
                / \     / \    / \     / \
              [0][1] [2][3] [4][5]  [6][7]
	



# ğŸ“ 3. CÃC TÃC Vá»¤ CHÃNH 
	## âœ… XÃ¢y cÃ¢y: build(A) 
		Äá»‡ quy chia máº£ng thÃ nh Ä‘oáº¡n con 
		TÃ­nh giÃ¡ trá»‹ táº¡i tá»«ng node (tá»•ng, minâ€¦)
		â±ï¸ Äá»™ phá»©c táº¡p: O(n)


	## âœ… Truy váº¥n Ä‘oáº¡n: query(l, r) 
		Äá»‡ quy duyá»‡t xuá»‘ng cÃ¢y 
		Náº¿u Ä‘oáº¡n con náº±m trong pháº¡m vi, láº¥y node
		Náº¿u Ä‘oáº¡n con cáº¯t nhau, duyá»‡t cáº£ hai bÃªn
		â±ï¸ Äá»™ phá»©c táº¡p: O(log n)
		
	## âœ… Cáº­p nháº­t pháº§n tá»­: update(i, val) 
		Duyá»‡t xuá»‘ng cÃ¢y Ä‘áº¿n lÃ¡ tÆ°Æ¡ng á»©ng 
		Cáº­p nháº­t node vÃ  cÃ¡c tá»• tiÃªn
		
	â±ï¸ Äá»™ phá»©c táº¡p: O(log n)	



# ğŸ› ï¸ 4. CÃ€I Äáº¶T JAVA
class SegmentTree {
    int[] tree;
    int n;

    public SegmentTree(int[] arr) {
        n = arr.length;
        tree = new int[4 * n]; // Ä‘á»§ chá»—
        build(arr, 0, 0, n - 1);
    }

    void build(int[] arr, int node, int l, int r) {
        if (l == r) {
            tree[node] = arr[l];
        } else {
            int mid = (l + r) / 2;
            build(arr, 2 * node + 1, l, mid);
            build(arr, 2 * node + 2, mid + 1, r);
            tree[node] = tree[2 * node + 1] + tree[2 * node + 2];
        }
    }

    int query(int node, int l, int r, int ql, int qr) {
        if (qr < l || ql > r) return 0;
        if (ql <= l && r <= qr) return tree[node];
        int mid = (l + r) / 2;
        return query(2 * node + 1, l, mid, ql, qr) +
               query(2 * node + 2, mid + 1, r, ql, qr);
    }

    void update(int node, int l, int r, int idx, int val) {
        if (l == r) {
            tree[node] = val;
        } else {
            int mid = (l + r) / 2;
            if (idx <= mid)
                update(2 * node + 1, l, mid, idx, val);
            else
                update(2 * node + 2, mid + 1, r, idx, val);
            tree[node] = tree[2 * node + 1] + tree[2 * node + 2];
        }
    }

    // Helper
    public int rangeQuery(int l, int r) {
        return query(0, 0, n - 1, l, r);
    }

    public void pointUpdate(int idx, int val) {
        update(0, 0, n - 1, idx, val);
    }
}



# ğŸš€ 5. á»¨NG Dá»¤NG TRONG Há»† THá»NG

| á»¨ng dá»¥ng                        | LÃ½ do sá»­ dá»¥ng Segment Tree       |
| ------------------------------- | -------------------------------- |
| Game server real-time combat    | Range damage, range heal         |
| Financial system (streaming)    | Query trÃªn time series           |
| Compiler / IDE                  | PhÃ¡t hiá»‡n lá»—i trÃªn Ä‘oáº¡n code     |
| Search engine                   | Äáº¿m sá»‘ term xuáº¥t hiá»‡n theo range |
| Database (Column store)         | Bitmap index, summary tree       |
| Analytics Engine (log / metric) | Query giÃ¡ trá»‹ trong range        |


# ğŸ”¥ 6. NÃ‚NG CAO: Lazy Propagation 

	Khi cÃ³ nhiá»u truy váº¥n update(l, r) (cáº­p nháº­t cáº£ Ä‘oáº¡n), viá»‡c cáº­p nháº­t tá»«ng node ráº¥t tá»‘n thá»i gian.

	â†’ DÃ¹ng ká»¹ thuáº­t Lazy Propagation:
	
		ÄÃ¡nh dáº¥u node chÆ°a cáº­p nháº­t
		Khi nÃ o truy váº¥n Ä‘áº¿n thÃ¬ má»›i cáº­p nháº­t (lazy)
	
	Káº¿t quáº£: Cáº£ update vÃ  query váº«n giá»¯ O(log n)

# ğŸ“ 7. NHá»®NG THá»¨ Cáº¦N Há»ŒC THÃŠM

| Chá»§ Ä‘á»                  | Má»¥c tiÃªu                          |
| ----------------------- | --------------------------------- |
| Lazy Propagation        | Xá»­ lÃ½ update theo Ä‘oáº¡n            |
| Persistent Segment Tree | Undo/redo, versioning             |
| Merge Sort Tree         | Query thá»© háº¡ng (order statistic)  |
| Segment Tree Beats      | Complex range (max/min update...) |
| Segment Tree 2D         | Xá»­ lÃ½ range query trong ma tráº­n   |
| Fenwick Tree (BIT)      | So sÃ¡nh vÃ  lá»±a chá»n               |



# âœ… TÃ“M Táº®T 

| TÃ­nh nÄƒng         | Segment Tree           |
| ----------------- | ---------------------- |
| Truy váº¥n Ä‘oáº¡n     | `O(log n)`             |
| Cáº­p nháº­t          | `O(log n)`             |
| DÃ¹ng nhiá»u memory | `4 * n` pháº§n tá»­        |
| Tá»‘i Æ°u disk?      | KhÃ´ng (cháº¡y trong RAM) |
| NÃ¢ng cáº¥p          | Lazy, Persistent, 2D   |



</pre><a id='backBottom' href='../java-learning-list.html' style='display:none;'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><button onclick='toggleTheme()'>ğŸŒ™ Chuyá»ƒn giao diá»‡n</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>