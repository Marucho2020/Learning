<html><head><title>Lesson 91 == Xá»­ lÃ½ file upload trong Spring MVC ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../java-learning-list.html'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><h1>Lesson 91 -- Xá»­ lÃ½ file upload trong Spring MVC -//</h1><pre>
# âš™ï¸ 1. CÆ¡ báº£n: Xá»­ lÃ½ file upload vá»›i MultipartFile 
	Spring MVC há»— trá»£ upload file thÃ´ng qua MultipartFile.



	## âœ… Controller máº«u: 
			@PostMapping("/upload")
			public ResponseEntity<String> handleFileUpload(@RequestParam("file") MultipartFile file) {
				if (file.isEmpty()) {
					return ResponseEntity.badRequest().body("File is empty");
				}
			
				try {
					Path uploadPath = Paths.get("uploads/" + file.getOriginalFilename());
					Files.copy(file.getInputStream(), uploadPath, StandardCopyOption.REPLACE_EXISTING);
					return ResponseEntity.ok("File uploaded successfully");
				} catch (IOException e) {
					throw new RuntimeException("Failed to upload file", e);
				}
			}
					
			


# ğŸ” 2. Quan Ä‘iá»ƒm cá»§a má»™t senior: Nhá»¯ng váº¥n Ä‘á» cáº§n xá»­ lÃ½ báº¯t buá»™c

	## a. Báº£o máº­t 
		### KhÃ´ng bao giá» tin tÆ°á»Ÿng tÃªn file tá»« client.
			String safeFilename = StringUtils.cleanPath(Objects.requireNonNull(file.getOriginalFilename()));
		
		
		### Chá»‘ng path traversal (../../etc/passwd): Validate tÃªn file.
			
		### Giá»›i háº¡n kÃ­ch thÆ°á»›c file â€“ trÃ¡nh DoS báº±ng file lá»›n.
			Cáº¥u hÃ¬nh trong application.properties:
				spring.servlet.multipart.max-file-size=5MB
				spring.servlet.multipart.max-request-size=5MB


	## b. Kiá»ƒm tra loáº¡i file 
		Äá»«ng dá»±a vÃ o tÃªn file hoáº·c content-type tá»« client. DÃ¹ng thÆ° viá»‡n nhÆ° Apache Tika Ä‘á»ƒ xÃ¡c Ä‘á»‹nh loáº¡i file thá»±c:
		
				Tika tika = new Tika();
				String mimeType = tika.detect(file.getInputStream());




# c. Xá»­ lÃ½ song song & Ä‘a luá»“ng 
	
		Náº¿u xá»­ lÃ½ file náº·ng, hÃ£y Ä‘Æ°a vÃ o background thread, message queue (RabbitMQ, Kafka), hoáº·c offload qua microservice khÃ¡c.


# d. KhÃ´ng lÆ°u vÃ o thÆ° má»¥c /uploads cá»©ng 
		

	## LÆ°u trá»¯ nÃªn trá»«u tÆ°á»£ng:

		LÆ°u vÃ o filesystem (dev/test)
		
		LÆ°u vÃ o Amazon S3, Google Cloud Storage (prod)
		
		LÆ°u vÃ o database BLOB (náº¿u thá»±c sá»± cáº§n â€“ vÃ­ dá»¥: áº£nh avatar nhá»)

	## Viáº¿t class StorageService interface Ä‘á»ƒ dá»… má»Ÿ rá»™ng:

		public interface StorageService {
			void save(MultipartFile file);
			Resource load(String filename);
		}
		Dá»… unit test, mock, triá»ƒn khai khÃ¡c nhau. 


# ğŸ” 3. Upload nhiá»u file

		@PostMapping("/uploadMultiple")
		public ResponseEntity<?> uploadMultiple(@RequestParam("files") MultipartFile[] files) {
			List<String> filenames = new ArrayList<>();
			for (MultipartFile file : files) {
				storageService.save(file);
				filenames.add(file.getOriginalFilename());
			}
			return ResponseEntity.ok("Uploaded: " + String.join(", ", filenames));
		}


 

# ğŸ§  4. Kinh nghiá»‡m battle-tested (senior-level) 
	


Váº¥n Ä‘á» thá»±c táº¿											CÃ¡ch xá»­ lÃ½ chuyÃªn nghiá»‡p
Táº£i file Ä‘á»™c háº¡i (virus/malware)					TÃ­ch há»£p virus scanner nhÆ° ClamAV
Táº£i nháº§m file (format sai)							Kiá»ƒm tra Ä‘á»‹nh dáº¡ng báº±ng byte header (magic number)
Ghi Ä‘Ã¨ file cÅ©										Táº¡o tÃªn file duy nháº¥t báº±ng UUID hoáº·c hash
Sá»± cá»‘ khi lÆ°u file (disk full, permission)			Báº¯t lá»—i chi tiáº¿t, log cáº©n tháº­n, rollback náº¿u cáº§n
Audit & traceability								Log ngÆ°á»i upload, IP, tÃªn file, timestamp
LÆ°u metadata file (kÃ­ch thÆ°á»›c, type)				Ghi vÃ o database cho dá»… query





# ğŸ“¦ 5. Spring Boot + REST + Frontend 
	Vá»›i frontend (React, Vue, v.v.) â†’ cáº§n endpoint dáº¡ng multipart/form-data.
	CORS pháº£i Ä‘Æ°á»£c xá»­ lÃ½ náº¿u frontend cháº¡y riÃªng port:
	
			@CrossOrigin(origins = "*")
			@PostMapping("/upload")
			public ResponseEntity<?> upload(@RequestParam MultipartFile file) { ... }


Muá»‘n lÃªn Java Gold hay lÃ m lead trong microservice architecture, thÃ¬:
	HÃ£y trá»«u tÆ°á»£ng pháº§n lÆ°u file
	TÃ¡ch logic upload ra khá»i controller
	LuÃ´n validate input tá»« client
	Logging Ä‘áº§y Ä‘á»§ Ä‘á»ƒ trace issue
	Chuáº©n bá»‹ cho scale (phÃ¢n tÃ¡n file, queue xá»­ lÃ½ async)

</pre><a id='backBottom' href='../java-learning-list.html' style='display:none;'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><button onclick='toggleTheme()'>ğŸŒ™ Chuyá»ƒn giao diá»‡n</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>