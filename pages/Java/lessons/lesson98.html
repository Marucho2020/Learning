<html><head><title>Lesson 98 == Treap / Scapegoat Tree ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../java-learning-list.html'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><h1>Lesson 98 -- Treap / Scapegoat Tree -//</h1><pre>
# TREAP (Tree + Heap)
	
	## KhÃ¡i niá»‡m  
		Treap = Binary Search Tree + Heap Property (ngáº«u nhiÃªn)

	Má»—i node cÃ³:
		key â†’ Ä‘áº£m báº£o thá»© tá»± BST
		priority (ngáº«u nhiÃªn) â†’ Ä‘áº£m báº£o thá»© tá»± giá»‘ng Max-Heap hoáº·c Min-Heap
		
	TÆ°á»Ÿng tÆ°á»£ng báº¡n xÃ¢y dá»±ng má»™t cÃ¢y BST, nhÆ°ng Ä‘á»“ng thá»i cÅ©ng muá»‘n nÃ³ khÃ´ng quÃ¡ máº¥t cÃ¢n báº±ng â†’ báº¡n Ä‘Æ°a randomization vÃ o qua priority.



	## ğŸ§  Cáº¥u trÃºc Node:
	
		class TreapNode {
			int key;       // khÃ³a chÃ­nh giá»‘ng BST
			int priority;  // giÃ¡ trá»‹ random
			TreapNode left, right;
		}
	
	
	## ğŸ¯ Má»¥c tiÃªu: 
		1. Äáº£m báº£o BST Property:
			left.key < node.key < right.key
	
		2. Äáº£m báº£o Heap Property: 
			node.priority > left.priority && node.priority > right.priority
			
			



	## âš™ï¸ CÃ¡ch hoáº¡t Ä‘á»™ng:
	
		### Insert:
			ChÃ¨n giá»‘ng BST
			Sau Ä‘Ã³ "bubble up" node má»›i theo priority báº±ng cÃ¡ch xoay cÃ¢y nhÆ° heap
			
			
		### Delete:
			Sá»­ dá»¥ng rotation Ä‘á»ƒ Ä‘áº©y node xuá»‘ng cho Ä‘áº¿n khi nÃ³ lÃ  lÃ¡ â†’ rá»“i xoÃ¡
			
			
			
			
	## 	ğŸ² Táº¡i sao dÃ¹ng priority random?
		â†’ Äá»ƒ cÃ¢y cÃ³ tÃ­nh cÃ¢n báº±ng xÃ¡c suáº¥t, nhÆ° randomized quicksort
		â†’ TrÃ¡nh worst-case nhÆ° BST lá»‡ch háº³n má»™t phÃ­a
		
		CÃ³ thá»ƒ dÃ¹ng random hoáº·c gÃ¡n "priority = thá»i Ä‘iá»ƒm táº¡o" Ä‘á»ƒ mÃ´ phá»ng cÃ¢y Cartesian hoáº·c cÃ¢y thá»© tá»±.
			
	## 	ğŸ“ˆ á»¨ng dá»¥ng thá»±c táº¿:	
			
			Khi báº¡n khÃ´ng muá»‘n giá»¯ chiá»u cao (nhÆ° AVL) vÃ  khÃ´ng muá»‘n dÃ¹ng mÃ u (nhÆ° Red-Black)
			XÃ¢y dá»±ng index trong há»‡ thá»‘ng phÃ¢n tÃ¡n
			Persistent data structure nhá» cÃ¡ch tÃ¡ch vÃ  há»£p Treap ráº¥t dá»…			
			
			
			
			
			
# ğŸ§© PHáº¦N 2: SCAPEGOAT TREE	

	## ğŸ“Œ KhÃ¡i niá»‡m:
		Scapegoat Tree = BST cÃ³ kiá»ƒm tra chiá»u sÃ¢u vÃ  rebuild subtree khi máº¥t cÃ¢n báº±ng quÃ¡ náº·ng



	## ğŸ¯ Má»¥c tiÃªu:
		
		TrÃ¡nh overhead cá»§a viá»‡c xoay cÃ¢y liÃªn tá»¥c nhÆ° AVL
			## CÃ¢n báº±ng báº±ng cÃ¡ch xÃ¢y láº¡i cáº£ 1 subtree khi cáº§n, thay vÃ¬ tá»«ng bÆ°á»›c

	## âš™ï¸ CÃ¡ch hoáº¡t Ä‘á»™ng: 
		Khi chÃ¨n 1 node, náº¿u chiá»u sÃ¢u vÆ°á»£t má»©c cho phÃ©p:
			1. TÃ¬m tá»• tiÃªn gá»i lÃ  "scapegoat" (con dÃª táº¿ tháº§n) â€“ nÆ¡i cáº¥u trÃºc máº¥t cÃ¢n báº±ng
			2. Rebuild toÃ n bá»™ cÃ¢y con táº¡i node Ä‘Ã³ (nhÆ° xÃ¢y láº¡i BST tá»« máº£ng Ä‘Ã£ sáº¯p xáº¿p)



	## ğŸ“ Äá»‹nh nghÄ©a cÃ¢n báº±ng: 
		Náº¿u cÃ¢y cÃ³ n node, thÃ¬ chiá»u cao tá»‘i Ä‘a lÃ  logâ‚ƒâ„â‚‚(n)
		Náº¿u vÆ°á»£t giá»›i háº¡n â†’ rebuild
		KhÃ´ng rotation! KhÃ´ng thÃªm metadata phá»©c táº¡p nhÆ° height hay color!
		
	## 	ğŸ“‰ Æ¯u vÃ  NhÆ°á»£c:
		
| Æ¯u Ä‘iá»ƒm                            | NhÆ°á»£c Ä‘iá»ƒm                                       |
| ---------------------------------- | ------------------------------------------------ |
| Dá»… triá»ƒn khai                      | Rebuild toÃ n bá»™ subtree tá»‘n kÃ©m                  |
| KhÃ´ng cáº§n lÆ°u thÃªm thÃ´ng tin       | Chá»‰ cÃ¢n báº±ng á»Ÿ insert, khÃ´ng cÃ¢n báº±ng khi search |
| Cáº¥u trÃºc rÃµ rÃ ng                   | KhÃ´ng tá»‘i Æ°u cho workload cÃ³ pattern             |
| Tá»‘t cho há»‡ thá»‘ng memory-persistent | KhÃ´ng báº£o toÃ n O(log n) táº¡i má»i bÆ°á»›c             |



	## ğŸ“ˆ á»¨ng dá»¥ng thá»±c táº¿: 
		
		Khi báº¡n khÃ´ng muá»‘n sá»­ dá»¥ng rotation (phá»©c táº¡p trong memory layout)
		Dá»¯ liá»‡u hay Ä‘Æ°á»£c chÃ¨n á»“ áº¡t rá»“i query sau (bulk-insert, batch mode)
		
		Embedded systems hoáº·c file systems cáº§n logic Ä‘Æ¡n giáº£n, rebuild toÃ n bá»™ nhanh hÆ¡n rotation
		



	## ğŸ†š So sÃ¡nh nhanh:
	
| TÃªn            | Äáº£m báº£o cÃ¢n báº±ng        | CÃ¡ch lÃ m                   | Tá»‘t cho                        |
| -------------- | ----------------------- | -------------------------- | ------------------------------ |
| Treap          | Trung bÃ¬nh (randomized) | Rotation dá»±a theo priority | Index, distributed cache       |
| Scapegoat Tree | Cá»©ng ráº¯n hÆ¡n BST        | Rebuild subtree khi cáº§n    | Embedded system, batch insert  |
| AVL            | LuÃ´n cÃ¢n báº±ng           | Rotation theo chiá»u cao    | Realtime system, DB            |
| Red-Black Tree | Tá»‘t                     | Rotation + color logic     | Java TreeMap, Filesystem index |



#ğŸ§  Ká»¹ nÄƒng cáº§n cÃ³ Ä‘á»ƒ hiá»ƒu vÃ  dÃ¹ng tá»‘t Treap / Scapegoat Tree:
	Náº¯m cháº¯c:
		Binary Search Tree
		Rotation
		PhÃ¢n tÃ­ch Ä‘á»™ phá»©c táº¡p theo xÃ¡c suáº¥t (amortized analysis)
		Äá»‡ quy vÃ  cáº¥u trÃºc con trá»
	
	Biáº¿t cÃ¡ch:
		CÃ¢n báº±ng trade-off giá»¯a chi phÃ­ insert/delete vs. query
		PhÃ¢n tÃ­ch workload cá»§a há»‡ thá»‘ng trÆ°á»›c khi chá»n tree phÃ¹ há»£p
		Hiá»ƒu á»©ng dá»¥ng cá»§a Split, Merge trong Treap
















			
</pre><a id='backBottom' href='../java-learning-list.html' style='display:none;'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><button onclick='toggleTheme()'>ğŸŒ™ Chuyá»ƒn giao diá»‡n</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>