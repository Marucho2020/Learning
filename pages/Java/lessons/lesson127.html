<html><head><title>Lesson 127 == Redis Sentinel ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../java-learning-list.html'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><h1>Lesson 127 -- Redis Sentinel -//</h1><pre># KhÃ¡i niá»‡m 
	ğŸ”· I. Má»¥c tiÃªu cá»§a Redis Sentinel
	Redis Ä‘Æ¡n nÃºt khÃ´ng cÃ³ HA â€“ náº¿u master cháº¿t, client khÃ´ng thá»ƒ ghi/Ä‘á»c.
	â†’ Redis Sentinel giÃºp: 

| Má»¥c tiÃªu                          | Chi tiáº¿t                            |
| --------------------------------- | ----------------------------------- |
| **GiÃ¡m sÃ¡t (Monitoring)**         | Kiá»ƒm tra master/slave cÃ³ cÃ²n sá»‘ng   |
| **ThÃ´ng bÃ¡o lá»—i (Notification)**  | Cáº£nh bÃ¡o khi node cháº¿t              |
| **Tá»± Ä‘á»™ng chuyá»ƒn Ä‘á»•i (Failover)** | Chá»n slave lÃªn lÃ m master má»›i       |
| **Cáº¥u hÃ¬nh láº¡i client**           | Gá»£i Ã½ client chuyá»ƒn sang master má»›i |


# ğŸ”§ II. Kiáº¿n trÃºc Redis Sentinel
+----------+      +----------+
| Sentinel |<---->| Sentinel |<----> ...
+----------+      +----------+
     |
     v
+------------+       +------------+
| Redis Master| <--->| Redis Slave|
+------------+       +------------+


	## ThÃ nh pháº§n:

		- Sentinel Node: process Ä‘á»™c láº­p, cháº¡y song song vá»›i Redis
		- Redis Master: node chÃ­nh ghi dá»¯ liá»‡u
		- Redis Slaves: replica Ä‘á»c-only
		- Client: tÆ°Æ¡ng tÃ¡c vá»›i Sentinel hoáº·c trá»±c tiáº¿p Redis

# ğŸ§  III. CÆ¡ cháº¿ hoáº¡t Ä‘á»™ng
	
	## 1. Monitoring 
		
		- Sentinel Ä‘á»‹nh ká»³ gá»­i PING Ä‘áº¿n Redis master/slaves vÃ  Sentinel khÃ¡c
		- Náº¿u n Sentinel Ä‘á»“ng Ã½ ráº±ng 1 node down â†’ Ä‘Ã¡nh dáº¥u subjectively down


	## 2. Failover 
		Náº¿u master Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u objectively down: 
			
			- Sentinel sáº½ chá»n 1 slave (Æ°u tiÃªn sync tá»‘t nháº¥t)
			- Gá»­i lá»‡nh SLAVEOF NO ONE â†’ biáº¿n nÃ³ thÃ nh master
			- CÃ¡c slave cÃ²n láº¡i sáº½ SLAVEOF master má»›i
			- Gá»­i thÃ´ng bÃ¡o Ä‘áº¿n client	
	
		Consensus failover Ä‘Æ°á»£c thá»±c hiá»‡n qua Raft-like voting giá»¯a Sentinel â†’ Ä‘áº£m báº£o khÃ´ng chá»n nhiá»u master


# ğŸ§© IV. Äiá»u kiá»‡n Ä‘á»ƒ Failover diá»…n ra 
	
			- Sá»‘ lÆ°á»£ng Sentinel â‰¥ quorum
			- Master khÃ´ng pháº£n há»“i â‰¥ down-after-milliseconds
			- QuÃ¡ trÃ¬nh báº§u cá»­ (failover timeout) diá»…n ra thÃ nh cÃ´ng		
	
	
	
	
# âš™ï¸ V. Config cÆ¡ báº£n (sentinel.conf) 
		
sentinel monitor mymaster 127.0.0.1 6379 2
sentinel down-after-milliseconds mymaster 5000
sentinel failover-timeout mymaster 10000
sentinel parallel-syncs mymaster 1
	
	
	
| Config                    | Ã nghÄ©a                                        |
| ------------------------- | ---------------------------------------------- |
| `mymaster`                | TÃªn Ä‘á»‹nh danh logical                          |
| `6379`                    | Cá»•ng Redis master                              |
| `2`                       | Quorum (tá»‘i thiá»ƒu Sentinel Ä‘á»“ng Ã½ Ä‘á»ƒ failover) |
| `down-after-milliseconds` | Bao lÃ¢u thÃ¬ coi master lÃ  cháº¿t                 |
| `failover-timeout`        | Thá»i gian tá»‘i Ä‘a Ä‘á»ƒ failover                   |
	
	
	
# 	ğŸ“¦ VI. Æ¯u Ä‘iá»ƒm cá»§a Redis Sentinel 

| Æ¯u Ä‘iá»ƒm                         | Ghi chÃº                       |
| ------------------------------- | ----------------------------- |
| âœ… Tá»± Ä‘á»™ng failover              | KhÃ´ng cáº§n con ngÆ°á»i can thiá»‡p |
| âœ… KhÃ´ng phá»¥ thuá»™c vÃ o cloud     | CÃ³ thá»ƒ cháº¡y on-premises       |
| âœ… Lightweight                   | LÃ  Redis process              |
| âœ… Client update Ä‘Æ°á»£c master má»›i | Vá»›i driver há»— trá»£ Sentinel    |



	
# 	ğŸ§¨ VII. Cáº¡m báº«y thá»±c táº¿ (senior nÃªn biáº¿t)


	## 1. Split-brain
	
		Náº¿u cáº¥u hÃ¬nh quorum tháº¥p â†’ 2 Sentinel nhÃ³m khÃ¡c nhau cÃ¹ng báº§u ra 2 master â†’ loáº¡n dá»¯ liá»‡u
		â¤ Fix: quorum Ä‘á»§ cao vÃ  odd number Sentinel (3, 5, 7...)
	

	## 2. Client khÃ´ng há»— trá»£ Sentinel protocol 
		
		Má»™t sá»‘ Redis client khÃ´ng tá»± Ä‘á»™ng phÃ¡t hiá»‡n master má»›i
		â¤ Fix: dÃ¹ng Redis client há»— trá»£ Sentinel (JedisSentinelPool, Lettuce Sentinel, v.v.)

	## 3. Sentinel khÃ´ng Ä‘á»™c láº­p

		Náº¿u Sentinel náº±m chung mÃ¡y vá»›i Redis â†’ khi Redis cháº¿t, Sentinel cháº¿t theo â†’ máº¥t failover
		â¤ Fix: Deploy Sentinel trÃªn cÃ¡c node riÃªng biá»‡t
	

	## 4. Replication lag 
		
		Náº¿u chá»n slave cÃ³ lag Ä‘á»ƒ promote â†’ data loss
		â¤ Fix: Sentinel chá»n slave sync gáº§n nháº¥t (INFO replication)


# ğŸ” VIII. So sÃ¡nh vá»›i cÃ¡c cÆ¡ cháº¿ HA khÃ¡c


| CÆ¡ cháº¿                            | Æ¯u                                                       | NhÆ°á»£c                                        |
| --------------------------------- | -------------------------------------------------------- | -------------------------------------------- |
| **Sentinel**                      | ÄÆ¡n giáº£n, built-in, hoáº¡t Ä‘á»™ng tá»‘t cho small/medium scale | Manual scaling, limited topology             |
| **Redis Cluster**                 | Sharding + HA                                            | KhÃ´ng há»— trá»£ multi-key transaction, phá»©c táº¡p |
| **Keepalived + Virtual IP**       | Active-passive switch báº±ng IP                            | KhÃ´ng tá»± failover data                       |
| **Proxy-based (e.g., Twemproxy)** | áº¨n master/slave khá»i client                              | KhÃ´ng tá»± failover, cáº§n thÃªm logic            |


# âœ… Tá»•ng káº¿t â€“ Kiáº¿n thá»©c cáº§n nhá»› cáº¥p Ä‘á»™ senior


| KhÃ­a cáº¡nh          | Ná»™i dung                                                              |
| ------------------ | --------------------------------------------------------------------- |
| Má»¥c tiÃªu           | GiÃ¡m sÃ¡t Redis, tá»± failover khi master cháº¿t                           |
| Cáº¥u hÃ¬nh chÃ­nh     | `monitor`, `quorum`, `down-after`, `failover-timeout`                 |
| CÆ¡ cháº¿ Ä‘á»“ng thuáº­n  | Vote giá»¯a Sentinel, khÃ´ng dÃ¹ng Raft chÃ­nh thá»©c nhÆ°ng concept tÆ°Æ¡ng tá»± |
| Pitfall thÆ°á»ng gáº·p | Quorum sai, split-brain, Sentinel Ä‘á»“ng cháº¿t, client khÃ´ng há»— trá»£      |
| Kiáº¿n trÃºc Ä‘Ãºng     | â‰¥3 Sentinel riÃªng biá»‡t, Slave sync cháº·t, client há»— trá»£ Sentinel API   |



</pre><a id='backBottom' href='../java-learning-list.html' style='display:none;'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><button onclick='toggleTheme()'>ğŸŒ™ Chuyá»ƒn giao diá»‡n</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>