<html><head><title>Lesson 76 == Cáº¥u hÃ¬nh Routing Ä‘á»™ng trong Runtime ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../java-learning-list.html'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><h1>Lesson 76 -- Cáº¥u hÃ¬nh Routing Ä‘á»™ng trong Runtime -//</h1><pre>
# KhÃ¡i niá»‡m 
	
	Routing Ä‘á»™ng trong runtime lÃ  má»™t ká»¹ thuáº­t cho phÃ©p há»‡ thá»‘ng thay Ä‘á»•i Ä‘Æ°á»ng Ä‘i cá»§a request mÃ  khÃ´ng cáº§n restart á»©ng dá»¥ng. Äiá»u nÃ y cá»±c ká»³ quan trá»ng trong cÃ¡c há»‡ thá»‘ng microservices, API Gateway, vÃ  dynamic load balancing.


	## ğŸš€ TrÆ°á»ng há»£p sá»­ dá»¥ng: 
		- API Gateway tá»± Ä‘á»™ng Ä‘á»‹nh tuyáº¿n request Ä‘áº¿n backend phÃ¹ há»£p. 
		- A/B Testing & Canary Deployment: Chuyá»ƒn traffic Ä‘áº¿n phiÃªn báº£n má»›i mÃ  khÃ´ng cáº§n downtime.
		- Tá»‘i Æ°u hiá»‡u suáº¥t & Load Balancing: Chuyá»ƒn hÆ°á»›ng request khi má»™t service quÃ¡ táº£i hoáº·c cháº¿t.
		- TÃ­ch há»£p vá»›i Service Discovery: Giao tiáº¿p linh hoáº¡t giá»¯a cÃ¡c microservices.


	## ğŸ† Lá»£i Ã­ch chÃ­nh: 
		- KhÃ´ng cáº§n restart á»©ng dá»¥ng khi thay Ä‘á»•i route.
		- Dá»… dÃ ng scale system mÃ  khÃ´ng giÃ¡n Ä‘oáº¡n dá»‹ch vá»¥.
		- Giáº£m downtime & tÄƒng resilience.




# CÃ¡ch triá»ƒn khai Routing Äá»™ng trong Java 
	

	## A. Sá»­ dá»¥ng Spring Cloud Gateway 
		Spring Cloud Gateway lÃ  giáº£i phÃ¡p máº¡nh máº½ thay tháº¿ Zuul, há»— trá»£ routing Ä‘á»™ng dá»±a trÃªn config hoáº·c runtime API. 
		
		
		### 	ğŸ›  Cáº¥u hÃ¬nh ban Ä‘áº§u (application.yml) 
					spring:
						cloud:
							gateway:
							routes:
								- id: user-service
								uri: lb://USER-SERVICE
								predicates:
									- Path=/users/**
								- id: order-service
								uri: lb://ORDER-SERVICE
								predicates:
									- Path=/orders/**

		### ğŸ›  Trong config nÃ y: 
			/users/** â†’ route Ä‘áº¿n USER-SERVICE 
			/orders/** â†’ route Ä‘áº¿n ORDER-SERVICE 
			lb:// â†’ sá»­ dá»¥ng Load Balancer Ä‘á»ƒ chá»n instance phÃ¹ há»£p. 
		
		

	
	
	## B. Thay Ä‘á»•i Routing Äá»™ng trong Runtime 
		Spring Cloud Gateway há»— trá»£ cáº­p nháº­t routing mÃ  khÃ´ng cáº§n restart báº±ng cÃ¡ch thay Ä‘á»•i Bean trong Java. 
			

		## ğŸ‘¨â€ğŸ’» Code táº¡o Route Dynamically 
		
				@Bean
				public RouteLocator customRouteLocator(RouteLocatorBuilder builder) {
					return builder.routes()
						.route("dynamic-service", r -> r.path("/dynamic/**")
							.uri("http://dynamic-service:8080"))
						.build();
				}
		
		
		## âœ… Náº¿u muá»‘n thay Ä‘á»•i route trong runtime? 
			DÃ¹ng Refreshable Route Configuration, thay Ä‘á»•i config tá»« Redis, Database, hoáº·c API Call. 
			
				
			### ğŸš€ Dynamic Route tá»« API 
					@RestController
					@RequestMapping("/routes")
					public class DynamicRouteController {
					
						private final RouteDefinitionLocator routeDefinitionLocator;
						private final RouteDefinitionWriter routeDefinitionWriter;
					
						public DynamicRouteController(RouteDefinitionLocator locator, RouteDefinitionWriter writer) {
							this.routeDefinitionLocator = locator;
							this.routeDefinitionWriter = writer;
						}
					
						@PostMapping("/add")
						public Mono<String> addRoute(@RequestBody RouteDefinition routeDefinition) {
							routeDefinitionWriter.save(Mono.just(routeDefinition)).subscribe();
							return Mono.just("âœ… Route added successfully!");
						}
					}
		
		
		
				ğŸ“Œ CÃ¡ch hoáº¡t Ä‘á»™ng:
					Nháº­n request API POST /routes/add vá»›i JSON cáº¥u hÃ¬nh route má»›i. 
					LÆ°u vÃ o Gateway mÃ  khÃ´ng cáº§n restart app.
					Há»— trá»£ hot-reload route ngay láº­p tá»©c. 



		##  C. Káº¿t há»£p vá»›i Service Discovery (Eureka) 
			Náº¿u há»‡ thá»‘ng dÃ¹ng Eureka Ä‘á»ƒ quáº£n lÃ½ microservices, báº¡n cÃ³ thá»ƒ tá»± Ä‘á»™ng cáº­p nháº­t route mÃ  khÃ´ng cáº§n config tay. 
				

			## ğŸ”§ Tá»± Ä‘á»™ng tÃ¬m vÃ  cáº­p nháº­t route
					@Bean
					public DiscoveryClientRouteDefinitionLocator discoveryClientRouteLocator(ReactiveDiscoveryClient discoveryClient) {
						return new DiscoveryClientRouteDefinitionLocator(discoveryClient);
					}
					
				ğŸ“Œ Há»‡ thá»‘ng sáº½ tá»± Ä‘á»™ng cáº­p nháº­t route má»—i khi cÃ³ service má»›i Ä‘Äƒng kÃ½ vÃ o Eureka.
				ğŸ‘‰ KhÃ´ng cáº§n restart â€“ khÃ´ng cáº§n chá»‰nh tay!
 


#  So sÃ¡nh vá»›i cÃ¡c phÆ°Æ¡ng phÃ¡p khÃ¡c 


CÃ´ng nghá»‡				Routing Ä‘á»™ng?		Há»— trá»£ Load Balancing? 		API Configurable?		TÃ­ch há»£p vá»›i Service Discovery?
Spring Cloud Gateway	âœ… CÃ³					âœ… CÃ³						âœ… CÃ³ API					âœ… CÃ³
Zuul 1 (Netflix)		âŒ KhÃ´ng				âœ… CÃ³						âŒ KhÃ´ng					âŒ KhÃ´ng
Nginx + Lua				âœ… CÃ³					âœ… CÃ³						âœ… CÃ³						âŒ KhÃ´ng
Envoy Proxy				âœ… CÃ³					âœ… CÃ³						âœ… CÃ³						âœ… CÃ³
				

ğŸ‘‰ Spring Cloud Gateway lÃ  lá»±a chá»n máº¡nh máº½ cho há»‡ thá»‘ng Java, vÃ¬: 
	Dá»… cáº¥u hÃ¬nh báº±ng API hoáº·c Config Server.
	Há»— trá»£ Load Balancing & Service Discovery.
	KhÃ´ng cáº§n thÃªm proxy nhÆ° Nginx/Envoy.

	
# Káº¿t luáº­n 
Routing Ä‘á»™ng lÃ  tá»‘i quan trá»ng trong cÃ¡c há»‡ thá»‘ng microservices.
Spring Cloud Gateway cho phÃ©p cáº¥u hÃ¬nh routing trong runtime mÃ  khÃ´ng cáº§n restart.
Káº¿t há»£p vá»›i Service Discovery (Eureka) giÃºp routing tá»± Ä‘á»™ng thÃ­ch nghi vá»›i mÃ´i trÆ°á»ng Ä‘á»™ng.

ğŸ’¡ BÆ°á»›c tiáº¿p theo?
TÃ­ch há»£p thÃªm JWT Authorization + Rate Limiting vÃ o Gateway Ä‘á»ƒ báº£o máº­t há»‡ thá»‘ng!


</pre><a id='backBottom' href='../java-learning-list.html' style='display:none;'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><button onclick='toggleTheme()'>ğŸŒ™ Chuyá»ƒn giao diá»‡n</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>