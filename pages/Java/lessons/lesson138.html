<html><head><title>Lesson 138 == Cluster ‚Üí Distributed System ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../java-learning-list.html'>üîô Quay l·∫°i danh s√°ch</a><br><h1>Lesson 138 -- Cluster ‚Üí Distributed System -//</h1><pre># Kh√°i ni·ªám 
	Cluster l√† m·ªôt t·∫≠p h·ª£p c√°c node (server/m√°y t√≠nh) ho·∫°t ƒë·ªông nh∆∞ m·ªôt h·ªá th·ªëng th·ªëng nh·∫•t.
		-C√°c node giao ti·∫øp qua m·∫°ng
		-Th∆∞·ªùng d√πng ƒë·ªÉ x·ª≠ l√Ω workload qu√° l·ªõn cho m·ªôt m√°y duy nh·∫•t
		-C·∫ßn ph·ªëi h·ª£p gi·ªØa c√°c node ƒë·ªÉ duy tr√¨ t√≠nh to√†n v·∫πn, hi·ªáu nƒÉng, v√† d·ª± ph√≤ng

	
		V√≠ d·ª•:
		
			- Cluster Elasticsearch: nhi·ªÅu node l∆∞u tr·ªØ v√† t√¨m ki·∫øm d·ªØ li·ªáu
			- Cluster Hadoop/Spark: chia nh·ªè job ƒë·ªÉ x·ª≠ l√Ω ph√¢n t√°n
			- Kubernetes Cluster: ƒëi·ªÅu ph·ªëi container tr√™n nhi·ªÅu node
		
		
# 	üîß II. T·ª´ Cluster ‚Üí Distributed System 
		Khi cluster ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ gi·∫£i quy·∫øt c√°c v·∫•n ƒë·ªÅ v·ªÅ ph√¢n t√°n, n√≥ tr·ªü th√†nh m·ªôt h·ªá th·ªëng ph√¢n t√°n (distributed system). 

	## C√°c m·ª•c ti√™u c·ªßa Distributed System: 
| M·ª•c ti√™u                       | M√¥ t·∫£                                    |
| ------------------------------ | ---------------------------------------- |
| **Scalability**                | TƒÉng s·ªë node ƒë·ªÉ tƒÉng nƒÉng l·ª±c            |
| **Fault Tolerance**            | Node ch·∫øt kh√¥ng l√†m h·ªá th·ªëng ch·∫øt        |
| **High Availability (HA)**     | Lu√¥n s·∫µn s√†ng, kh√¥ng downtime            |
| **Data Consistency**           | D·ªØ li·ªáu ph·∫£i ƒë√∫ng d√π x·ª≠ l√Ω t·ª´ nhi·ªÅu node |
| **Concurrency & Partitioning** | Chia kh·ªëi l∆∞·ª£ng, x·ª≠ l√Ω song song         |




# üß† III. C√°c v·∫•n ƒë·ªÅ c·ªët l√µi c·ªßa h·ªá th·ªëng ph√¢n t√°n 

	## 1. CAP Theorem 
		B·∫°n kh√¥ng th·ªÉ c√≥ t·∫•t c·∫£ 3:
			Consistency, Availability, Partition tolerance ‚Äì b·∫°n ch·ªâ ch·ªçn ƒë∆∞·ª£c 2.
	
	
| Combination                            | V√≠ d·ª•                              |
| -------------------------------------- | ---------------------------------- |
| CP (strong consistency)                | HBase, MongoDB (with replica sync) |
| AP (available, not strict consistency) | Cassandra, DynamoDB                |
| CA (ch·ªâ n·∫øu kh√¥ng c√≥ partition)        | RDBMS truy·ªÅn th·ªëng (tr√™n m·ªôt node) |
	
	
	## 2. Consensus Problem 
		
		Khi c√≥ nhi·ªÅu node, l√†m sao ƒë·ªìng thu·∫≠n v·ªÅ tr·∫°ng th√°i ho·∫∑c quy·∫øt ƒë·ªãnh
		D√πng c√°c thu·∫≠t to√°n:
			- Paxos (kh√≥ hi·ªÉu, √≠t d√πng tr·ª±c ti·∫øp)
			- Raft (d·ªÖ h∆°n, d√πng trong etcd, Consul)
			- ZAB (ZooKeeper Atomic Broadcast ‚Äì trong Zookeeper)	
	
	
	## 	3. Leader Election
		- M·ªôt s·ªë h·ªá th·ªëng c·∫ßn 1 node "leader" ƒë·ªÉ ƒëi·ªÅu ph·ªëi (v√≠ d·ª•: Kafka controller, Zookeeper master)
		- Ph·∫£i c√≥ c∆° ch·∫ø b·∫ßu l·∫°i leader khi node ch·∫øt
	
	
	
	## 4. Partitioning (Sharding)
	
		- Chia d·ªØ li·ªáu ra c√°c node
		- C√≥ th·ªÉ chia theo key hash, range, geolocation
	
	
	
	## 5. Replication
	
		Duplicated d·ªØ li·ªáu ·ªü nhi·ªÅu node ‚Üí tƒÉng HA v√† read throughput
		C∆° ch·∫ø replication:
			-Master-Slave
			-Multi-Leader
			-Leaderless (quorum-based)
# üîÑ IV. M√¥ h√¨nh ph·ªï bi·∫øn trong Distributed Cluster	
	
| Ki·ªÉu h·ªá th·ªëng     | C∆° ch·∫ø ph√¢n t√°n                                 |
| ----------------- | ----------------------------------------------- |
| **Elasticsearch** | Shard + Replica + Coordination node             |
| **Kafka**         | Partition + Broker + Zookeeper/Quorum           |
| **Hadoop/Spark**  | Master ‚Üí Worker ‚Üí Task Executor                 |
| **Cassandra**     | Ring-based, peer-to-peer, eventually consistent |
| **Kubernetes**    | Control plane (etcd, scheduler) + worker node   |

	
# üß† V. Design Challenge c·∫•p ƒë·ªô senior 	
	
	
üî• 1. Node Down ‚Äì Kh√¥ng ·∫£nh h∆∞·ªüng
	- Detect node ch·∫øt (heartbeat, gossip)
	- T·ª± ƒë·ªông reassign task / migrate data
	- Leader Election (Raft)
	
üî• 2. Data Inconsistency ‚Äì Ph·∫£i ch·ªçn

	-Strong consistency: m·ªçi write ƒë·ªÅu ƒëi qua 1 node duy nh·∫•t ‚Üí ch·∫≠m h∆°n
	-Eventual consistency: ch·∫•p nh·∫≠n delay nh∆∞ng throughput cao h∆°n

üî• 3. Network Partition ‚Äì kh√¥ng ai bi·∫øt ai s·ªëng/ch·∫øt
	- D√πng quorum: majority vote (n/2 + 1) ‚Üí ƒë·∫£m b·∫£o ti·∫øn tr√¨nh kh√¥ng b·ªã split-brain


üî• 4. Distributed Locking 

	- Kh√¥ng c√≥ synchronized ·ªü nhi·ªÅu m√°y
	- D√πng Zookeeper, etcd, ho·∫∑c Redlock tr√™n Redis

# üì¶ VI. Pattern & Tools th·ª±c t·∫ø
| Pattern / Tool                         | M·ª•c ƒë√≠ch                                    |
| -------------------------------------- | ------------------------------------------- |
| **Service Discovery (Consul, etcd)**   | Bi·∫øt node n√†o ƒëang s·ªëng                     |
| **Distributed Lock (Zookeeper, etcd)** | Tr√°nh race ·ªü nhi·ªÅu node                     |
| **Task Queue (Kafka, RabbitMQ)**       | Stream/Queue gi·ªØa service                   |
| **Replication & Sharding**             | Scale data horizontally                     |
| **Gossip Protocol**                    | G·ª≠i th√¥ng tin gi·ªØa node m√† kh√¥ng c·∫ßn master |
| **Circuit Breaker**                    | C·∫Øt k·∫øt n·ªëi khi service h·ªèng                |
| **Bulkhead**                           | C√¥ l·∫≠p failure kh√¥ng lan r·ªông               |
| **Sidecar Pattern (K8s)**              | ƒê·∫∑t c√°c agent logic c·∫°nh service            |


# üöÄ VII. Case Study: Kafka Cluster


		M√¥ h√¨nh:
			- Broker (node): l∆∞u tr·ªØ d·ªØ li·ªáu ph√¢n m·∫£nh (partition)
			- Topic: chia th√†nh nhi·ªÅu partition
			- Partition: m·ªói partition c√≥ leader v√† replica
			- Zookeeper/quorum: qu·∫£n l√Ω metadata (kafka 3.0+ d√πng Raft)
		Properties:
			- High throughput: ghi v√† ƒë·ªçc song song t·ª´ nhi·ªÅu partition
			- Fault-tolerant: c√≥ replica
			- Consumer group: chia t·∫£i consume

# ‚úÖ T·ªïng k·∫øt
| Kh√≠a c·∫°nh                | M√¥ t·∫£                                                                                   |
| ------------------------ | --------------------------------------------------------------------------------------- |
| **Cluster**              | T·∫≠p h·ª£p c√°c node ho·∫°t ƒë·ªông c√πng nhau                                                    |
| **Distributed System**   | Cluster c√≥ kh·∫£ nƒÉng t·ª± ph·ªëi h·ª£p, chia t·∫£i, ƒë·∫£m b·∫£o consistency v√† availability          |
| **V·∫•n ƒë·ªÅ ch√≠nh**         | CAP, consensus, leader election, sharding, replication                                  |
| **Y√™u c·∫ßu k·ªπ s∆∞ senior** | Thi·∫øt k·∫ø h·ªá th·ªëng bi·∫øt fail nh∆∞ th·∫ø n√†o, fallback ra sao, scale theo chi·ªÅu ngang ra sao |




</pre><a id='backBottom' href='../java-learning-list.html' style='display:none;'>üîô Quay l·∫°i danh s√°ch</a><br><button onclick='toggleTheme()'>üåô Chuy·ªÉn giao di·ªán</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>