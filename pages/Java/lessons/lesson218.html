<html><head><title>Lesson 218 == B√†i 22 ‚Äî Functional Resilience Testing & Chaos Engineering ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../java-learning-list.html'>üîô Quay l·∫°i danh s√°ch</a><br><h1>Lesson 218 -- B√†i 22 ‚Äî Functional Resilience Testing & Chaos Engineering -//</h1><pre>
	M·ª•c ti√™u: Test & ph√° c√°c policy (retry, timeout, circuit breaker‚Ä¶) d∆∞·ªõi d·∫°ng pipeline thu·∫ßn h√†m ƒë·ªÉ ƒë·∫£m b·∫£o h·ªá th·ªëng kh√¥ng b·ªã ‚Äúdrift resilience‚Äù theo th·ªùi gian.



# 1. V·∫§N ƒê·ªÄ ‚Äî ‚ÄúKH√îNG TEST RESILIENCE L√Ä KH√îNG C√ì RESILIENCE‚Äù 

	Resilience kh√¥ng ph·∫£i th·ª© b·∫°n k√≠ch ho·∫°t b·∫±ng @Retryable r·ªìi c·∫ßu nguy·ªán.

	V·∫•n ƒë·ªÅ th·ª±c t·∫ø:

		Retry storm ‚Üí g√¢y s·∫≠p h·ªá th·ªëng thay v√¨ b·∫£o v·ªá
		Circuit breaker fail-open ho·∫∑c fail-close
		Timeout sai ‚Üí ngh·∫Ωn thread pool
		Chaos input ‚Üí pipeline ·ª©ng x·ª≠ kh√¥ng ·ªïn ƒë·ªãnh
		Config GitOps thay ƒë·ªïi ‚Üí regression kh√¥ng ph√°t hi·ªán
		
	C√°ch ti·∫øp c·∫≠n functional gi√∫p test d·ªÖ h∆°n g·∫•p 10 l·∫ßn, v√¨ t·∫•t c·∫£ resilience ch·ªâ l√† h√†m b·ªçc h√†m ‚Üí kh√¥ng c√≥ hidden state, kh√¥ng c√≥ AOP magic.


# 2. TEST M√î PH·ªéNG LATENCY & FAILURE

	## Ta c·∫ßn m·ªôt function gi·∫£ g√¢y l·ªói:

Supplier<String> unstableFn = new Supplier<>() {
    int calls = 0;

    @Override
    public String get() {
        calls++;
        if (calls <= 2) throw new RuntimeException("fail");
        return "OK";
    }
};

	## Apply retry policy:

var fn = Policy.retry(3).apply(unstableFn);

assertEquals("OK", fn.get());



# 3. CHAOS TEST: M√î PH·ªéNG ‚ÄúRETRY STORM‚Äù
Senior ph·∫£i bi·∫øt m√¥ ph·ªèng t√¨nh hu·ªëng x·∫•u nh·∫•t:
khi API downstream ch·∫øt ‚Üí retry x n request ‚Üí cluster choke ‚Üí t·ª± s√°t t·∫≠p th·ªÉ.


	## V√≠ d·ª• t·∫°o chaos function:
	
Supplier<String> chaosFn = () -> {
    try { Thread.sleep(500); } catch (InterruptedException ignored) {}
    throw new RuntimeException("Chaos fail");
};
	
	
	
	## Run nhi·ªÅu task song song: 	
	
var retry = Policy.retry(5);
var safe = retry.apply(chaosFn);

IntStream.range(0, 100)
         .parallel()
         .forEach(i -> {
             assertThrows(RuntimeException.class, safe::get);
         });
	
	
	
	B·∫°n ƒëo ƒë∆∞·ª£c: 
	
		total attempts
		latency spike
		thread starvation	
	
	‚Üí ƒê√¢y l√† c√°ch ki·ªÉm tra retry storm tr∆∞·ªõc khi service th·ª±c s·ª± b·ªã ph√°.




# 4. TEST TIMEOUT CHU·∫®N ‚Äî KH√îNG R√äU, KH√îNG RANDOM
	Functional timeout policy cho ph√©p test ƒë∆°n gi·∫£n:

var timeout = Policy.timeout(Duration.ofMillis(100));

var slow = timeout.apply(() -> {
    Thread.sleep(300);
    return "Done";
});

assertThrows(TimeoutException.class, slow::get);

	- Kh√¥ng c√≥ randomness.
	- Kh√¥ng event-driven race condition.
	- Kh√¥ng c·∫ßn Spring TestContainer ho·∫∑c mock server.
	Pure function ‚Üí pure result.


# 5. TEST CIRCUIT BREAKER ‚Äî X√ÅC ƒê·ªäNH TR·∫†NG TH√ÅI

	Do circuit breaker c·ªßa b·∫°n c√≥ state nh·ªè (AtomicReference), b·∫°n test trait r√µ r√†ng:

var cb = Policy.circuitBreaker(3);

Supplier<String> fail = () -> { throw new RuntimeException(); };

var wrapped = cb.apply(fail);

assertThrows(RuntimeException.class, wrapped::get);
assertThrows(RuntimeException.class, wrapped::get);
assertThrows(RuntimeException.class, wrapped::get);

// L·∫ßn th·ª© 4 ‚Üí ƒë√£ Open
assertThrows(RuntimeException.class, wrapped::get);

assertEquals(State.OPEN, cb.state().get());

	Nh√¨n th·∫≥ng v√†o s·ª± th·∫≠t:
		N·∫øu CB kh√¥ng chuy·ªÉn tr·∫°ng th√°i ƒë√∫ng ‚Üí b·∫°n ƒëang d√πng CB gi·∫£.



# 6. PROPERTY-BASED TESTING CHO RESILIENCE
	ƒê√¢y l√† level cao ‚Äî ki·ªÉm th·ª≠ d·ª±a tr√™n t√≠nh ch·∫•t thay v√¨ input c·ªë ƒë·ªãnh.

	V√≠ d·ª• t√≠nh ch·∫•t c·ªßa retry:

		V·ªõi m·ªçi d√£y failure < retry.count
		‚Üí function cu·ªëi c√πng ph·∫£i th√†nh c√¥ng
		
		V·ªõi m·ªçi d√£y failure > retry.count
		‚Üí function ph·∫£i fail

	D√πng jqwik ho·∫∑c QuickTheories:

@Property
void retryPropertyTest(@ForAll("failureCount") int fails) {
    var retry = Policy.retry(3);

    Supplier<String> fn = failingSupplier(fails);

    var wrapped = retry.apply(fn);

    if (fails <= 3) {
        assertEquals("OK", wrapped.get());
    } else {
        assertThrows(RuntimeException.class, wrapped::get);
    }
}


B·∫°n kh√¥ng test 5 case.
B·∫°n test h√†ng ngh√¨n bi·∫øn th·ªÉ t·ª± ƒë·ªông.
ƒê√¢y l√† resilience ƒë√∫ng nghƒ©a khoa h·ªçc.

# 7. CHAOS ENGINEERING ‚Äî PIPELINE LEVEL (KH√îNG HACK NH∆Ø LINUX KILL -9)

	Chaos ·ªü functional pipeline nh·∫π nh√†ng nh∆∞ng c·ª±c ch√≠nh x√°c:

	Inject latency
	Inject random fault
	Inject burst traffic
	Inject time skew
	Inject random state corruption (cho CB)

	## V√≠ d·ª• inject random failure:

Supplier<String> chaos = () -> {
    if (ThreadLocalRandom.current().nextInt(10) < 3)
        throw new RuntimeException("random chaos");
    return "OK";
};


	## Apply to√†n pipeline:
var p = compose(
        Policy.retry(5),
        Policy.timeout(Duration.ofMillis(200)),
        Policy.circuitBreaker(4)
);

var fn = p.apply(chaos);

for (int i = 0; i < 100; i++) {
    try { fn.get(); } catch (Exception ignored) {}
}

		CB m·ªü ƒë√∫ng l√∫c
		Retry kh√¥ng v∆∞·ª£t ng∆∞·ª°ng
		Timeout kh√¥ng ƒÉn v√†o CPU
		Pipeline ·ªïn ƒë·ªãnh theo l√Ω thuy·∫øt

	Senior ph·∫£i nh√¨n v√†o log ƒë·ªÉ x√°c nh·∫≠n resilience kh√¥ng drift khi ch·∫°y chaos.


# 8. ENTERPRISE: RESILIENCE REGRESSION-PROOF

Th·ª±c t·∫ø ƒëau nh·∫•t l√†:
	config GitOps thay ƒë·ªïi ‚Üí resilience pipeline √¢m th·∫ßm v·ª° ‚Üí production m·ªõi ph√°t hi·ªán.


	1) Test suite ch·∫°y khi CI pull policy.json
	2) Chaos suite ch·∫°y m·ªói tu·∫ßn t·ª± ƒë·ªông
	3) Property-based test ch·∫°y m·ªói l·∫ßn update policy parser
	4) Chaos in staging ƒë·ªÉ verify pipeline kh√¥ng b·ªã bug do merge code

	K·∫øt qu·∫£:
		Resilience pipeline b·∫•t bi·∫øn, c√≥ b·∫±ng ch·ª©ng test, kh√¥ng drift theo th·ªùi gian.





Functional resilience d·ªÖ test, d·ªÖ ph√°, v√† d·ªÖ ch·ª©ng minh an to√†n h∆°n b·∫•t k·ª≥ framework annotation/AOP n√†o ‚Äî v√¨ m·ªçi th·ª© ch·ªâ l√† h√†m, kh√¥ng c√≥ ‚Äúma thu·∫≠t




</pre><a id='backBottom' href='../java-learning-list.html' style='display:none;'>üîô Quay l·∫°i danh s√°ch</a><br><button onclick='toggleTheme()'>üåô Chuy·ªÉn giao di·ªán</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>