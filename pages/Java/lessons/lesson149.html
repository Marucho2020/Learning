<html><head><title>Lesson 149 == Decorator pattern ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../java-learning-list.html'>üîô Quay l·∫°i danh s√°ch</a><br><h1>Lesson 149 -- Decorator pattern -//</h1><pre>
# üìå 1. Decorator Pattern l√† g√¨?
	Decorator Pattern l√† m·∫´u thi·∫øt k·∫ø thu·ªôc nh√≥m structural, cho ph√©p th√™m h√†nh vi (behavior) v√†o m·ªôt object m√† kh√¥ng thay ƒë·ªïi c·∫•u tr√∫c ho·∫∑c class g·ªëc.

	## C·ªët l√µi:
		Kh√¥ng s·ª≠a class g·ªëc
		Kh√¥ng k·∫ø th·ª´a ‚Üí m√† bao b·ªçc (wrap) object g·ªëc
		C√≥ th·ªÉ x·∫øp ch·ªìng nhi·ªÅu l·ªõp Decorator

# üß† 2. C·∫•u tr√∫c chu·∫©n
| Th√†nh ph·∫ßn          | Vai tr√≤                            |
| ------------------- | ---------------------------------- |
| `Component`         | Interface/abstract class chung     |
| `ConcreteComponent` | Logic g·ªëc                          |
| `Decorator`         | L·ªõp tr·ª´u t∆∞·ª£ng bao b·ªçc `Component` |
| `ConcreteDecorator` | Th√™m ch·ª©c nƒÉng m·ªõi                 |

// Component
interface DataSource {
    void write(String data);
    String read();
}

// ConcreteComponent
class FileDataSource implements DataSource {
    public void write(String data) {
        System.out.println("Writing to file: " + data);
    }

    public String read() {
        return "Data from file";
    }
}

// Decorator base class
class DataSourceDecorator implements DataSource {
    protected DataSource wrappee;

    public DataSourceDecorator(DataSource source) {
        this.wrappee = source;
    }

    public void write(String data) {
        wrappee.write(data);
    }

    public String read() {
        return wrappee.read();
    }
}

// Concrete Decorator
class EncryptionDecorator extends DataSourceDecorator {
    public EncryptionDecorator(DataSource source) {
        super(source);
    }

    public void write(String data) {
        String encrypted = "ENCRYPTED(" + data + ")";
        super.write(encrypted);
    }

    public String read() {
        return "DECRYPTED(" + super.read() + ")";
    }
}


DataSource file = new FileDataSource();
DataSource encrypted = new EncryptionDecorator(file);
encrypted.write("Hello");



| M·ª•c ti√™u                               | Gi·∫£i th√≠ch                                    |
| -------------------------------------- | --------------------------------------------- |
| **M·ªü r·ªông ch·ª©c nƒÉng m√† kh√¥ng k·∫ø th·ª´a** | K·∫ø th·ª´a d·ªÖ b·ªã c·ª©ng, b·ªã gi·ªõi h·∫°n trong 1 c·∫•p   |
| **TƒÉng t√≠nh composable**               | C√≥ th·ªÉ x·∫øp nhi·ªÅu decorator                    |
| **T√°ch bi·ªát concern**                  | Kh√¥ng tr·ªôn logic g·ªëc v√† logic ph·ª• v√†o 1 class |
| **Tu√¢n th·ªß Open/Closed Principle**     | M·ªü r·ªông b·∫±ng c√°ch wrap, kh√¥ng s·ª≠a             |


# üì¶ 4. Decorator vs Inheritance

| Inheritance         | Decorator                  |
| ------------------- | -------------------------- |
| D√πng `extends`      | D√πng `has-a` (composition) |
| M·ªôt chi·ªÅu           | C√≥ th·ªÉ l·ªìng nhi·ªÅu l·ªõp      |
| Kh√≥ thay ƒë·ªïi th·ª© t·ª± | T√πy bi·∫øn theo runtime      |
| C·ª©ng, √≠t linh ho·∫°t  | R·∫•t m·ªÅm, d·ªÖ m·ªü r·ªông        |


# ‚ö° 5. ·ª®ng d·ª•ng th·ª±c t·∫ø trong Java

	A. java.io l√† v√≠ d·ª• kinh ƒëi·ªÉn:
	
InputStream in = new BufferedInputStream(
                    new GZIPInputStream(
                        new FileInputStream("data.gz")
                    )
                );

		M·ªói stream wrap stream tr∆∞·ªõc ƒë√≥, v√† th√™m h√†nh vi nh∆∞ buffering, decompress, encrypt...



	B. Spring Framework

| V√≠ d·ª•                       | Gi·∫£i th√≠ch                           |
| --------------------------- | ------------------------------------ |
| `HandlerInterceptor`        | Decorator cho request flow           |
| `BeanPostProcessor`         | C√≥ th·ªÉ d√πng ƒë·ªÉ wrap bean (decorator) |
| `HttpServletRequestWrapper` | Decorator cho request object         |




	C. Logger 

interface Logger {
    void log(String msg);
}

class ConsoleLogger implements Logger {
    public void log(String msg) {
        System.out.println(msg);
    }
}

class TimeLoggerDecorator implements Logger {
    private Logger logger;

    public TimeLoggerDecorator(Logger logger) {
        this.logger = logger;
    }

    public void log(String msg) {
        logger.log("[" + System.currentTimeMillis() + "] " + msg);
    }
}



# ‚ùó 6. Anti-pattern & khi kh√¥ng n√™n d√πng

| T√¨nh hu·ªëng                          | V√¨ sao n√™n tr√°nh Decorator                             |
| ----------------------------------- | ------------------------------------------------------ |
| Qu√° nhi·ªÅu l·ªõp decorator             | G√¢y r·ªëi, kh√≥ trace bug                                 |
| D√πng ƒë·ªÉ x·ª≠ l√Ω logic ch√≠nh           | Decorator **kh√¥ng n√™n ch·ª©a business logic ch√≠nh**      |
| Kh√¥ng th·ªëng nh·∫•t gi·ªØa c√°c decorator | Decorator n√™n tu√¢n th·ªß interface ch·∫∑t ch·∫Ω              |
| Decorator ph·ª• thu·ªôc v√†o nhau        | Decorator ph·∫£i ƒë·ªôc l·∫≠p, kh√¥ng d·ª±a v√†o th·ª© t·ª± c·ª©ng nh·∫Øc |


# üß† 7. Level senior: t∆∞ duy s·ª≠ d·ª•ng Decorator

	D√πng ƒë·ªÉ x·ª≠ l√Ω cross-cutting concerns nh∆∞ log, metric, cache, security...
	
	ƒê·∫∑c bi·ªát h·ªØu d·ª•ng cho middleware pipeline, gi·ªëng nh∆∞ chain of responsibilities
	Bi·∫øt vi·∫øt Decorator nh∆∞ng c≈©ng bi·∫øt khi n√†o n√™n d·ª´ng, n·∫øu c·∫ßn shared state ‚Üí Decorator c√≥ th·ªÉ kh√¥ng ph√π h·ª£p


# üß† 8. So s√°nh Decorator v·ªõi Proxy / AOP
| Pattern       | M·ª•c ti√™u                                              |
| ------------- | ----------------------------------------------------- |
| **Decorator** | Th√™m ch·ª©c nƒÉng m·ªõi (log, cache, encrypt...)           |
| **Proxy**     | Ki·ªÉm so√°t truy c·∫≠p, u·ª∑ quy·ªÅn                          |
| **AOP**       | T√°ch cross-cutting logic ra ho√†n to√†n kh·ªèi code ch√≠nh |

	‚Üí Decorator l√†m r√µ m·ªëi quan h·ªá l·ªõp, AOP th√¨ ·∫©n ho√†n to√†n logic ph·ª•.

| ƒêi·ªÉm then ch·ªët                                          | Di·ªÖn gi·∫£i                                    |
| ------------------------------------------------------- | -------------------------------------------- |
| Decorator d√πng composition ƒë·ªÉ th√™m ch·ª©c nƒÉng            | Kh√¥ng c·∫ßn k·∫ø th·ª´a class g·ªëc                  |
| Tu√¢n th·ªß OCP, t√°ch logic ph·ª• kh·ªèi logic ch√≠nh           | ƒê∆∞·ª£c d√πng nhi·ªÅu trong I/O, logging, security |
| C√≥ th·ªÉ x·∫øp ch·ªìng nhi·ªÅu l·ªõp                              | R·∫•t linh ho·∫°t, d·ªÖ m·ªü r·ªông                    |
| D·ªÖ b·ªã l·∫°m d·ª•ng n·∫øu kh√¥ng ki·ªÉm so√°t th·ª© t·ª± ho·∫∑c m·ª•c ƒë√≠ch | Ph·∫£i gi·ªØ decorator ƒë∆°n nhi·ªám, d·ªÖ trace       |




</pre><a id='backBottom' href='../java-learning-list.html' style='display:none;'>üîô Quay l·∫°i danh s√°ch</a><br><button onclick='toggleTheme()'>üåô Chuy·ªÉn giao di·ªán</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>