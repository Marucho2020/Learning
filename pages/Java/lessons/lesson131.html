<html><head><title>Lesson 131 == Atomic Integer ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../java-learning-list.html'>üîô Quay l·∫°i danh s√°ch</a><br><h1>Lesson 131 -- Atomic Integer -//</h1><pre># Kh√°i ni·ªám 
	## V·∫•n ƒë·ªÅ g·ªëc: V√¨ sao c·∫ßn AtomicInteger? 
		Trong Java, c√°c ph√©p to√°n tr√™n int kh√¥ng nguy√™n t·ª≠ (non-atomic).
		
			int counter = 0;
			counter++; // NOT atomic

		Ph√©p counter++ th·ª±c ch·∫•t l√† 3 b∆∞·ªõc: 
			load counter ‚Üí tƒÉng ‚Üí l∆∞u l·∫°i


		‚Üí N·∫øu nhi·ªÅu thread c√πng ch·∫°y counter++, th√¨ k·∫øt qu·∫£ c√≥ th·ªÉ b·ªã m·∫•t c·∫≠p nh·∫≠t (race condition).
		
# ‚úÖ 2. AtomicInteger gi·∫£i quy·∫øt g√¨? 
			
	AtomicInteger cung c·∫•p c√°c ph√©p to√°n nguy√™n t·ª≠ (atomic) tr√™n int m√† kh√¥ng c·∫ßn d√πng synchronized.

		AtomicInteger counter = new AtomicInteger(0);
		counter.incrementAndGet(); // ++counter, atomic
		‚Üí Kh√¥ng c·∫ßn lock, v·∫´n thread-safe.


# ‚úÖ 3. C∆° ch·∫ø b√™n trong (r·∫•t quan tr·ªçng)


	## üîß AtomicInteger d√πng hardware-level CAS (Compare-And-Swap) th√¥ng qua Unsafe API c·ªßa JVM.
		V√≠ d·ª• (ƒë∆°n gi·∫£n h√≥a):

while (true) {
    int old = value;
    int newVal = old + 1;
    if (compareAndSwap(old, newVal)) break;
}

		‚Üí N·∫øu value b·ªã thay ƒë·ªïi b·ªüi thread kh√°c, CAS s·∫Ω th·∫•t b·∫°i v√† th·ª≠ l·∫°i (spin loop).

	üîπ compareAndSwap l√† atomic hardware instruction (tr√™n CPU nh∆∞ LOCK CMPXCHG x86)


# ‚úÖ 4. C√°c ph∆∞∆°ng th·ª©c quan tr·ªçng

| Method                          | M√¥ t·∫£                                                            |
| ------------------------------- | ---------------------------------------------------------------- |
| `get()`                         | Tr·∫£ v·ªÅ gi√° tr·ªã hi·ªán t·∫°i                                          |
| `set(int newValue)`             | G√°n gi√° tr·ªã (kh√¥ng ƒë·∫£m b·∫£o memory visibility n·∫øu ko c√≥ volatile) |
| `getAndIncrement()`             | Tr·∫£ v·ªÅ r·ªìi ++ (postfix)                                          |
| `incrementAndGet()`             | ++ r·ªìi tr·∫£ v·ªÅ (prefix)                                           |
| `compareAndSet(expect, update)` | N·∫øu gi√° tr·ªã hi·ªán t·∫°i == `expect`, th√¨ g√°n `update` (atomic)      |
| `getAndUpdate(UnaryOperator)`   | Apply h√†m custom (nh∆∞ng v·∫´n atomic)                              |


# ‚úÖ 5. ∆Øu ƒëi·ªÉm 

	Hi·ªáu nƒÉng cao h∆°n synchronized, v√¨ kh√¥ng block
	Tr√°nh context switch
	Ph√π h·ª£p cho c√°c bi·∫øn ƒë·∫øm (counter, ID generator, l∆∞·ª£t truy c·∫≠p‚Ä¶)



# ‚ö†Ô∏è 6. C·∫°m b·∫´y & hi·ªÉu sai ph·ªï bi·∫øn 

	## ‚ùå D√πng AtomicInteger nh∆∞ng v·∫´n g·∫∑p race condition?
	
	## ‚ùå V√≠ d·ª• sai: 
if (atomic.get() < LIMIT) {
    atomic.incrementAndGet(); // ‚ùå kh√¥ng ƒë·ªìng b·ªô v·ªõi ƒëi·ªÅu ki·ªán
}

	‚Üí TO√ÄN B·ªò ƒëi·ªÅu ki·ªán + h√†nh ƒë·ªông ph·∫£i atomic, ch·ª© kh√¥ng ch·ªâ ri√™ng increment



	## ‚úÖ ƒê√∫ng: 
	while (true) {
    int val = atomic.get();
    if (val >= LIMIT) break;
    if (atomic.compareAndSet(val, val + 1)) break;
}




	## ‚ùå D√πng AtomicInteger ƒë·ªÉ thay th·∫ø m·ªçi synchronized logic ‚Üí design anti-pattern
	B·∫°n ch·ªâ n√™n d√πng AtomicInteger cho c√°c bi·∫øn ƒë·ªôc l·∫≠p, kh√¥ng d√πng n√≥ nh∆∞ gi·∫£i ph√°p cho to√†n b·ªô shared state.
	
	## ‚ùå Hi·ªÉu nh·∫ßm r·∫±ng AtomicInteger "lock-free" = "fast" 
			CAS th·∫•t b·∫°i qu√° nhi·ªÅu s·∫Ω khi·∫øn ch∆∞∆°ng tr√¨nh spin v√¥ h·∫°n (live-lock) ‚Üí c√≤n t·ªá h∆°n synchronized.

		‚Üí Khi contention cao, c√≥ khi synchronized hi·ªáu qu·∫£ h∆°n Atomic*.



# ‚úÖ 7. Khi n√†o n√™n d√πng AtomicInteger 
	

| Tr∆∞·ªùng h·ª£p                          | C√≥ n√™n d√πng?                                                           |
| ----------------------------------- | ---------------------------------------------------------------------- |
| ƒê·∫øm s·ªë l∆∞·ª£t truy c·∫≠p                | ‚úÖ R·∫•t ph√π h·ª£p                                                          |
| Sinh ID duy nh·∫•t (concurrent)       | ‚úÖ                                                                      |
| Ki·ªÉm so√°t s·ªë l∆∞·ª£ng thread ƒëang ch·∫°y | ‚úÖ                                                                      |
| Thay th·∫ø lock cho object ph·ª©c t·∫°p   | ‚ùå Kh√¥ng ‚Äì n√™n d√πng `ReentrantLock`                                     |
| C·∫≠p nh·∫≠t nhi·ªÅu bi·∫øn c√πng l√∫c        | ‚ùå Kh√¥ng d√πng `Atomic*` ri√™ng l·∫ª ‚Äì n√™n d√πng `AtomicReference` ho·∫∑c lock |


# ‚úÖ 8. Bonus: LongAdder vs AtomicInteger 
	Trong c√°c ·ª©ng d·ª•ng high-throughput nh∆∞ metric logging (e.g., Micrometer), AtomicInteger v·∫´n c√≥ th·ªÉ g√¢y bottleneck, v√¨ t·∫•t c·∫£ thread ghi v√†o 1 bi·∫øn ‚Üí false sharing. 
	
	LongAdder (Java 8+) sinh ra ƒë·ªÉ gi·∫£i quy·∫øt: 
		D√πng nhi·ªÅu cell b√™n d∆∞·ªõi ‚Üí gi·∫£m contention
		C·ªông d·ªìn l·∫°i khi sum()



# ‚úÖ K·∫øt lu·∫≠n 

	AtomicInteger l√† c√¥ng c·ª• c·ª±c m·∫°nh n·∫øu b·∫°n bi·∫øt gi·ªõi h·∫°n c·ªßa n√≥
	ƒê·ª´ng l·∫°m d·ª•ng CAS. Ch·ªâ d√πng khi:
		D·ªØ li·ªáu ƒë∆°n gi·∫£n
		Kh√¥ng c√≥ li√™n k·∫øt ph·ª©c t·∫°p gi·ªØa nhi·ªÅu bi·∫øn
		
	N·∫øu c·∫ßn logic ph·ª©c t·∫°p: d√πng StampedLock, ReentrantLock, ho·∫∑c VarHandle (Java 9+)

</pre><a id='backBottom' href='../java-learning-list.html' style='display:none;'>üîô Quay l·∫°i danh s√°ch</a><br><button onclick='toggleTheme()'>üåô Chuy·ªÉn giao di·ªán</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>