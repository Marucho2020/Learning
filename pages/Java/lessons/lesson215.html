<html><head><title>Lesson 215 == Observability Functional Style ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../java-learning-list.html'>üîô Quay l·∫°i danh s√°ch</a><br><h1>Lesson 215 -- Observability Functional Style -//</h1><pre>
# 1. V·∫§N ƒê·ªÄ
	Trong Java truy·ªÅn th·ªëng:
	
		Logging d√πng logger.info(...) ‚Üí side-effect.
		Tracing d√πng ThreadLocal (OpenTelemetry) ‚Üí side-effect.
		Metrics (Micrometer/Prometheus) ‚Üí side-effect.
		
	‚û°Ô∏è Functional pipeline th√¨ side-effect l√†m ‚Äúb·∫©n‚Äù lu·ªìng x·ª≠ l√Ω. H√†m kh√¥ng c√≤n thu·∫ßn, kh√¥ng c√≤n predictable.

	Ta c·∫ßn th√™m telemetry m√† kh√¥ng ƒë·ª•ng v√†o logic c·ªët l√µi.
	


# 2. GI·∫¢I PH√ÅP: Higher-Order Function Decorator

	Thay v√¨ nh√©t logger.info() v√†o trong h√†m, ta ‚Äúb·ªçc‚Äù (decorate) m·ªôt h√†m b·∫±ng m·ªôt h√†m kh√°c.

	## V√≠ d·ª• chu·∫©n functional: 

Function<T, R> withLogging(Function<T, R> fn) {
    return (T input) -> {
        log.info("Input: {}", input);
        R result = fn.apply(input);
        log.info("Output: {}", result);
        return result;
    };
}

Function<T, R> withMetrics(Function<T, R> fn) {
    return (T input) -> {
        metrics.counter("call_count").increment();
        return fn.apply(input);
    };
}

Function<T, R> withTracing(Function<T, R> fn) {
    return (T input) -> {
        var span = tracer.start("my-span");
        try {
            return fn.apply(input);
        } finally {
            span.end();
        }
    };
}

	ƒê√¢y ch√≠nh l√† functional decorator pattern.

		Kh√¥ng c√≥ AOP.
		Kh√¥ng c√≥ annotation magic.
		Kh√¥ng c√≥ ‚Äúlogger r·∫£i r√°c‚Äù.

	Ch·ªâ l√† thu·∫ßn FP: h√†m nh·∫≠n h√†m.


# 3. COMPOSE ‚Äî X√ÇY PIPELINE TELEMETRY

	ƒê√¢y l√† ƒëi·ªÉm v√†ng c·ªßa functional style:

var pipeline =
    withLogging(
      withMetrics(
        withTracing(coreLogic)
      )
    );

	## Ho·∫∑c ƒë·∫πp h∆°n, d√πng Function.andThen() / m√£ functional: 

var decorated =
    withTracing
        .andThen(withMetrics)
        .andThen(withLogging)
        .apply(coreLogic);

	‚Üí Telemetry n·∫±m b√™n ngo√†i logic nghi·ªáp v·ª•.
	Logic ch√≠nh (coreLogic) ho√†n to√†n kh√¥ng bi·∫øt c√≥ chuy·ªán log/trace/metrics ƒëang di·ªÖn ra.




# 4. TELEMETRY THU·∫¶N H√ÄM L√Ä TH·∫æ N√ÄO?

	Kh√¥ng ph·∫£i ‚Äúkh√¥ng c√≥ side-effect‚Äù.
	Side-effect ƒëo l∆∞·ªùng v·∫´n x·∫£y ra.
	Nh∆∞ng:
		Side-effect ƒë∆∞·ª£c gom l·∫°i m·ªôt ch·ªó
		Kh√¥ng r√≤ r·ªâ v√†o logic nghi·ªáp v·ª•
		Kh√¥ng breaking purity (kh√¥ng thay ƒë·ªïi input/output)
		C√≥ th·ªÉ mock, test, thay th·∫ø d·ªÖ d√†ng

	T·ª©c l√†: Ta c√¥ l·∫≠p impurity ch·ª© kh√¥ng lo·∫°i b·ªè impurity.



# 5. JSON STRUCTURED LOG + PIPELINE

	·ªû m√¥i tr∆∞·ªùng enterprise:

		Log ph·∫£i ·ªü d·∫°ng JSON
		Log ph·∫£i ƒë∆∞a v·ªÅ ELK / Loki / Cloud Logging
		Log ph·∫£i c√≥ metadata: traceId, spanId, requestId, actorId, timing‚Ä¶
		
	Nh∆∞ng logic nghi·ªáp v·ª• kh√¥ng ƒë∆∞·ª£c bi·∫øt nh·ªØng th·ª© n√†y.

	## Functional decorator gi·∫£i quy·∫øt: 

Function<T, R> withStructuredLog(Function<T, R> fn) {
    return input -> {
        var ctx = TelemetryContext.current(); // ch·ª©a traceId, span, request metadata
        log.info(Json.of(
            "event", "request_in",
            "traceId", ctx.traceId(),
            "payload", input
        ));

        var result = fn.apply(input);

        log.info(Json.of(
            "event", "request_out",
            "traceId", ctx.traceId(),
            "result", result
        ));
        return result;
    };
}

	‚Üí M·ªçi log th·ªëng nh·∫•t, structured, ph√π h·ª£p ingest v√†o h·ªá th·ªëng log t·∫≠p trung.



# 6. ENTERPRISE MICROservice OBSERVABILITY (Kh√¥ng AOP)
	Nhi·ªÅu c√¥ng ty c·ªë ch·ªìng AOP:

	@Around("controller()")

	##	Nh∆∞ng AOP:

		kh√≥ trace t·ª´ng b∆∞·ªõc pipeline
		kh√¥ng nh√¨n r√µ th·ª© t·ª± decorator
		kh√≥ test
		ng·∫ßm ƒë·ªãnh (too much magic)
		coupling v·ªõi Spring lifecycle


	## Functional decorator th√¨ ng∆∞·ª£c l·∫°i:
	
		pipeline r√µ r√†ng
		th·ª© t·ª± telemetry minh b·∫°ch
		test t·ª´ng ph·∫ßn ƒë∆°n gi·∫£n
		kh√¥ng ph·ª• thu·ªôc Spring
		compile-time safe
		d√πng ƒë∆∞·ª£c cho pure Java microservices (Micronaut, Quarkus, Helidon)	
	
	Functional approach l√†m observability tr·ªü th√†nh dataflow pipeline, kh√¥ng ph·∫£i side-effect ng·∫´u nhi√™n.
	
	
	
# 	7. K·∫æT LU·∫¨N ‚Äî T·∫¶M NH√åN XA TRONG R√ï R√ÄNG
	N·∫øu mu·ªën microservice ch·∫°y minh b·∫°ch, d·ªÖ debug, d·ªÖ scale, kh√¥ng b·ªã AOP b·ªßa v√¢y, th√¨ functional decorator l√† ch√¨a kh√≥a:	
	
		Logic thu·∫ßn ‚Üí ·ªïn ƒë·ªãnh, d·ªÖ test
		Telemetry t√°ch bi·ªát ‚Üí chu·∫©n ho√°, ki·ªÉm so√°t, gi√°m s√°t t·ªët
		Structured logs ‚Üí ti√™u chu·∫©n ELK
		Tracing theo pipeline ‚Üí kh√¥ng b·ªã r·ªëi v√¨ Spring magic
		Metrics c√≥ th·ªÉ b·∫≠t/t·∫Øt theo decorator	
	
	Functional observability ch√≠nh l√† c√°ch c√°c team backend l·ªõn (Netflix, Uber, Shopify‚Ä¶) ƒëang chuy·ªÉn d·∫ßn sang: m·ªçi th·ª© l√† pipeline, kh√¥ng l√† side-effect r·∫£i r√°c.
	
	

</pre><a id='backBottom' href='../java-learning-list.html' style='display:none;'>üîô Quay l·∫°i danh s√°ch</a><br><button onclick='toggleTheme()'>üåô Chuy·ªÉn giao di·ªán</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>