<html><head><title>Lesson 122 == ConcurrentNavigableMap ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../java-learning-list.html'>üîô Quay l·∫°i danh s√°ch</a><br><h1>Lesson 122 -- ConcurrentNavigableMap -//</h1><pre>
# Kh√°i ni·ªám  
	
	B·∫£n ch·∫•t v√† vai tr√≤ trong h·ªá th·ªëng ƒëa lu·ªìng.
	C√°ch ho·∫°t ƒë·ªông b√™n d∆∞·ªõi (implementation).
	Khi n√†o n√™n d√πng / khi kh√¥ng n√™n d√πng.
	So s√°nh v·ªõi c√°c map kh√°c: ConcurrentHashMap, TreeMap, NavigableMap, SkipListMap.
	C√°c chi·∫øn l∆∞·ª£c t·ªëi ∆∞u hi·ªáu su·∫•t v√† memory.


	L√† m·ªôt interface trong Java, m·ªü r·ªông ConcurrentMap + NavigableMap. ƒêi·ªÅu n√†y c√≥ nghƒ©a:
	Concurrent: H·ªó tr·ª£ an to√†n trong m√¥i tr∆∞·ªùng ƒëa lu·ªìng (thread-safe).
	Navigable: H·ªó tr·ª£ truy xu·∫•t theo th·ª© t·ª±, nh∆∞ ceilingEntry, floorEntry, subMap, v.v.
	üîß Implementation ch√≠nh: ConcurrentSkipListMap<K, V>
	

# üèóÔ∏è 2. C·∫•u tr√∫c tri·ªÉn khai b√™n d∆∞·ªõi: Skip List
	- ConcurrentNavigableMap duy nh·∫•t ƒë∆∞·ª£c Java implement ch√≠nh th·ª©c l√† ConcurrentSkipListMap, d√πng Skip List:
	- Skip List l√† m·ªôt c·∫•u tr√∫c ƒëa l·ªõp (multiple levels) ƒë·ªÉ t√¨m ki·∫øm nhanh h∆°n O(log n) m√† kh√¥ng d√πng rotation nh∆∞ tree.
	- ƒê∆∞·ª£c thi·∫øt k·∫ø t·ªët cho m√¥i tr∆∞·ªùng ƒëa lu·ªìng, d·ªÖ chia nh·ªè v√πng c·∫≠p nh·∫≠t (fine-grained locking ho·∫∑c lock-free).
	
	
	## ‚è±Ô∏è Time Complexity: 
| Operation        | Time Complexity |
| ---------------- | --------------- |
| get/put          | O(log n)        |
| remove           | O(log n)        |
| firstKey/lastKey | O(1)            |
| subMap, headMap  | O(log n)        |


# üîí 3. ƒê·ªìng b·ªô h√≥a (Concurrency) 
	ConcurrentSkipListMap kh√¥ng d√πng synchronized to√†n c·ª•c nh∆∞ Collections.synchronizedMap, m√†: 
	
	- D√πng lock chia nh·ªè (fine-grained locks) ho·∫∑c CAS (Compare-and-Swap),
	- M·ªói t·∫ßng trong SkipList ho·∫°t ƒë·ªông ƒë·ªôc l·∫≠p -> kh√¥ng b·ªã bottleneck khi truy c·∫≠p ƒë·ªìng th·ªùi,
	- M·ªôt s·ªë thao t√°c nh∆∞ putIfAbsent, computeIfAbsent r·∫•t ph√π h·ª£p cho concurrent map.

# üß™ 4. Khi n√†o d√πng ConcurrentNavigableMap? 
	

| Tr∆∞·ªùng h·ª£p th·ª±c t·∫ø                              | L·ª£i √≠ch khi d√πng                                                          |
| ----------------------------------------------- | ------------------------------------------------------------------------- |
| H·ªá th·ªëng c·∫ßn duy tr√¨ th·ª© t·ª± key khi truy c·∫≠p    | Gi·ªØ th·ª© t·ª± s·∫Øp x·∫øp theo key (natural ho·∫∑c comparator)                     |
| C·∫ßn chia nh·ªè v√πng d·ªØ li·ªáu (sharding, paging...) | D√πng `subMap`, `tailMap`, `headMap` hi·ªáu qu·∫£                              |
| Ghi / ƒë·ªçc ƒë·ªìng th·ªùi (ƒëa lu·ªìng)                  | Kh√¥ng c·∫ßn t·ª± lock                                                         |
| T·∫°o h√†ng ƒë·ª£i ∆∞u ti√™n nhi·ªÅu thread x·ª≠ l√Ω         | D·ªÖ implement v·ªõi `pollFirstEntry`                                         |
| C·∫ßn x·ª≠ l√Ω nhi·ªÅu phi√™n b·∫£n d·ªØ li·ªáu (timestamped) | Key l√† timestamp, value l√† d·ªØ li·ªáu, `tailMap(ts)` tr·∫£ c√°c gi√° tr·ªã m·ªõi h∆°n |



# üî• 5. So s√°nh v·ªõi c√°c Map kh√°c
| Feature                          | HashMap | TreeMap  | ConcurrentHashMap | ConcurrentSkipListMap |
| -------------------------------- | ------- | -------- | ----------------- | --------------------- |
| Ordered                          | ‚ùå       | ‚úÖ        | ‚ùå                 | ‚úÖ                     |
| Thread-safe                      | ‚ùå       | ‚ùå        | ‚úÖ                 | ‚úÖ                     |
| Navigable (subMap, ceiling...)   | ‚ùå       | ‚úÖ        | ‚ùå                 | ‚úÖ                     |
| Performance                      | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê   | ‚≠ê‚≠ê‚≠ê      | ‚≠ê‚≠ê‚≠ê‚≠ê              | ‚≠ê‚≠ê‚≠ê                   |
| Memory overhead (extra pointers) | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê   | ‚≠ê‚≠ê       | ‚≠ê‚≠ê‚≠ê‚≠ê              | ‚≠ê‚≠ê                    |
| Insert performance               | O(1)    | O(log n) | O(1)              | O(log n)              |

# ‚öôÔ∏è 6. V√≠ d·ª• th·ª±c t·∫ø


V√≠ d·ª• 1: H·ªá th·ªëng gi√° c·ªï phi·∫øu real-time 
	
ConcurrentNavigableMap<Long, Double> stockPrices = new ConcurrentSkipListMap<>();

// Nhi·ªÅu thread ghi gi√° theo timestamp
stockPrices.put(System.currentTimeMillis(), 123.45);

// Truy xu·∫•t gi√° sau 9:30 s√°ng
long openTime = 9_30_00_000L;
NavigableMap<Long, Double> pricesAfterOpen = stockPrices.tailMap(openTime);



V√≠ d·ª• 2: Time-based cache / expiring data
// L∆∞u d·ªØ li·ªáu theo timestamp
ConcurrentNavigableMap<Long, MyData> cache = new ConcurrentSkipListMap<>();

// Periodic cleanup thread:
long cutoff = System.currentTimeMillis() - 5 * 60 * 1000;
cache.headMap(cutoff).clear(); // clear c√°c item ƒë√£ h·∫øt h·∫°n




# üöß 7. C·∫ßn l∆∞u √Ω g√¨ khi d√πng? 

	- Kh√¥ng ph√π h·ª£p cho insert-heavy system v·ªõi key ng·∫´u nhi√™n n·∫øu ch·ªâ c·∫ßn hash-access.
	- N·∫øu kh√¥ng c·∫ßn th·ª© t·ª± ‚Üí D√πng ConcurrentHashMap nhanh h∆°n, t·ªën √≠t b·ªô nh·ªõ h∆°n.
	- Kh√¥ng n√™n l·∫°m d·ª•ng subMap() n·∫øu thao t√°c r·∫•t nhi·ªÅu thread ‚Üí c√≥ th·ªÉ b·ªã contention n·∫øu v√πng overlap nhau.


# üß† 8. Ki·∫øn th·ª©c c·∫ßn ƒë·ªÉ l√†m ch·ªß ConcurrentNavigableMap

| Ki·∫øn th·ª©c             | M·ª•c ti√™u                                                   |
| --------------------- | ---------------------------------------------------------- |
| Java Memory Model     | Hi·ªÉu volatile, happens-before, visibility gi·ªØa threads     |
| Lock-free Programming | CAS, atomic variables, contention                          |
| Skip List             | C·∫•u tr√∫c, ∆∞u nh∆∞·ª£c ƒëi·ªÉm, so s√°nh v·ªõi BST                   |
| NavigableMap API      | S·ª≠ d·ª•ng hi·ªáu qu·∫£ c√°c h√†m `subMap`, `tailMap`, `ceilingKey` |
| Benchmark/Profiling   | So s√°nh th·ª±c t·∫ø v·ªõi c√°c concurrent map kh√°c                |



</pre><a id='backBottom' href='../java-learning-list.html' style='display:none;'>üîô Quay l·∫°i danh s√°ch</a><br><button onclick='toggleTheme()'>üåô Chuy·ªÉn giao di·ªán</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>