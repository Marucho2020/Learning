<html><head><title>Lesson 84 == Service Discovery ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../java-learning-list.html'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><h1>Lesson 84 -- Service Discovery -//</h1><pre>
# KhÃ¡i niá»‡m  
	Service Discovery lÃ  trÃ¡i tim cá»§a kiáº¿n trÃºc microservices, giÃºp cÃ¡c dá»‹ch vá»¥ tÃ¬m tháº¥y nhau mÃ  khÃ´ng cáº§n biáº¿t trÆ°á»›c Ä‘á»‹ chá»‰ IP. 
	
	ğŸ”¹ Khi há»‡ thá»‘ng cÃ³ nhiá»u microservices, má»—i services cháº¡y trÃªn cÃ¡c instance khÃ¡c nhau (VM , container , Kubernetes pod )
	ğŸ”¹ CÃ¡c instance nÃ y cÃ³ thá»ƒ thay Ä‘á»•i Ä‘á»‹a chá»‰ IP liÃªn tá»¥c do scale up/down, container bá»‹ di chuyá»ƒn, hoáº·c há»‡ thá»‘ng gáº·p lá»—i vÃ  khá»Ÿi Ä‘á»™ng láº¡i 
	ğŸ”¹Váº¥n Ä‘á» : lÃ m tháº¿ nÃ o Ä‘á»ƒ service A tÃ¬m Ä‘Æ°á»£c Ä‘á»‹a chá»‰ cá»§a service B 
	âœ…Giáº£i phÃ¡p : DÃ¹ng Service Discovery Ä‘á»ƒ quáº£n lÃ½ danh sÃ¡ch cÃ¡c service má»™t cÃ¡ch tá»± Ä‘á»™ng  
	
	
	## Hai mÃ´ hÃ¬nh Service Discovery chÃ­nh 
			A . Client-side  Service Discovery 
			B. Server-side Service Discovery (Proxy-based Discovery)

# A . Client-side  Service Discovery 
		
		
	## CÃ¡ch hoáº¡t Ä‘á»™ng 
		- Client chá»‹u trÃ¡ch nhiá»‡m tÃ¬m Ä‘á»‹a chá»‰ cá»§a service cáº§n gá»i 
		- Client gá»­i yÃªu cáº§u Ä‘áº¿n Service Registry, nháº­n danh sÃ¡ch cÃ¡c instance 
		- Client chá»n má»™t instance vÃ  gá»­i request 
		
	## ThÃ nh pháº§n chÃ­nh : 
		
		### 1. Service Registry (ÄÄƒng kÃ½ dá»‹ch vá»¥ )
			- LÆ°u danh sÃ¡ch cÃ¡c service Ä‘ang hoáº¡t Ä‘á»™ng 
			- CÃ¡c service tá»± Ä‘á»™ng Ä‘Äƒng kÃ½, xÃ³a Ä‘Äƒng kÃ½ khi khá»Ÿi Ä‘á»™ng hoáº·c shutdown 
			- VÃ­ dá»¥ : Consul, Eureka, Etcd , ZooKeeper 
			
		### 2. Client-side Load Balancer 
			- Client quyáº¿t Ä‘á»‹nh gá»­i request Ä‘áº¿n instance nÃ o 
			- VÃ­ dá»¥ : Ribbon(Spring Cloud Netflix) , gRPC LoadBalancer 
			
	## Æ¯u Ä‘iá»ƒm  
		- KhÃ´ng  cÃ³ bottleneck vÃ¬ client tá»± quáº£n lÃ½ service discovery 
		- Giáº£m táº£i cho há»‡ thá»‘ng (khÃ´ng cáº§n proxy trung gian)
		- TÃch há»£p tá»‘t vá»›i cÃ¡c á»©ng dá»¥ng gRPC 
		
	## NhÆ°á»£c Ä‘iá»ƒm 
		- Má»—i client pháº£i cÃ³ logic xá»­ lÃ½ service discovery 
		- KhÃ´ng phÃ¹ há»£p vá»›i cÃ¡c há»‡ thá»‘ng phá»©c táº¡p (hÃ ng ngÃ n service )
		
	## CÃ´ng nghá»‡ phá»• biáº¿n  
		âœ… Eureka(Spring Cloud Netflix)
		âœ… Consul (HashiCorp)
		âœ… Etcd(Kubernetes, CoreDNS)
		
	
# B. Server-side Service Discovery (Proxy-based Discovery)	

	
	## CÃ¡ch hoáº¡t Ä‘á»™ng 
		- Client gá»­i request Ä‘áº¿n má»™t proxy trung gian (Load Balancer hoáº·c API Gateway)
		- Proxy nÃ y sáº½ lookup trong Service Registry vÃ  chuyá»ƒn tiáº¿p request Ä‘áº¿n service phÃ¹ há»£p 
		
	## ThÃ nh pháº§n chÃ­nh : 

		### Service Registry 
			- LÆ°u danh sÃ¡ch cÃ¡c service Ä‘ang hoáº¡t Ä‘á»™ng 
			- CÃ¡c service tá»± Ä‘á»™ng Ä‘Äƒng kÃ½, xÃ³a Ä‘Äƒng kÃ½ khi khá»Ÿi Ä‘á»™ng hoáº·c shutdown 
			- VÃ­ dá»¥ : Consul, Eureka, Etcd , ZooKeeper 
			
		### Service Proxy (API Gateway hoáº·c Load Balancer)	
			- Proxy sáº½ kiá»ƒm tra Service Registry, chá»n instance phÃ¹ há»£p 
			- VÃ­ dá»¥ Envoy, Nginx, HAProxy, Istio, Kong API Gateway. 
			
	
	

	## Æ¯u Ä‘iá»ƒm 
		âœ… Client khÃ´ng cáº§n logic service discovery â†’ Ä‘Æ¡n giáº£n hÆ¡n.
		âœ… TÃ­ch há»£p tá»‘t vá»›i Service Mesh.
		âœ… Há»— trá»£ load balancing, retries, circuit breaking.
	
	## NhÆ°á»£c Ä‘iá»ƒm  
		âŒ Proxy cÃ³ thá»ƒ trá»Ÿ thÃ nh bottleneck.
		âŒ Tá»‘n thÃªm tÃ i nguyÃªn Ä‘á»ƒ cháº¡y proxy. 

	## CÃ´ng nghá»‡ phá»• biáº¿n  
	
		âœ… Istio + Envoy (Kubernetes)
		âœ… Nginx + Consul
		âœ… Kong API Gateway


# á»¨ng dá»¥ng Service Discovery trong thá»±c táº¿ (Use Cases ) 

	## 1. Service Discovery vá»›i Spring Cloud(Netflix Eureka)
		
		Náº¿u báº¡n thiáº¿t káº¿ há»‡ thá»‘ng báº±ng Spring Boot, Eureka lÃ  má»™t lá»±a chá»n phá»• biáº¿n.
		
	ğŸ“Œ Cáº¥u trÃºc:
		- Eureka Server â†’ Service Registry. 
		- Eureka Client â†’ CÃ¡c microservices Ä‘Äƒng kÃ½ vÃ o Eureka. 
		- Ribbon / Feign Client â†’ Load Balancer phÃ­a client.
		
		
	ğŸ“Œ CÃ¡ch triá»ƒn khai: 
	
		### Khai bÃ¡o Eureka Server:
		
		
			@SpringBootApplication
			@EnableEurekaServer
			public class EurekaServerApplication {
				public static void main(String[] args) {
					SpringApplication.run(EurekaServerApplication.class, args);
				}
			}

		###   Khai bÃ¡o Eureka Client:
		
				@SpringBootApplication
				@EnableEurekaClient
				public class ServiceAApplication {
					public static void main(String[] args) {
						SpringApplication.run(ServiceAApplication.class, args);
					}
				}

		 
		###  Gá»i API cá»§a má»™t service khÃ¡c (Feign Client): 
		
		
			@FeignClient(name = "service-b")
			public interface ServiceBClient {
				@GetMapping("/api/data")
				String getData();
			}

		 
	## ğŸ“Œ Æ¯u Ä‘iá»ƒm cá»§a Eureka: 	 
		 
		âœ… TÃ­ch há»£p tá»‘t vá»›i Spring Boot.
		âœ… Há»— trá»£ self-preservation (cÆ¡ cháº¿ báº£o vá»‡ khi máº¥t káº¿t ná»‘i).
		âœ… Load balancing báº±ng Ribbon.	 
		 
	## 	 ğŸ“Œ NhÆ°á»£c Ä‘iá»ƒm: 
	
		âŒ Netflix Ä‘Ã£ ngá»«ng há»— trá»£ (deprecated).
		âŒ KhÃ´ng phÃ¹ há»£p vá»›i Kubernetes (dÃ¹ng DNS tá»‘t hÆ¡n).
		 
		 
		 
# 	Service Discovery trong Kubernetes (K8s) 
	
	ğŸ“Œ MÃ´ hÃ¬nh trong Kubernetes 
		Kubernetes tÃ­ch há»£p sáºµn Service Discovery thÃ´ng qua CoreDNS vÃ  Kube-Proxy.
		
		
	ğŸ”¹ DNS-based Service Discovery: 
		Kubernetes tá»± Ä‘á»™ng táº¡o DNS name cho má»—i service. 
		Client chá»‰ cáº§n gá»i http://service-name.namespace.svc.cluster.local
		
		VÃ­ dá»¥:
			curl http://service-b.default.svc.cluster.local

	

	ğŸ”¹ Service Mesh (Istio + Envoy) 
		Istio quáº£n lÃ½ Service Discovery báº±ng Sidecar Proxy (Envoy). 
		Há»— trá»£ mTLS, Circuit Breaking, Rate Limiting.
		
		VÃ­ dá»¥:
				apiVersion: networking.istio.io/v1alpha3
				kind: VirtualService
				metadata:
				name: service-b
				spec:
				hosts:
					- service-b
				http:
					- route:
						- destination:
							host: service-b
							subset: v1
	

	# ğŸ“Œ Æ¯u Ä‘iá»ƒm cá»§a Kubernetes Service Discovery:
		âœ… KhÃ´ng cáº§n service registry riÃªng biá»‡t (dÃ¹ng CoreDNS).
		âœ… Há»— trá»£ auto-scaling.
		âœ… Káº¿t há»£p vá»›i Istio Ä‘á»ƒ quáº£n lÃ½ observability, tracing, security.
		
	# ğŸ“Œ NhÆ°á»£c Ä‘iá»ƒm:
	
		âŒ KhÃ´ng linh hoáº¡t vá»›i há»‡ thá»‘ng ngoÃ i Kubernetes.
		âŒ KhÃ´ng há»— trá»£ weighted load balancing máº·c Ä‘á»‹nh (cáº§n Istio).



# ğŸš€ 4. Khi nÃ o chá»n mÃ´ hÃ¬nh nÃ o? 
	
	


TiÃªu chÃ­			Client-side (Eureka, Consul)		Server-side (Envoy, Istio)			DNS-based (K8s)
Tá»‘c Ä‘á»™					ğŸŸ¢ Nhanh hÆ¡n					ğŸŸ¡ CÃ³ thÃªm latency do proxy				ğŸŸ¢ Nhanh
Quy mÃ´ lá»›n				ğŸ”´ KhÃ³ scale					ğŸŸ¢ Dá»… má»Ÿ rá»™ng							ğŸŸ¢ Dá»… má»Ÿ rá»™ng
Báº£o máº­t (mTLS)			ğŸ”´ KhÃ´ng há»— trá»£					ğŸŸ¢ Há»— trá»£ tá»‘t (Istio)					ğŸŸ¡ Cáº§n cáº¥u hÃ¬nh
Microservices			ğŸŸ¢ Tá»‘t							ğŸŸ¢ Tá»‘t									ğŸŸ¢ Tá»‘t
Há»‡ thá»‘ng ngoÃ i K8s		ğŸŸ¢ Há»— trá»£						ğŸŸ¢ Há»— trá»£								ğŸ”´ KhÃ´ng há»— trá»£



# âœ… Káº¿t luáº­n 


ğŸ”¹ Náº¿u dÃ¹ng Spring Boot, chá»n Eureka/Consul.
ğŸ”¹ Náº¿u há»‡ thá»‘ng cháº¡y trÃªn Kubernetes, dÃ¹ng CoreDNS hoáº·c Istio.
ğŸ”¹ Náº¿u há»‡ thá»‘ng yÃªu cáº§u báº£o máº­t cao, dÃ¹ng Istio + Envoy Proxy.
ğŸ”¹ Náº¿u há»‡ thá»‘ng cÃ³ scale lá»›n, dÃ¹ng API Gateway (Kong, Nginx) hoáº·c Service Mesh.



</pre><a id='backBottom' href='../java-learning-list.html' style='display:none;'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><button onclick='toggleTheme()'>ğŸŒ™ Chuyá»ƒn giao diá»‡n</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>