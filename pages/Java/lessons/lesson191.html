<html><head><title>Lesson 191 == Parallel Stream ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../java-learning-list.html'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><h1>Lesson 191 -- Parallel Stream -//</h1><pre>
# 1. parallel() lÃ  gÃ¬?

	stream().parallel() biáº¿n sequential stream thÃ nh parallel stream.
	
	Parallel stream chia cÃ´ng viá»‡c thÃ nh task nhá» â†’ phÃ¢n phá»‘i trÃªn nhiá»u thread trong ForkJoinPool.commonPool().
	
	Táº¥t cáº£ task cháº¡y song song rá»“i merge káº¿t quáº£ theo reduce/collect.

	ğŸ‘‰ TÆ° duy: parallel() khÃ´ng lÃ m phÃ©p toÃ¡n nhanh hÆ¡n "máº·c Ä‘á»‹nh". NÃ³ chá»‰ chia workload. Náº¿u task nhá» vÃ  dataset Ã­t â†’ overhead cÃ²n tá»‘n hÆ¡n.


# 2. ForkJoinPool concept
	
	Fork: chia task lá»›n thÃ nh subtask nhá».
	Join: ghÃ©p káº¿t quáº£ subtask thÃ nh káº¿t quáº£ cuá»‘i.
	Parallel stream dÃ¹ng ForkJoinPool.commonPool (sá»‘ thread â‰ˆ sá»‘ CPU core).

	âš ï¸ Senior point:

		- CÃ³ thá»ƒ custom pool báº±ng ForkJoinPool riÃªng, nhÆ°ng pháº£i submit task thá»§ cÃ´ng.

		- Náº¿u khÃ´ng kiá»ƒm soÃ¡t, toÃ n bá»™ parallel stream trong app dÃ¹ng chung commonPool â†’ dá»… ngháº½n (thread starvation) khi nhiá»u service cháº¡y Ä‘á»“ng thá»i.


# 3. Thread safety & Shared mutable state 

	Rule tuyá»‡t Ä‘á»‘i: KhÃ´ng Ä‘á»¥ng tá»›i mutable shared state trong parallel stream.
VÃ­ dá»¥ nguy hiá»ƒm:

	List<Integer> list = new ArrayList<>();
	numbers.parallelStream().forEach(list::add); // âŒ race condition

	â†’ Káº¿t quáº£ unpredictable vÃ¬ nhiá»u thread cÃ¹ng sá»­a 1 list.
	
		DÃ¹ng collector thread-safe (toConcurrentMap, groupingByConcurrent).
		Hoáº·c chá»‰ dÃ¹ng reduce / collect â€“ vá»‘n Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ an toÃ n trong parallel.


# 4. Reduce trong parallel stream

	reduce(identity, accumulator, combiner) cá»±c quan trá»ng:

		identity = giÃ¡ trá»‹ trung tÃ­nh.
		accumulator = cÃ¡ch xá»­ lÃ½ 1 pháº§n tá»­.
		combiner = cÃ¡ch gá»™p káº¿t quáº£ tá»« nhiá»u thread.


	## VÃ­ dá»¥ tÃ­nh tá»•ng doanh sá»‘ (total sales):

int total = orders.parallelStream()
    .map(Order::getAmount)
    .reduce(0, Integer::sum, Integer::sum);

		- Accumulator: cá»™ng vÃ o subtotal.
		- Combiner: merge subtotal tá»« cÃ¡c thread.
		- Associativity (çµåˆå‰‡) Ä‘áº£m báº£o káº¿t quáº£ Ä‘Ãºng.
		

# 5. Enterprise example

	List<Order> cÃ³ hÃ ng triá»‡u record (log giao dá»‹ch, order, KPI).
	DÃ¹ng parallelStream Ä‘á»ƒ tÃ­nh tá»•ng doanh sá»‘ nhanh hÆ¡n (multi-core).
	NhÆ°ng chá»‰ khi:

		Dataset Ä‘á»§ lá»›n (10âµ+ elements).
		Operation tá»‘n CPU.
		KhÃ´ng phá»¥ thuá»™c IO (vÃ¬ IO bottleneck khÃ´ng scale tá»‘t báº±ng parallel).

	ğŸ‘‰ Náº¿u tÃ­nh sum/avg/min/max â†’ parallel stream phÃ¹ há»£p.
	ğŸ‘‰ Náº¿u update DB hay API call â†’ âŒ, vÃ¬ thread safety vÃ  overhead pool.


# 6. Äiá»ƒm senior cáº§n nhá»›

	- parallel() khÃ´ng magic â†’ benchmark má»›i biáº¿t nhanh hay cháº­m.
	- shared mutable state = káº» thÃ¹, luÃ´n trÃ¡nh.
	- ForkJoinPool.commonPool lÃ  global â†’ cáº©n tháº­n khi app cÃ³ nhiá»u pháº§n dÃ¹ng song song.
	- DÃ¹ng reduce hoáº·c collector an toÃ n cho parallel.
	- Enterprise: parallel stream phÃ¹ há»£p cho batch processing, reporting, analytics â€” khÃ´ng phÃ¹ há»£p cho logic transactional hoáº·c online request nhá».


	## ğŸ‘‰ TÃ³m gá»n kiá»ƒu senior:

		parallel() = chia viá»‡c â†’ ForkJoinPool.
		ÄÃºng khi workload lá»›n & CPU-bound.
		KhÃ´ng an toÃ n náº¿u mutable shared state.
		reduce/collect lÃ  cÃ¡ch duy nháº¥t Ä‘á»ƒ trÃ¡nh race condition.
		Trong enterprise, xem parallel stream nhÆ° â€œSQL parallel executionâ€ â†’ cÃ³ lÃºc lá»£i, cÃ³ lÃºc háº¡i.






</pre><a id='backBottom' href='../java-learning-list.html' style='display:none;'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><button onclick='toggleTheme()'>ğŸŒ™ Chuyá»ƒn giao diá»‡n</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>