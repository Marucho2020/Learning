<html><head><title>Lesson 202 == Lazy Evaluation & Stream Fusion ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../java-learning-list.html'>üîô Quay l·∫°i danh s√°ch</a><br><h1>Lesson 202 -- Lazy Evaluation & Stream Fusion -//</h1><pre>
# üéØ M·ª§C TI√äU

1.Lazy Evaluation (ÈÅÖÂª∂Ë©ï‰æ° / tr√¨ ho√£n ƒë√°nh gi√°)
‚Üí Kh√¥ng t√≠nh to√°n cho ƒë·∫øn khi th·∫≠t s·ª± c·∫ßn k·∫øt qu·∫£.

2.Stream Fusion („Çπ„Éà„É™„Éº„É†ËûçÂêà / h·ª£p nh·∫•t d√≤ng x·ª≠ l√Ω)
‚Üí JVM h·ª£p nh·∫•t nhi·ªÅu b∆∞·ªõc trung gian (map/filter‚Ä¶) th√†nh m·ªôt l·∫ßn duy·ªát d·ªØ li·ªáu duy nh·∫•t ‚Äî gi·∫£m overhead, tƒÉng cache locality.



# üß† 1. Lazy Evaluation ‚Äî ‚ÄúKh√¥ng ch·∫°y cho ƒë·∫øn khi b·ªã √©p ch·∫°y‚Äù

	Trong Java Stream:

Stream.of(1, 2, 3, 4)
    .filter(x -> {
        System.out.println("filter: " + x);
        return x % 2 == 0;
    })
    .map(x -> {
        System.out.println("map: " + x);
        return x * 10;
    });

	üëâ Kh√¥ng c√≥ g√¨ in ra c·∫£.
	Khi ta th√™m .collect(Collectors.toList()):

filter: 1
filter: 2
map: 2
filter: 3
filter: 4
map: 4

‚Üí D√≤ng ch·ªâ ch·∫°y khi g·∫∑p terminal op (nh∆∞ collect, forEach, findFirst, reduce, v.v.)


# üß© V√¨ sao Lazy quan tr·ªçng?


	1.Tr√°nh t√≠nh to√°n th·ª´a: ch·ªâ x·ª≠ l√Ω ƒë·∫øn khi ƒë·ªß ƒëi·ªÅu ki·ªán.
	‚Üí V√≠ d·ª• findFirst() s·∫Ω d·ª´ng ngay khi t√¨m th·∫•y ph·∫ßn t·ª≠ ƒë·∫ßu ti√™n.
	
	2.Cho ph√©p short-circuit (d·ª´ng s·ªõm).
	‚Üí anyMatch(), allMatch(), noneMatch() l√† nh·ªØng ‚Äúshort-circuit terminal ops‚Äù.
	
	3.C·∫£i thi·ªán performance c·ª±c m·∫°nh v·ªõi data l·ªõn ho·∫∑c infinite stream (v√¥ h·∫°n).



# ‚öôÔ∏è 2. Stream Fusion ‚Äî ‚ÄúG·ªôp pipeline th√†nh m·ªôt pass‚Äù

Stream.of(1, 2, 3, 4, 5)
    .filter(x -> x % 2 == 0)
    .map(x -> x * 10)
    .forEach(System.out::println);



	Ta c√≥ 2 intermediate operations (filter, map).
	N·∫øu ch·∫°y theo c√°ch na√Øve (ng√¢y th∆°) ki·ªÉu OOP:

		Filter t·∫°o danh s√°ch t·∫°m [2, 4]
		Map l·∫°i t·∫°o danh s√°ch [20, 40]
		ForEach in ra
		‚Üí T·ª©c l√† duy·ªát 3 l·∫ßn danh s√°ch.

	## Nh∆∞ng Stream API th√¨ kh√°c.
	‚ö° JVM th·ª±c hi·ªán Fusion:

for (int x : data) {
    if (x % 2 == 0) {
        int y = x * 10;
        System.out.println(y);
    }
}

	Kh√¥ng t·∫°o danh s√°ch t·∫°m trung gian, kh√¥ng copy d·ªØ li·ªáu, kh√¥ng cache t·∫°m ‚Äî t·∫•t c·∫£ ‚Äúfused‚Äù v√†o c√πng m·ªôt loop.
	
	‚Üí ƒê√¢y ch√≠nh l√† Stream Fusion Optimization.


# üîç 3. T√°c d·ª•ng th·ª±c t·∫ø trong Enterprise

| ·ª®ng d·ª•ng                                | L·ª£i √≠ch t·ª´ Lazy + Fusion                                                      |
| --------------------------------------- | ----------------------------------------------------------------------------- |
| **Big Data Processing**                 | Kh√¥ng load to√†n b·ªô dataset v√†o memory, ch·ªâ x·ª≠ l√Ω theo lu·ªìng (streaming).      |
| **Reactive Streams (Reactor / RxJava)** | M·ªói b∆∞·ªõc ƒë∆∞·ª£c ‚Äúch·∫°y l∆∞·ªùi‚Äù (lazy) cho ƒë·∫øn khi subscriber y√™u c·∫ßu.              |
| **ETL Pipelines**                       | Tr√°nh t·∫°o file / list trung gian, tƒÉng throughput.                            |
| **Security Audit Stream**               | C√≥ th·ªÉ short-circuit khi g·∫∑p l·ªói nghi√™m tr·ªçng m√† kh√¥ng c·∫ßn duy·ªát to√†n b·ªô log. |



# üß© 4. V√≠ d·ª• th·ª±c t·∫ø ‚Äî Audit Stream

List<AuditEvent> events = fetchEvents();

boolean hasCriticalIssue = events.stream()
    .filter(e -> e.getLevel() >= 3)
    .peek(e -> log.debug("Checking " + e))
    .anyMatch(AuditEvent::isCritical);


	.filter + .peek + .anyMatch
	ƒë·ªÅu fused l·∫°i th√†nh m·ªôt loop duy nh·∫•t.
	
	Khi g·∫∑p ph·∫ßn t·ª≠ ‚Äúcritical‚Äù ƒë·∫ßu ti√™n,
	pipeline d·ª´ng ngay (short-circuit).
	
	Kh√¥ng duy·ªát ph·∫ßn c√≤n l·∫°i, kh√¥ng log th√™m, c·ª±c nhanh.


	

# üß† 5. K·∫øt h·ª£p v·ªõi Parallel Stream

	Lazy evaluation v√† stream fusion v·∫´n ho·∫°t ƒë·ªông khi d√πng song song:

employees.parallelStream()
    .filter(Employee::isActive)
    .map(Employee::getSalary)
    .reduce(BigDecimal.ZERO, BigDecimal::add);


	‚Üí JVM chia nh·ªè stream theo thread,
nh∆∞ng m·ªói ‚Äúsubstream‚Äù v·∫´n fused ‚Äî kh√¥ng t·∫°o intermediate collection.


# üî¨ 6. So s√°nh t∆∞ duy Functional vs OOP

| Ki·ªÉu                    | M√¥ t·∫£                              | H·∫≠u qu·∫£                        |
| ----------------------- | ---------------------------------- | ------------------------------ |
| **OOP**                 | G·ªçi h√†m l√† *th·ª±c thi ngay*         | T·ªën t√†i nguy√™n, d·ªÖ side-effect |
| **Functional**          | G·ªçi h√†m l√† *t·∫°o pipeline ch·ªù ch·∫°y* | Lazy, d·ªÖ t·ªëi ∆∞u, d·ªÖ test       |
| **Imperative loop**     | Nhi·ªÅu bi·∫øn t·∫°m                     | Kh√¥ng fusion ƒë∆∞·ª£c              |
| **Functional pipeline** | Kh√¥ng bi·∫øn t·∫°m, c√≥ fusion          | Cache locality cao, √≠t GC      |



# üß© 7. C∆° ch·∫ø b√™n trong JVM


Stream API d√πng c√°c Spliterator v√† Sink chain ƒë·ªÉ th·ª±c hi·ªán fusion.

	- M·ªói map, filter, flatMap t·∫°o ra m·ªôt l·ªõp ‚ÄúSink‚Äù n·ªôi b·ªô.
	- Khi terminal operation g·ªçi evaluate(), t·∫•t c·∫£ sink ƒë∆∞·ª£c li√™n k·∫øt th√†nh chu·ªói duy nh·∫•t.
	- D·ªØ li·ªáu ƒëi qua ‚Äúpipeline fused‚Äù n√†y ‚Üí duy·ªát ƒë√∫ng m·ªôt l·∫ßn duy nh·∫•t.

	filter ‚Üí map ‚Üí collect kh√¥ng ph·∫£i 3 loop, m√† l√† 1 loop n·ªëi li·ªÅn nhau trong bytecode runtime.



# üß† 8. Tri·∫øt l√Ω Functional ƒë·∫±ng sau

Functional Design kh√¥ng quan t√¢m ‚Äúch·∫°y nh∆∞ th·∫ø n√†o‚Äù ‚Äî
m√† ch·ªâ quan t√¢m ‚Äúkhi n√†o c·∫ßn th√¨ m·ªõi ch·∫°y‚Äù.

‚ÄúDeclare what you want, not how to get it.‚Äù
‚Äî tri·∫øt l√Ω c·ªët l√µi c·ªßa lazy evaluation.




# ‚ö° 9. Enterprise Optimization Pattern

logs.stream()
    .filter(Log::isRelevant)
    .map(Log::extractMessage)
    .map(String::toLowerCase)
    .filter(msg -> msg.contains("error"))
    .findFirst();

	T∆∞·ªüng r·∫±ng ph·∫£i duy·ªát 1 tri·ªáu d√≤ng?
Th·ª±c t·∫ø ‚Äî JVM fusion t·∫•t c·∫£ step n√†y, d·ª´ng ngay khi t√¨m th·∫•y "error" ƒë·∫ßu ti√™n.

	Hi·ªáu nƒÉng tƒÉng h√†ng ch·ª•c l·∫ßn.



# üß© 10. K·∫øt lu·∫≠n

| Concept              | √ù nghƒ©a                                | L·ª£i √≠ch                  |
| -------------------- | -------------------------------------- | ------------------------ |
| **Lazy Evaluation**  | Tr√¨ ho√£n th·ª±c thi ƒë·∫øn khi th·∫≠t s·ª± c·∫ßn  | Gi·∫£m t√≠nh to√°n th·ª´a      |
| **Short-circuiting** | D·ª´ng pipeline s·ªõm khi ƒë·ªß ƒëi·ªÅu ki·ªán     | Gi·∫£m I/O v√† CPU          |
| **Stream Fusion**    | G·ªôp nhi·ªÅu step th√†nh m·ªôt loop duy nh·∫•t | Gi·∫£m memory, tƒÉng speed  |
| **·ª®ng d·ª•ng**         | Big data, reactive, analytics, audit   | Performance, scalability |



</pre><a id='backBottom' href='../java-learning-list.html' style='display:none;'>üîô Quay l·∫°i danh s√°ch</a><br><button onclick='toggleTheme()'>üåô Chuy·ªÉn giao di·ªán</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>