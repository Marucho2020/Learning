<html><head><title>Lesson 134 == ReentrantLock, ReentrantReadWriteLock  Lock Ä‘á»™c quyá»n (exclusive) ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../java-learning-list.html'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><h1>Lesson 134 -- ReentrantLock, ReentrantReadWriteLock  Lock Ä‘á»™c quyá»n (exclusive) -//</h1><pre># KhÃ¡i niá»‡m 
	ReentrantLock lÃ  má»™t mutex lock (giá»‘ng synchronized) nhÆ°ng cÃ³ tÃ­nh nÄƒng má»Ÿ rá»™ng:
		Reentrancy: 1 thread cÃ³ thá»ƒ lock nhiá»u láº§n mÃ  khÃ´ng bá»‹ block chÃ­nh nÃ³
		Thá»­ lock (tryLock()), há»— trá»£ timeout
		Interruptible lock acquisition
		Condition objects (wait/notify nhÆ°ng tá»‘t hÆ¡n)	


	ğŸ“Œ VÃ­ dá»¥ cÆ¡ báº£n
	
ReentrantLock lock = new ReentrantLock();
lock.lock(); // acquire
try {
    // critical section
} finally {
    lock.unlock(); // always unlock
}
	

# âœ… Reentrant lÃ  gÃ¬? 
	lock.lock();
try {
    lock.lock(); // âœ… same thread re-locks without deadlock
    try {
        // nested logic
    } finally {
        lock.unlock();
    }
} finally {
    lock.unlock();
}


	ReentrantLock Ä‘áº¿m sá»‘ láº§n lock cá»§a thread hiá»‡n táº¡i
	unlock() pháº£i Ä‘Æ°á»£c gá»i Ä‘Ãºng sá»‘ láº§n

# âš™ï¸ Má»™t sá»‘ API quan trá»ng

| Method                   | Ã nghÄ©a                                       |
| ------------------------ | --------------------------------------------- |
| `lock()`                 | Cháº·n cho tá»›i khi lock Ä‘Æ°á»£c                    |
| `tryLock()`              | KhÃ´ng block â€“ tráº£ vá» `false` náº¿u Ä‘ang bá»‹ lock |
| `tryLock(timeout, unit)` | Chá» trong timeout                             |
| `lockInterruptibly()`    | Bá»‹ `interrupt()` thÃ¬ thoÃ¡t                    |
| `newCondition()`         | Táº¡o Ä‘iá»u kiá»‡n Ä‘á»ƒ chá» (`await()`, `signal()`)  |


# ğŸ”„ 2. ReentrantReadWriteLock â€“ Tá»‘i Æ°u hÃ³a khi nhiá»u Ä‘á»c Ã­t ghi

	## âœ… Má»¥c tiÃªu:
		TÃ¡ch lock thÃ nh:
		Read Lock: chia sáº» giá»¯a nhiá»u thread Ä‘á»c (non-exclusive)
		Write Lock: Ä‘á»™c quyá»n (exclusive)


	## DÃ¹ng trong:
		Cache
		Data structure nhiá»u Ä‘á»c â€“ Ã­t ghi
		Concurrent map, shared config


ReentrantReadWriteLock rwLock = new ReentrantReadWriteLock();
Lock readLock = rwLock.readLock();
Lock writeLock = rwLock.writeLock();

// Äá»c
readLock.lock();
try {
    // Ä‘á»c dá»¯ liá»‡u
} finally {
    readLock.unlock();
}

// Ghi
writeLock.lock();
try {
    // thay Ä‘á»•i dá»¯ liá»‡u
} finally {
    writeLock.unlock();
}



# âš ï¸ LÆ°u Ã½: 
	
| TÃ¬nh huá»‘ng                                                | Káº¿t quáº£                                |
| --------------------------------------------------------- | -------------------------------------- |
| 2 thread Ä‘á»c â†’ `readLock()`                               | âœ… Äá»“ng thá»i                            |
| 1 thread Ä‘á»c, 1 thread ghi â†’ `readLock()` & `writeLock()` | âŒ Ghi pháº£i chá» Ä‘á»c xong                |
| Nhiá»u ghi â†’ `writeLock()`                                 | âŒ Cháº·n nhau                            |
| Äá»c â†’ Ghi (nÃ¢ng cáº¥p)                                      | âŒ KhÃ´ng há»— trá»£ trá»±c tiáº¿p (dá»… deadlock) |





# ğŸ§  3. So sÃ¡nh ReentrantLock vs ReentrantReadWriteLock 

| TÃ­nh nÄƒng                | `ReentrantLock` | `ReentrantReadWriteLock`      |
| ------------------------ | --------------- | ----------------------------- |
| Loáº¡i lock                | Exclusive       | Shared Read + Exclusive Write |
| Reentrant                | âœ…               | âœ…                             |
| Chia sáº» Ä‘á»c              | âŒ               | âœ…                             |
| Tá»‘i Æ°u nhiá»u Ä‘á»c         | âŒ               | âœ…                             |
| Upgrade read â†’ write     | âŒ KhÃ´ng há»— trá»£  | âŒ CÃ³ nhÆ°ng nguy hiá»ƒm          |
| Condition support        | âœ… (1)           | âœ… (2 conditions: read, write) |
| Performance (read-heavy) | âŒ               | âœ…                             |


# ğŸ§¨ 4. Sai láº§m thÆ°á»ng gáº·p (production-level) 
	âŒ QuÃªn unlock() â†’ Deadlock
â†’ KhÃ´ng bao giá» Ä‘Æ°á»£c lock() mÃ  khÃ´ng unlock() trong finally

âŒ Lock upgrade (read â†’ write) trong ReentrantReadWriteLock
readLock.lock();
writeLock.lock(); // ğŸ’¥ DEADLOCK


â¡ Pháº£i unlockRead() trÆ°á»›c, rá»“i má»›i lockWrite() â€“ dá»… race

âŒ Láº¡m dá»¥ng tryLock() mÃ  khÃ´ng kiá»ƒm tra ká»¹
if (lock.tryLock()) {
    // nhÆ°ng quÃªn else â†’ race condition
}



# ğŸ”¬ 5. Khi nÃ o dÃ¹ng? 
	
| Use-case                               | `ReentrantLock` | `ReentrantReadWriteLock` |
| -------------------------------------- | --------------- | ------------------------ |
| Nhiá»u thread ghi, cáº¡nh tranh cao       | âœ…               | âŒ                        |
| Nhiá»u thread chá»‰ Ä‘á»c                   | âŒ               | âœ…                        |
| Thao tÃ¡c Ä‘Æ¡n giáº£n, nested lock Ã­t      | âœ…               | âœ…                        |
| Data structure chia sáº» dá»¯ liá»‡u nhÆ° map | âŒ               | âœ…                        |


# ğŸ”§ 6. Bonus: Condition â€“ chá» vÃ  Ä‘Ã¡nh thá»©c cÃ³ kiá»ƒm soÃ¡t


Condition notEmpty = lock.newCondition();

lock.lock();
try {
    while (queue.isEmpty()) {
        notEmpty.await(); // giá»‘ng wait()
    }
    // xá»­ lÃ½
} finally {
    lock.unlock();
}

â†’ signal() hoáº·c signalAll() sáº½ Ä‘Ã¡nh thá»©c thread Ä‘ang chá»
â†’ TÆ°Æ¡ng Ä‘Æ°Æ¡ng wait() / notify() nhÆ°ng khÃ´ng pháº£i global monitor



# âœ… Tá»•ng káº¿t 
	
| Feature            | ReentrantLock                       | ReentrantReadWriteLock             |
| ------------------ | ----------------------------------- | ---------------------------------- |
| Exclusive Lock     | âœ…                                   | âœ…                                  |
| Shared Read        | âŒ                                   | âœ…                                  |
| Optimized for Read | âŒ                                   | âœ…                                  |
| Reentrancy         | âœ…                                   | âœ…                                  |
| Upgrade Lock       | âš ï¸ KhÃ´ng an toÃ n                    | âŒ Cáº§n trÃ¡nh                        |
| Use Case           | Logic ghi nhiá»u, kiá»ƒm soÃ¡t phá»©c táº¡p | Nhiá»u Ä‘á»c Ã­t ghi, cáº¥u trÃºc dá»¯ liá»‡u |


</pre><a id='backBottom' href='../java-learning-list.html' style='display:none;'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><button onclick='toggleTheme()'>ğŸŒ™ Chuyá»ƒn giao diá»‡n</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>