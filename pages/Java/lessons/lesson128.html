<html><head><title>Lesson 128 == DAA &  Lambda expressions v√† closures ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../java-learning-list.html'>üîô Quay l·∫°i danh s√°ch</a><br><h1>Lesson 128 -- DAA &  Lambda expressions v√† closures -//</h1><pre>
# kh√°i ni·ªám 
	Trong Java, lambda v√† anonymous inner classes c√≥ th·ªÉ captured bi·∫øn t·ª´ scope b√™n ngo√†i ‚Äî nh∆∞ng ch·ªâ v·ªõi ƒëi·ªÅu ki·ªán:
	‚ùó Bi·∫øn ph·∫£i l√† "effectively final"



# üìå 2. "Effectively Final" l√† g√¨?
	Thu·∫≠t ng·ªØ n√†y xu·∫•t hi·ªán t·ª´ Java 8 (JLS ¬ß4.12.4). M·ªôt bi·∫øn effectively final n·∫øu:
		N√≥ ch·ªâ ƒë∆∞·ª£c g√°n ƒë√∫ng m·ªôt l·∫ßn
		Kh√¥ng c·∫ßn khai b√°o final, mi·ªÖn compiler c√≥ th·ªÉ ch·ª©ng minh kh√¥ng c√≥ g√°n l·∫°i sau l·∫ßn ƒë·∫ßu.

	Java lambda l√† closure d·∫°ng capture-by-value (not reference).
		Nghƒ©a l√†:
			Bi·∫øn ƒë∆∞·ª£c copy v√†o runtime object c·ªßa lambda.
			N·∫øu cho ph√©p g√°n l·∫°i sau khi lambda t·∫°o ra, t√≠nh to√†n v·∫πn b·ªã ph√° v·ª° ‚Üí d·∫´n ƒë·∫øn bug kh√¥ng th·ªÉ debug n·ªïi.
			


		
	## ‚úÖ V√≠ d·ª•: 
int x = 10; // effectively final
Runnable r = () -> System.out.println(x); // OK


	## ‚ùå Vi ph·∫°m: 
	
int x = 10;
x = 20; // now it's not effectively final
Runnable r = () -> System.out.println(x); // ‚ùå Compile-time error
	


# üìò 3. LI√äN QUAN ƒê·∫æN DAA 
	## T√¨nh hu·ªëng: s·ª≠ d·ª•ng bi·∫øn local trong lambda 
	Compiler s·∫Ω √°p d·ª•ng DAA ƒë·ªÉ ƒë·∫£m b·∫£o bi·∫øn ƒë√≥ ƒë√£ ƒë∆∞·ª£c kh·ªüi t·∫°o r√µ r√†ng, v√† kh√¥ng thay ƒë·ªïi sau khi capture.
	
void test(boolean flag) {
    int x;
    if (flag) x = 1;
    Runnable r = () -> System.out.println(x); // ‚ùå compile-time error
}

D√π kh√¥ng tr·ª±c ti·∫øp g·ªçi x tr∆∞·ªõc khi g√°n, lambda c√≥ th·ªÉ ƒë∆∞·ª£c th·ª±c thi sau ‚Üí ph·∫£i ƒë·∫£m b·∫£o x ƒë∆∞·ª£c "definitely assigned" tr∆∞·ªõc m·ªçi use-case ti·ªÅm nƒÉng.


# ‚ö†Ô∏è 4. B·∫™Y KHI K·∫æT H·ª¢P DAA + CLOSURE

‚ùå G√°n l·∫°i bi·∫øn sau khi capture
int x = 5;
Runnable r = () -> System.out.println(x);
x = 10; // ‚ùå Compile error ‚Äî x kh√¥ng c√≤n effectively final
‚û°Ô∏è Khi x b·ªã g√°n l·∫°i, n√≥ kh√¥ng c√≤n "effectively final" n·ªØa ‚Üí lambda kh√¥ng ƒë∆∞·ª£c ph√©p s·ª≠ d·ª•ng n√≥.



List<Runnable> jobs = new ArrayList<>();
for (int i = 0; i < 3; i++) {
    jobs.add(() -> System.out.println(i)); // ‚ùå i kh√¥ng effectively final
}

‚û°Ô∏è C√°ch ƒë√∫ng:
for (int i = 0; i < 3; i++) {
    int j = i; // t·∫°o bi·∫øn trung gian "effectively final"
    jobs.add(() -> System.out.println(j)); // ‚úÖ
}


# 3.  DAA + CLOSURE = LU·ªíNG PH√ÇN T√çCH ƒê·ªòC L·∫¨P
	Khi compiler ph√¢n t√≠ch lambda:
	N√≥ t·∫°o m·ªôt CFG ri√™ng bi·ªát cho lambda (nh∆∞ m·ªôt h√†m con),
	Sau ƒë√≥ ki·ªÉm tra c√°c bi·∫øn t·ª´ outer-scope theo ki·ªÉu ‚Äúƒë√≥ng bƒÉng tr·∫°ng th√°i‚Äù.


V√≠ d·ª• n√¢ng cao v·ªõi array: 
void foo() {
    int[] arr = new int[]{1};
    Runnable r = () -> arr[0] = 42; // ‚úÖ OK ‚Äì arr l√† effectively final, ta kh√¥ng g√°n l·∫°i arr
}



# üßµ 7. LI√äN QUAN ƒê·∫æN THREAD, CONCURRENCY
void startThread() {
    int counter = 0;
    new Thread(() -> {
        System.out.println(counter); // ‚ùå compile error ‚Äì counter kh√¥ng effectively final
    }).start();
}

Gi·∫£i ph√°p:
	D√πng AtomicInteger n·∫øu c·∫ßn thay ƒë·ªïi
	D√πng int[] ho·∫∑c wrapper class nh∆∞ Holder


</pre><a id='backBottom' href='../java-learning-list.html' style='display:none;'>üîô Quay l·∫°i danh s√°ch</a><br><button onclick='toggleTheme()'>üåô Chuy·ªÉn giao di·ªán</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>