<html><head><title>Lesson 25 == Module URL ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../NodeJS-learning.html'>üîô Quay l·∫°i danh s√°ch</a><br><h1>Lesson 25 -- Module URL -//</h1><pre>	
# 1. URL Module L√† G√¨?	
	
	const { URL } = require('url');
	ƒê√¢y l√† module t√≠ch h·ª£p s·∫µn (built-in) c·ªßa Node.js, cung c·∫•p 2 API:
	
	
API,M√¥ t·∫£,Khuy·∫øn ngh·ªã
"Legacy API (url.parse, url.format)","C≈©, t·ª´ Node.js v0.x",Kh√¥ng d√πng cho code m·ªõi
"WHATWG URL API (new URL(), URLSearchParams)","Hi·ªán ƒë·∫°i, chu·∫©n web, m·∫°nh m·∫Ω",D√ôNG CHO M·ªåI CODE M·ªöI	
	
	T·ª´ Node.js 10+: URL class ƒë∆∞·ª£c ∆∞u ti√™n ho√†n to√†n.	
	
	
	
# 2. T·∫°i Sao Ph·∫£i D√πng URL Module?	
	V·∫•n ƒë·ªÅ khi t·ª± x·ª≠ l√Ω URL b·∫±ng string:	
	
const url = 'https://example.com/search?q=node.js&lang=en#section1';

// T·ª± c·∫Øt tay ‚Üí D·ªÑ L·ªñI
const query = url.split('?')[1].split('#')[0]; // 'q=node.js&lang=en'	
	
	## 	‚Üí R·ªßi ro: 
		L·ªói khi URL c√≥ # tr∆∞·ªõc ?
		Kh√¥ng x·ª≠ l√Ω Unicode, encoded chars
		Kh√¥ng validate protocol, domain
		D·ªÖ b·ªã URL injection, open redirect	
			
	
	## Gi·∫£i ph√°p: D√πng new URL()
const myURL = new URL('https://example.com/search?q=node.js&lang=en#section1');	
	‚Üí An to√†n, chu·∫©n, t·ª± ƒë·ªông x·ª≠ l√Ω m·ªçi th·ª©.
	
	
	
# 	3. C·∫•u Tr√∫c C·ªßa URL Object
	
Thu·ªôc t√≠nh,Gi√° tr·ªã,M√¥ t·∫£
href,https://user:pass@example.com:8080/p/a/t/h?query=string#hash,To√†n b·ªô URL
origin,https://example.com:8080,Protocol + host
protocol,https:,Giao th·ª©c
username,user,T√™n ƒëƒÉng nh·∫≠p
password,pass,M·∫≠t kh·∫©u
host,example.com:8080,Host + port
hostname,example.com,T√™n mi·ªÅn
port,8080,C·ªïng
pathname,/p/a/t/h,ƒê∆∞·ªùng d·∫´n
search,?query=string,Query string (c√≥ ?)
searchParams,URLSearchParams,Object ƒë·ªÉ thao t√°c query
hash,#hash,Fragment (c√≥ #)	
	
	
# 	4. URLSearchParams ‚Äì "Query String Master"

const url = new URL('https://example.com/?name=Kai&age=30&city=Tokyo');
const params = url.searchParams;


Ph∆∞∆°ng th·ª©c,M√¥ t·∫£
get('name'),'Kai'
getAll('name'),['Kai'] (n·∫øu c√≥ nhi·ªÅu)
has('age'),true
"append('role', 'admin')",Th√™m param
"set('age', '31')",C·∫≠p nh·∫≠t
delete('city'),X√≥a
toString(),'name=Kai&age=31&role=admin'



	## V√≠ d·ª•: X√¢y d·ª±ng query ƒë·ªông
function buildSearchURL(base, filters) {
  const url = new URL(base);
  Object.entries(filters).forEach(([key, value]) => {
    if (value) url.searchParams.append(key, value);
  });
  return url.toString();
}

console.log(buildSearchURL('https://api.example.com/search', {
  q: 'node.js',
  lang: 'en',
  page: 2
}));
// ‚Üí https://api.example.com/search?q=node.js&lang=en&page=2


# 5. So S√°nh: Legacy API vs WHATWG API

T√≠nh nƒÉng,Legacy (url.parse),WHATWG (new URL)
Chu·∫©n,Node.js c≈©,Web standard (browser)
X·ª≠ l√Ω Unicode,Kh√¥ng t·ªët,T·ªët
Query parsing,String ho·∫∑c object ƒë∆°n gi·∫£n,URLSearchParams m·∫°nh m·∫Ω
Error handling,Kh√¥ng throw,Throw n·∫øu URL kh√¥ng h·ª£p l·ªá
Khuy·∫øn ngh·ªã,Kh√¥ng d√πng,D√ôNG CHO M·ªåI CODE M·ªöI



# 6. ·ª®ng D·ª•ng Th·ª±c T·∫ø: File Server D√πng URL Parsing

	T·∫°o 2 file HTML
<h1>Summer</h1><p>I love the sun!</p>	
	
	winter.html 
<h1>Winter</h1><p>I love the snow!</p>	
	
	
	
# File server (demo_fileserver.js)
	
const http = require('http');
const url = require('url');
const fs = require('fs');
const path = require('path');

http.createServer((req, res) => {
  const parsedUrl = url.parse(req.url, true);
  const filename = "." + parsedUrl.pathname;

  // B·∫£o m·∫≠t: NgƒÉn path traversal
  const safePath = path.resolve(__dirname, filename);
  if (!safePath.startsWith(__dirname)) {
    res.writeHead(400);
    return res.end('Invalid path');
  }

  fs.readFile(safePath, (err, data) => {
    if (err) {
      res.writeHead(404, { 'Content-Type': 'text/html' });
      return res.end('404 Not Found');
    }
    res.writeHead(200, { 'Content-Type': 'text/html' });
    res.write(data);
    res.end();
  });
}).listen(8080);

console.log('Server running at http://localhost:8080/');	
	
	
	
	http://localhost:8080/summer.html ‚Üí Hi·ªÉn th·ªã Summer
http://localhost:8080/winter.html ‚Üí Hi·ªÉn th·ªã Winter
	
	


# 7. Best Practices Khi D√πng URL Module

Best Practice,Gi·∫£i th√≠ch
Lu√¥n d√πng new URL(),Thay v√¨ url.parse()
D√πng URLSearchParams,Thao t√°c query an to√†n
Validate URL,D√πng try-catch
NgƒÉn path traversal,D√πng path.resolve() + ki·ªÉm tra __dirname
Encode user input,encodeURIComponent() khi x√¢y URL
Kh√¥ng expose password,X√≥a password tr∆∞·ªõc khi log



# 8. URL Module vs Browser


T√≠nh nƒÉng,Node.js,Browser
new URL(),C√≥,C√≥
URLSearchParams,C√≥,C√≥
URL.canParse() (Node 18+),C√≥,Kh√¥ng
X·ª≠ l√Ω file://,H·∫°n ch·∫ø,Kh√¥ng

Node.js 18+: C√≥ URL.canParse(urlString) ‚Äî ki·ªÉm tra URL h·ª£p l·ªá m√† kh√¥ng throw.

if (URL.canParse(userInput)) {
  const url = new URL(userInput);
}

https://www.w3schools.com/nodejs/nodejs_events.asp










</pre><a id='backBottom' href='../NodeJS-learning.html' style='display:none;'>üîô Quay l·∫°i danh s√°ch</a><br><button onclick='toggleTheme()'>üåô Chuy·ªÉn giao di·ªán</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>