<html><head><title>Lesson 20 == Http Module ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../NodeJS-learning.html'>ðŸ”™ Quay láº¡i danh sÃ¡ch</a><br><h1>Lesson 20 -- Http Module -//</h1><pre>
# 1. HTTP Module LÃ  GÃ¬?
	
	const http = require('http');	
	
ÄÃ¢y lÃ  module tÃ­ch há»£p sáºµn (built-in) cá»§a Node.js, cho phÃ©p báº¡n:

	- Táº¡o web server (nháº­n request, tráº£ response)
	- Gá»­i HTTP request Ä‘áº¿n server khÃ¡c
	- Xá»­ lÃ½ header, body, method, URL, query, streaming, v.v.	
	
	KhÃ´ng cáº§n cÃ i gÃ¬ cáº£ â€” chá»‰ cáº§n require('http').
	
	
	
# 2. Táº¡o HTTP Server CÆ¡ Báº£n (Hello World)
	
const http = require('http');

const server = http.createServer((req, res) => {
  res.writeHead(200, { 'Content-Type': 'text/plain' });
  res.end('Hello, World!\n');
});

server.listen(3000, 'localhost', () => {
  console.log('Server running at http://localhost:3000/');
});
	
	
	## Giáº£i thÃ­ch tá»«ng dÃ²ng (sÃ¢u sáº¯c):
	

		- http.createServer(...)Táº¡o má»™t server instance dá»±a trÃªn event-driven architecture
		- (req, res) => {}Callback cháº¡y má»—i khi cÃ³ request Ä‘áº¿n
		- req (IncomingMessage)Object chá»©a thÃ´ng tin request: URL, method, headers, body
		- res (ServerResponse)Object Ä‘á»ƒ gá»­i response: status, headers, body
		- res.writeHead(200, {...})Gá»­i status code + headers
		- res.end(...)Gá»­i body + káº¿t thÃºc response
		- server.listen(port, host, callback)
	
	Node.js lÃ  non-blocking: Server cÃ³ thá»ƒ xá»­ lÃ½ hÃ ng nghÃ¬n request Ä‘á»“ng thá»i nhá» Event Loop.
	
	
# 	3. HTTP Headers â€“ "Metadata" Cá»§a Request & Response
	
	Response Headers (gá»­i tá»« server)
	
res.writeHead(200, {
  'Content-Type': 'text/html',
  'X-Powered-By': 'Node.js',
  'Cache-Control': 'no-cache',
  'Set-Cookie': 'session=abc123; HttpOnly'
});	
	
	
Header,Ã nghÄ©a
Content-Type,"Kiá»ƒu dá»¯ liá»‡u tráº£ vá»: text/html, application/json, image/png"
Cache-Control,"Kiá»ƒm soÃ¡t cache: no-cache, max-age=3600"
Set-Cookie,Gá»­i cookie vá» client
Location,"DÃ¹ng cho redirect (301, 302)"


	## Request Headers (client gá»­i lÃªn)
		console.log(req.headers['user-agent']);
		console.log(req.headers['authorization']);



# 4. Xá»­ LÃ½ URL & Query Parameters

	## 4.1. DÃ¹ng req.url
		console.log(req.url); // "/users?id=123&name=John"


	## 4.2. DÃ¹ng url.parse() (cÅ©) â†’ KhÃ´ng khuyáº¿n khÃ­ch
	
		const url = require('url');
		const parsed = url.parse(req.url, true);
		console.log(parsed.pathname); // "/users"
		console.log(parsed.query.id);  // "123"
		

	## 4.3. DÃ¹ng new URL() (má»›i, chuáº©n WHATWG) â†’ KHUYáº¾N KHÃCH
	
const { URL } = require('url');
const myURL = new URL(req.url, `http://${req.headers.host}`);

console.log(myURL.pathname);      // "/users"
console.log(myURL.searchParams.get('id')); // "123"	const { URL } = require('url');
const myURL = new URL(req.url, `http://${req.headers.host}`);

console.log(myURL.pathname);      // "/users"
console.log(myURL.searchParams.get('id')); // "123"
	
	
		Parse chÃ­nh xÃ¡c, an toÃ n
		Há»— trá»£ Unicode, IPv6
		Dá»… láº¥y tá»«ng param: searchParams.get(), searchParams.has()	
	
	
	
# 5. Xá»­ LÃ½ CÃ¡c HTTP Methods (REST API CÆ¡ Báº£n)

Method		Má»¥c Ä‘Ã­ch		Idempotent?
GET			Láº¥y dá»¯ liá»‡u			Yes
POST		,Táº¡o má»›i			,No
PUT			,Cáº­p nháº­t toÃ n bá»™	,Yes
PATCH		,Cáº­p nháº­t má»™t pháº§n	,No
DELETE		,XÃ³a				,Yes



# VÃ­ dá»¥: API quáº£n lÃ½ Todo (full CRUD)

let todos = [
  { id: 1, task: "Há»c Node.js", completed: false }
];

const server = http.createServer((req, res) => {
  const { method, url } = req;
  const parsed = new URL(url, `http://${req.headers.host}`);
  const path = parsed.pathname;

  // CORS (cho dev)
  res.setHeader('Access-Control-Allow-Origin', '*');
  res.setHeader('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');

  if (method === 'OPTIONS') {
    res.writeHead(204);
    res.end();
    return;
  }

  // GET /todos
  if (method === 'GET' && path === '/todos') {
    res.writeHead(200, { 'Content-Type': 'application/json' });
    res.end(JSON.stringify(todos));
  }

  // POST /todos
  else if (method === 'POST' && path === '/todos') {
    let body = '';
    req.on('data', chunk => body += chunk);
    req.on('end', () => {
      try {
        const newTodo = JSON.parse(body);
        newTodo.id = todos.length + 1;
        todos.push(newTodo);
        res.writeHead(201, { 'Content-Type': 'application/json' });
        res.end(JSON.stringify(newTodo));
      } catch {
        res.writeHead(400, { 'Content-Type': 'application/json' });
        res.end(JSON.stringify({ error: 'Invalid JSON' }));
      }
    });
  }

  // 404
  else {
    res.writeHead(404);
    res.end();
  }
});

server.listen(3000);


	LÆ°u Ã½: ÄÃ¢y lÃ  raw HTTP server â€” báº¡n sáº½ tháº¥y Express.js lÃ m má»i thá»© gá»n hÆ¡n ráº¥t nhiá»u.



# 6. Xá»­ LÃ½ Request Body (POST, PUT)

let body = '';
req.on('data', chunk => {
  body += chunk.toString();
});
req.on('end', () => {
  const data = JSON.parse(body);
  // xá»­ lÃ½...
});

	Dá»… bá»‹ Buffer Overflow náº¿u khÃ´ng giá»›i háº¡n
	KhÃ´ng xá»­ lÃ½ multipart/form-data (upload file)




	## Giáº£i phÃ¡p chuyÃªn nghiá»‡p:


// Giá»›i háº¡n kÃ­ch thÆ°á»›c body
server.on('clientError', (err, socket) => {
  if (err.code === 'HPE_INVALID_CONTENT_LENGTH') {
    socket.end('HTTP/1.1 413 Payload Too Large\r\n\r\n');
  }
});

// Hoáº·c dÃ¹ng middleware (Express) hoáº·c thÆ° viá»‡n nhÆ° `busboy` cho file upload




# 7. Streaming â€“ Xá»­ LÃ½ File Lá»›n, Video, Log

	VÃ­ dá»¥: Stream file lá»›n (khÃ´ng load toÃ n bá»™ vÃ o RAM)

const fs = require('fs');
const path = require('path');

http.createServer((req, res) => {
  const filePath = path.join(__dirname, 'big-video.mp4');

  fs.stat(filePath, (err, stat) => {
    if (err) {
      res.writeHead(404);
      res.end();
      return;
    }

    res.writeHead(200, {
      'Content-Type': 'video/mp4',
      'Content-Length': stat.size
    });

    const stream = fs.createReadStream(filePath);
    stream.pipe(res); // <<<< Magic: streaming!
  });
}).listen(3000);



	- KhÃ´ng tá»‘n RAM (xá»­ lÃ½ theo chunk)
	- Tá»± Ä‘á»™ng backpressure (náº¿u client cháº­m, stream sáº½ pause)
	- DÃ¹ng cho: video streaming, file download, log tailing, proxy




# 8. Best Practices Khi DÃ¹ng HTTP Module


Best Practice,Giáº£i thÃ­ch
DÃ¹ng new URL(),Thay vÃ¬ url.parse()
LuÃ´n set Content-Type,TrÃ¡nh lá»—i hiá»ƒn thá»‹
Giá»›i háº¡n body size,TrÃ¡nh DoS attack
Xá»­ lÃ½ lá»—i req.on('error'),TrÃ¡nh crash server
KhÃ´ng dÃ¹ng trong production,DÃ¹ng Express.js cho real app
DÃ¹ng HTTPS trong production,DÃ¹ng https module hoáº·c reverse proxy (Nginx)





# 9. So SÃ¡nh: HTTP Module vs Express.js


TÃ­nh nÄƒng,HTTP Module,Express.js
CÃº phÃ¡p,DÃ i dÃ²ng,Ngáº¯n gá»n
Routing,Manual if/else,"app.get('/users', ...)"
Middleware,KhÃ´ng cÃ³,"CÃ³ (body-parser, cors, auth)"
Error handling,Manual,next(err)
PhÃ¹ há»£p,"Há»c cÆ¡ cháº¿, tool nhá»","Web app, API thá»±c táº¿"


HTTP Module = há»c cÃ¡ch xe hÆ¡i hoáº¡t Ä‘á»™ng
Express.js = lÃ¡i xe hÆ¡i





https://www.w3schools.com/nodejs/nodejs_https.asp








</pre><a id='backBottom' href='../NodeJS-learning.html' style='display:none;'>ðŸ”™ Quay láº¡i danh sÃ¡ch</a><br><button onclick='toggleTheme()'>ðŸŒ™ Chuyá»ƒn giao diá»‡n</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>