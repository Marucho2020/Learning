<html><head><title>Lesson 6 == Node.js V8 Engine ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../NodeJS-learning.html'>üîô Quay l·∫°i danh s√°ch</a><br><h1>Lesson 6 -- Node.js V8 Engine -//</h1><pre>
# 1. What is the V8 Engine?
		
	## T√†i li·ªáu n√™u:	
		
		- V8 l√† engine JavaScript m√£ ngu·ªìn m·ªü c·ªßa Google, d√πng trong Chrome v√† Node.js.
		- N√≥ bi√™n d·ªãch JavaScript th√†nh m√£ m√°y (machine code) ƒë·ªÉ th·ª±c thi nhanh.		
		
		Origin: Ra m·∫Øt nƒÉm 2008 cho Chrome.
		Integration: Node.js d√πng V8 ƒë·ªÉ ch·∫°y JavaScript tr√™n server.
		Features: JIT Compilation, Garbage Collection hi·ªáu qu·∫£, h·ªó tr·ª£ ES6+.		
		
		
	## Gi·∫£i th√≠ch chi ti·∫øt:  	
		
		- V8 l√† g√¨? V8 l√† m·ªôt JavaScript engine, chuy·ªÉn code JavaScript th√†nh m√£ m√°y m√† CPU hi·ªÉu tr·ª±c ti·∫øp. Kh√¥ng nh∆∞ c√°c engine c≈© (nh∆∞ SpiderMonkey c·ªßa Firefox), V8 bi√™n d·ªãch (compile) thay v√¨ th√¥ng d·ªãch (interpret), n√™n r·∫•t nhanh.
		- Vai tr√≤ trong Node.js: Node.js kh√¥ng t·ª± ch·∫°y JavaScript m√† d·ª±a v√†o V8 ƒë·ªÉ th·ª±c thi. V8 x·ª≠ l√Ω logic JavaScript, c√≤n Node.js cung c·∫•p c√°c API (nh∆∞ fs, http) ƒë·ªÉ t∆∞∆°ng t√°c v·ªõi h·ªá th·ªëng.
		- So s√°nh v·ªõi browser: Trong Chrome, V8 ch·∫°y code ƒë·ªÉ render UI, x·ª≠ l√Ω DOM. Trong Node.js, V8 ch·∫°y code ƒë·ªÉ x·ª≠ l√Ω file, network, ho·∫∑c database.
		- V√≠ d·ª• th·ª±c t·∫ø: Khi b·∫°n ch·∫°y node app.js, V8 bi√™n d·ªãch code JavaScript th√†nh m√£ m√°y, r·ªìi Node.js d√πng c√°c module C++ ƒë·ªÉ k·∫øt n·ªëi v·ªõi h·ªá ƒëi·ªÅu h√†nh.		
		
		
# 	2. Why V8 Makes Node.js Fast	
	T√†i li·ªáu li·ªát k√™ c√°c k·ªπ thu·∫≠t gi√∫p V8 nhanh:	
		
		- Just-In-Time (JIT) Compilation
		- Hidden Classes
		- Efficient Garbage Collection
		- Inline Caching		
		
	## 	Just-In-Time (JIT) Compilation:
		
		- C√°ch ho·∫°t ƒë·ªông: V8 kh√¥ng ch·∫°y JavaScript tr·ª±c ti·∫øp m√† bi√™n d·ªãch n√≥ th√†nh m√£ m√°y tr∆∞·ªõc ho·∫∑c trong l√∫c ch·∫°y. JIT k·∫øt h·ª£p bi√™n d·ªãch (compile-time) v√† th√¥ng d·ªãch (run-time) ƒë·ªÉ t·ªëi ∆∞u t·ªëc ƒë·ªô.
		- V√≠ d·ª•: Code nh∆∞ const sum = (a, b) => a + b; ƒë∆∞·ª£c bi√™n d·ªãch th√†nh m√£ m√°y, thay v√¨ ƒë·ªçc t·ª´ng d√≤ng nh∆∞ th√¥ng d·ªãch.
		- Ng·ªØ c·∫£nh: JIT gi√∫p Node.js x·ª≠ l√Ω h√†ng ngh√¨n request HTTP m·ªói gi√¢y m√† kh√¥ng ch·∫≠m.		
		
		
	## 	Hidden Classes:
		C√°ch ho·∫°t ƒë·ªông: V8 t·∫°o c√°c "hidden classes" ƒë·ªÉ theo d√µi c·∫•u tr√∫c c·ªßa object JavaScript. N·∫øu b·∫°n th√™m/x√≥a thu·ªôc t√≠nh c·ªßa object, V8 c·∫≠p nh·∫≠t hidden class ƒë·ªÉ t·ªëi ∆∞u truy c·∫≠p.
		
		V√≠ d·ª•
		
			const obj = {};
			obj.x = 1; // Hidden class 1
			obj.y = 2; // Hidden class 2		
			V8 ghi nh·ªõ c·∫•u tr√∫c c·ªßa obj ƒë·ªÉ truy c·∫≠p obj.x nhanh h∆°n.
		Ng·ªØ c·∫£nh: Trong Node.js, hidden classes gi√∫p x·ª≠ l√Ω JSON ho·∫∑c d·ªØ li·ªáu database nhanh h∆°n.


	## Efficient Garbage Collection

		- C√°ch ho·∫°t ƒë·ªông: V8 t·ª± ƒë·ªông thu h·ªìi b·ªô nh·ªõ t·ª´ c√°c object kh√¥ng c√≤n d√πng (garbage collection), tr√°nh memory leak.
		- V√≠ d·ª•: N·∫øu b·∫°n t·∫°o h√†ng ngh√¨n object trong v√≤ng l·∫∑p, V8 s·∫Ω d·ªçn d·∫πp nh·ªØng object kh√¥ng c√≤n tham chi·∫øu.
		- Ng·ªØ c·∫£nh: Quan tr·ªçng trong server Node.js ch·∫°y l√¢u d√†i, ƒë·∫£m b·∫£o kh√¥ng h·∫øt b·ªô nh·ªõ.

	## Inline Caching:

		- C√°ch ho·∫°t ƒë·ªông: V8 l∆∞u cache v·ªã tr√≠ c·ªßa thu·ªôc t√≠nh trong object ƒë·ªÉ gi·∫£m th·ªùi gian truy c·∫≠p.
		- V√≠ d·ª•: Trong obj.x, V8 nh·ªõ r·∫±ng x ·ªü offset n√†o trong hidden class, n√™n l·∫ßn sau truy c·∫≠p nhanh h∆°n.
		- Ng·ªØ c·∫£nh: H·ªØu √≠ch khi b·∫°n l·∫∑p l·∫°i c√°c thao t√°c tr√™n object, nh∆∞ x·ª≠ l√Ω request trong server.


# 3. Check V8 Version in Node.js

	console.log(`V8 version: ${process.versions.v8}`);

	Gi·∫£i th√≠ch chi ti·∫øt:

		- process.versions: M·ªôt object ch·ª©a th√¥ng tin phi√™n b·∫£n c·ªßa Node.js v√† c√°c th√†nh ph·∫ßn li√™n quan.
		- process.versions.v8: Tr·∫£ v·ªÅ phi√™n b·∫£n V8 ƒëang d√πng (v√≠ d·ª•: 10.8.168.25-node.20).
		- T·∫°i sao c·∫ßn? Ki·ªÉm tra phi√™n b·∫£n V8 gi√∫p b·∫°n bi·∫øt li·ªáu m·ªôt t√≠nh nƒÉng JavaScript m·ªõi (nh∆∞ Array.prototype.at) c√≥ ƒë∆∞·ª£c h·ªó tr·ª£ kh√¥ng.
		- Ng·ªØ c·∫£nh: M·ªói phi√™n b·∫£n Node.js g·∫Øn v·ªõi m·ªôt phi√™n b·∫£n V8. V√≠ d·ª•, Node.js 20.19.5 d√πng V8 10.8, h·ªó tr·ª£ ƒë·∫ßy ƒë·ªß ES2023.


# 4. Understanding V8's Role in Node.js

	V8 cung c·∫•p m√¥i tr∆∞·ªùng th·ª±c thi JavaScript cho Node.js.

	Cho ph√©p

		- Ch·∫°y JavaScript ngo√†i browser.
		- Truy c·∫≠p h·ªá th·ªëng (file, network) qua c√°c module Node.js.
		- T·∫≠n d·ª•ng c√πng engine v·ªõi Chrome, ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n.

	## Gi·∫£i th√≠ch chi ti·∫øt:
		- M√¥i tr∆∞·ªùng th·ª±c thi: V8 x·ª≠ l√Ω logic JavaScript (nh∆∞ t√≠nh to√°n, v√≤ng l·∫∑p, h√†m). Node.js b·ªï sung c√°c binding C++ ƒë·ªÉ k·∫øt n·ªëi V8 v·ªõi h·ªá ƒëi·ªÅu h√†nh (v√≠ d·ª•: ƒë·ªçc file qua fs).

		- Kh√°c browser: Trong browser, V8 t∆∞∆°ng t√°c v·ªõi DOM v√† Web APIs. Trong Node.js, V8 k·∫øt h·ª£p v·ªõi Libuv (th∆∞ vi·ªán C cho event loop) v√† c√°c module ƒë·ªÉ x·ª≠ l√Ω I/O.
		
		- T√≠nh nh·∫•t qu√°n: Code JavaScript vi·∫øt cho Chrome th∆∞·ªùng ch·∫°y ƒë∆∞·ª£c tr√™n Node.js (tr·ª´ DOM/Web APIs), nh·ªù c√πng V8.



# 5. V8 Memory Usage

	const v8 = require('v8');
	const heapStats = v8.getHeapStatistics();
	console.log('Heap size limit:', (heapStats.heap_size_limit / 1024 / 1024).toFixed(2), 'MB');
	console.log('Total heap size:', (heapStats.total_heap_size / 1024 / 1024).toFixed(2), 'MB');
	console.log('Used heap size:', (heapStats.used_heap_size / 1024 / 1024).toFixed(2), 'MB');


		Module v8: Cung c·∫•p API ƒë·ªÉ truy c·∫≠p th√¥ng tin v·ªÅ V8 engine, nh∆∞ th·ªëng k√™ b·ªô nh·ªõ (heap).
		v8.getHeapStatistics(): Tr·∫£ v·ªÅ object ch·ª©a th√¥ng tin v·ªÅ heap:
		
		heap_size_limit: Gi·ªõi h·∫°n b·ªô nh·ªõ t·ªëi ƒëa (th∆∞·ªùng ~4GB tr√™n 64-bit, c√≥ th·ªÉ ƒëi·ªÅu ch·ªânh b·∫±ng --max-old-space-size).
		total_heap_size: T·ªïng b·ªô nh·ªõ heap ƒë∆∞·ª£c c·∫•p ph√°t.
		used_heap_size: B·ªô nh·ªõ ƒëang d√πng.




# 6. V8's Update Cycle

		- V8 li√™n t·ª•c ƒë∆∞·ª£c c·∫≠p nh·∫≠t v·ªõi t√≠nh nƒÉng JavaScript m·ªõi v√† t·ªëi ∆∞u hi·ªáu su·∫•t.
		- Node.js th∆∞·ªùng xuy√™n update V8.
		- V8 h·ªó tr·ª£ chu·∫©n ECMAScript v√† WebAssembly.

	## Gi·∫£i th√≠ch chi ti·∫øt:
		
		- C·∫≠p nh·∫≠t V8: Google ph√°t tri·ªÉn V8 cho Chrome, v√† Node.js t√≠ch h·ª£p c√°c phi√™n b·∫£n V8 m·ªõi trong m·ªói b·∫£n ph√°t h√†nh (6 th√°ng/l·∫ßn). V√≠ d·ª•, Node.js 20.x d√πng V8 10.8, h·ªó tr·ª£ ES2023.
		
		- ECMAScript: V8 tri·ªÉn khai c√°c t√≠nh nƒÉng m·ªõi nh∆∞ Promise.any, Array.prototype.at. Khi ECMAScript chu·∫©n h√≥a t√≠nh nƒÉng, V8 s·∫Ω th√™m v√†o, ƒë·ªìng b·ªô gi·ªØa Chrome v√† Node.js.
		
		- WebAssembly: V8 c≈©ng ch·∫°y WebAssembly (code nh·ªã ph√¢n hi·ªáu su·∫•t cao), nh∆∞ng √≠t d√πng trong Node.js c∆° b·∫£n.
		
		- Ng·ªØ c·∫£nh: N·∫øu b·∫°n c·∫ßn t√≠nh nƒÉng m·ªõi (nh∆∞ String.prototype.replaceAll), ki·ªÉm tra phi√™n b·∫£n V8 qua process.versions.v8.


https://www.w3schools.com/nodejs/nodejs_architecture.asp







</pre><a id='backBottom' href='../NodeJS-learning.html' style='display:none;'>üîô Quay l·∫°i danh s√°ch</a><br><button onclick='toggleTheme()'>üåô Chuy·ªÉn giao di·ªán</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>