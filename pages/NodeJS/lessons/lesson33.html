<html><head><title>Lesson 33 == Utils ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../NodeJS-learning.html'>üîô Quay l·∫°i danh s√°ch</a><br><h1>Lesson 33 -- Utils -//</h1><pre>
# TOP 7 H√ÄM B·∫†N S·∫º D√ôNG M√ÉI M√ÉI (90% gi√° tr·ªã n·∫±m ƒë√¢y)


# util.promisify() 
		Bi·∫øn callback ‚Üí Promise , D√πng async/await v·ªõi fs, dns, child_process‚Ä¶ 

	. util.promisify() ‚Äì ‚ÄúSi√™u anh h√πng‚Äù c·ªßa Node.js hi·ªán ƒë·∫°i
	
	## Tr∆∞·ªõc ƒë√¢y: 
	
fs.readFile('data.txt', 'utf8', (err, data) => {
  if (err) throw err;
  console.log(data);
});

	## Sau khi c√≥ promisify ‚Üí code ƒë·∫πp nh∆∞ m∆°:

const fs = require('fs');
const util = require('util');
const readFile = util.promisify(fs.readFile);

async function main() {
  const data = await readFile('data.txt', 'utf8');
  console.log(data);
}
main();



	## C√°c h√†m hay ƒë∆∞·ª£c promisify nh·∫•t: 
		fs t·∫•t c·∫£ (readFile, writeFile, mkdir, ‚Ä¶)
		dns.lookup, dns.resolve‚Ä¶
		child_process.exec
		crypto.randomBytes, crypto.pbkdf2



# util.format() console.log th√¥ng minh
		Nh∆∞ printf, console.log th√¥ng minh , Log ƒë·∫πp, debug nhanh


console.log(util.format('%s c√≥ %d tu·ªïi', 'Grok', 1));
// ‚Üí Grok c√≥ 1 tu·ªïi

console.log(util.format('Error: %j', {code: 500, msg: 'Server error'}));
// ‚Üí Error: {"code":500,"msg":"Server error"}
	
	## R·∫•t hay d√πng khi vi·∫øt logger: 
function log(level, msg, meta) {
  console.log(util.format('[%s] %s %j', level, msg, meta));
}



# util.debuglog() 
		Log c√≥ ƒëi·ªÅu ki·ªán theo NODE_DEBUG, Debug production m√† kh√¥ng l√†m ng·∫≠p log


const debug = util.debuglog('my-app');

debug('Ch·ªâ hi·ªán khi ch·∫°y: NODE_DEBUG=my-app node app.js');
// ‚Üí my-app:12345: User login t·ª´ IP 127.0.0.1 +123ms


	## C√°ch d√πng th·ª±c t·∫ø: 
	
const debug = util.debuglog('http');

http.createServer((req, res) => {
  debug('Request:', req.method, req.url);
  // ch·ªâ hi·ªán khi NODE_DEBUG=http
});	
	
	
# 	util.inspect() ‚Äì In object ƒë·∫πp nh∆∞ Postman 
		In object c·ª±c ƒë·∫πp, c√≥ m√†u, c√≥ depth , Debug object l·ªìng nhau
	
	
const user = {
  id: 1,
  profile: { name: 'Grok', hobbies: ['code', 'h·ªçc'] },
  buffer: Buffer.from('secret')
};

console.log(util.inspect(user, {
  colors: true,     // c√≥ m√†u trong terminal
  depth: 10,        // in s√¢u bao nhi√™u c·∫•p
  showHidden: true  // hi·ªán c·∫£ property kh√¥ng enumerable
}));
	
		‚Üí In ra c·ª±c ƒë·∫πp, d·ªÖ debug object l·ªìng s√¢u.
	
	
	
# 	util.types  ‚Äì Ki·ªÉm tra ki·ªÉu ch√≠nh x√°c
		Ki·ªÉm tra ki·ªÉu d·ªØ li·ªáu ch√≠nh x√°c , isPromise, isAsyncFunction, isMap‚Ä¶
	
	
util.types.isPromise(p)              // true n·∫øu l√† Promise
util.types.isAsyncFunction(fn)       // true n·∫øu l√† async function
util.types.isMap(obj)                // true n·∫øu l√† Map
util.types.isSet(obj)                // true n·∫øu l√† Set
util.types.isDate(obj)               // true n·∫øu l√† Date th·∫≠t	
	
	
	## R·∫•t hay d√πng khi vi·∫øt middleware:
	
if (!util.types.isAsyncFunction(handler)) {
  throw new Error('Handler ph·∫£i l√† async function');
}	
	
	

	

# util.callbackify() 
	‚Äì Khi ph·∫£i h·ªó tr·ª£ c·∫£ callback l·∫´n Promise
		Bi·∫øn Promise ‚Üí callback , Khi ph·∫£i t∆∞∆°ng th√≠ch API c≈© 


const readFileAsync = util.promisify(fs.readFile);

const readFileCallback = util.callbackify(readFileAsync);

readFileCallback('data.txt', 'utf8', (err, data) => {
  // v·∫´n ho·∫°t ƒë·ªông v·ªõi code c≈©
});


	
	
# util.inherits() 
		K·∫ø th·ª´a class ki·ªÉu c≈© (r·∫•t √≠t d√πng nay) , Ch·ªâ c√≤n trong legacy code
	
	// C≈© (tr∆∞·ªõc ES6 class)
		util.inherits(MyError, Error);
	
	‚Üí Gi·ªù d√πng class MyError extends Error l√† xong, √≠t d√πng.
	
	
	

</pre><a id='backBottom' href='../NodeJS-learning.html' style='display:none;'>üîô Quay l·∫°i danh s√°ch</a><br><button onclick='toggleTheme()'>üåô Chuy·ªÉn giao di·ªán</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>