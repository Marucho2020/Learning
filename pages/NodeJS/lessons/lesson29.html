<html><head><title>Lesson 29 == Crypto Module ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../NodeJS-learning.html'>üîô Quay l·∫°i danh s√°ch</a><br><h1>Lesson 29 -- Crypto Module -//</h1><pre>
# T·ªîNG QUAN: Crypto Module l√† g√¨?

	Crypto = M√£ h√≥a (Cryptography) ‚Äì gi√∫p b·∫°n b·∫£o v·ªá d·ªØ li·ªáu trong ·ª©ng d·ª•ng.
	Node.js t√≠ch h·ª£p s·∫µn OpenSSL ‚Üí b·∫°n c√≥ th·ªÉ d√πng c√°c thu·∫≠t to√°n m√£ h√≥a m·∫°nh, an to√†n, ƒë√£ ƒë∆∞·ª£c ki·ªÉm ch·ª©ng.
	
	
const crypto = require('crypto'); // ‚Üê D√πng ngay, kh√¥ng c·∫ßn c√†i



# 6 CH·ª®C NƒÇNG CH√çNH (PH·∫¢I BI·∫æT KHI ƒêI L√ÄM)

Ch·ª©c nƒÉng,D√πng ƒë·ªÉ l√†m g√¨?,V√≠ d·ª• th·ª±c t·∫ø
1. Hash,BƒÉm d·ªØ li·ªáu ‚Üí kh√¥ng th·ªÉ ƒë·∫£o ng∆∞·ª£c,L∆∞u m·∫≠t kh·∫©u
2. HMAC,X√°c th·ª±c + to√†n v·∫πn d·ªØ li·ªáu,"API key, webhook"
3. M√£ h√≥a ƒë·ªëi x·ª©ng,M√£ h√≥a/gi·∫£i m√£ d·ªØ li·ªáu,"M√£ h√≥a file, tin nh·∫Øn"
4. M√£ h√≥a b·∫•t ƒë·ªëi x·ª©ng,G·ª≠i d·ªØ li·ªáu an to√†n,"HTTPS, JWT"
5. Ch·ªØ k√Ω s·ªë,X√°c minh ng∆∞·ªùi g·ª≠i,K√Ω h·ª£p ƒë·ªìng ƒëi·ªán t·ª≠
6. T·∫°o s·ªë ng·∫´u nhi√™n an to√†n,"T·∫°o kh√≥a, salt, IV",T·∫°o token




# 1. HASH ‚Äì BƒÉm d·ªØ li·ªáu (Kh√¥ng th·ªÉ ƒë·∫£o ng∆∞·ª£c) 

const hash = crypto.createHash('sha256')
                   .update('hello')
                   .digest('hex');
console.log(hash); 
// ‚Üí 2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824




	## Thu·∫≠t to√°n n√†o n√™n d√πng?

Thu·∫≠t to√°n,An to√†n?,D√πng khi
md5,Kh√¥ng,Ch·ªâ ƒë·ªÉ checksum file
sha1,Kh√¥ng,"C≈©, kh√¥ng d√πng"
sha256,R·∫•t t·ªët,M·∫∑c ƒë·ªãnh d√πng
sha512,C·ª±c t·ªët,C·∫ßn ƒë·ªô an to√†n cao



# 2. L∆ØU M·∫¨T KH·∫®U AN TO√ÄN (QUAN TR·ªåNG NH·∫§T!)

	Kh√¥ng bao gi·ªù l∆∞u m·∫≠t kh·∫©u d·∫°ng text ho·∫∑c SHA256 ƒë∆°n thu·∫ßn!


	## Sai l·∫ßm ph·ªï bi·∫øn:

// ƒê·ª™NG L√ÄM TH·∫æ N√ÄY!
const hash = crypto.createHash('sha256').update(password).digest('hex');

	‚Üí D·ªÖ b·ªã rainbow table attack


	## ƒê√öNG: D√πng Salt + scrypt/bcrypt

function hashPassword(password) {
  const salt = crypto.randomBytes(16).toString('hex'); // ng·∫´u nhi√™n
  const hash = crypto.scryptSync(password, salt, 64).toString('hex');
  return { salt, hash }; // l∆∞u c·∫£ 2 v√†o DB
}

function verifyPassword(password, salt, storedHash) {
  const hash = crypto.scryptSync(password, salt, 64).toString('hex');
  return hash === storedHash;
}


	## T·∫°i sao scrypt t·ªët?

		Ch·∫≠m c√≥ ch·ªß ƒë√≠ch ‚Üí ch·ªëng brute-force
		D√πng b·ªô nh·ªõ ‚Üí ch·ªëng GPU attack

	Chuy√™n gia khuy√™n: D√πng bcrypt (th∆∞ vi·ªán) thay scrypt trong production:
npm install bcrypt

const bcrypt = require('bcrypt');
const hash = await bcrypt.hash(password, 12); // 12 = ƒë·ªô kh√≥
const isValid = await bcrypt.compare(password, hash);



# 3. HMAC ‚Äì X√°c th·ª±c tin nh·∫Øn (API, Webhook)

const secret = 'my-secret-key';
const message = 'user123';

const hmac = crypto.createHmac('sha256', secret)
                   .update(message)
                   .digest('hex');


	## D√πng ƒë·ªÉ:
		X√°c minh ng∆∞·ªùi g·ª≠i ƒë√∫ng
		ƒê·∫£m b·∫£o d·ªØ li·ªáu kh√¥ng b·ªã s·ª≠a
		
// So s√°nh an to√†n (ch·ªëng timing attack)
crypto.timingSafeEqual(Buffer.from(a), Buffer.from(b))



# 4. M√É H√ìA ƒê·ªêI X·ª®NG (AES) ‚Äì M√£ h√≥a file, tin nh·∫Øn

	C√πng 1 key ƒë·ªÉ m√£ h√≥a + gi·∫£i m√£

function encrypt(text, password) {
  const key = crypto.scryptSync(password, 'salt', 32); // 256-bit key
  const iv = crypto.randomBytes(16); // IV ph·∫£i ng·∫´u nhi√™n m·ªói l·∫ßn!

  const cipher = crypto.createCipheriv('aes-256-cbc', key, iv);
  let encrypted = cipher.update(text, 'utf8', 'hex');
  encrypted += cipher.final('hex');

  return { iv: iv.toString('hex'), data: encrypted };
}

function decrypt(encrypted, iv, password) {
  const key = crypto.scryptSync(password, 'salt', 32);
  const decipher = crypto.createDecipheriv('aes-256-cbc', key, Buffer.from(iv, 'hex'));
  let decrypted = decipher.update(encrypted, 'hex', 'utf8');
  decrypted += decipher.final('utf8');
  return decrypted;
}


	L∆∞u √Ω v√†ng:
		IV ph·∫£i ng·∫´u nhi√™n m·ªói l·∫ßn
		Kh√¥ng bao gi·ªù d√πng l·∫°i IV + key


# 5. M√É H√ìA B·∫§T ƒê·ªêI X·ª®NG (RSA) ‚Äì G·ª≠i key an to√†n

		Public key: m√£ h√≥a
		Private key: gi·∫£i m√£

// T·∫°o c·∫∑p kh√≥a
const { publicKey, privateKey } = crypto.generateKeyPairSync('rsa', {
  modulusLength: 2048,
  publicKeyEncoding: { type: 'spki', format: 'pem' },
  privateKeyEncoding: { type: 'pkcs8', format: 'pem' }
});

// M√£ h√≥a b·∫±ng public key
const encrypted = crypto.publicEncrypt(publicKey, Buffer.from('secret')).toString('base64');

// Gi·∫£i m√£ b·∫±ng private key
const decrypted = crypto.privateDecrypt(privateKey, Buffer.from(encrypted, 'base64')).toString();


	D√πng khi n√†o?
		G·ª≠i session key qua m·∫°ng
		K√Ω JWT, ch·ªØ k√Ω s·ªë



# 6. CH·ªÆ K√ù S·ªê ‚Äì X√°c minh ng∆∞·ªùi g·ª≠i

const sign = crypto.createSign('sha256');
sign.update('data');
const signature = sign.sign(privateKey, 'base64');

const verify = crypto.createVerify('sha256');
verify.update('data');
const isValid = verify.verify(publicKey, signature, 'base64');

	‚Üí D√πng trong: h·ª£p ƒë·ªìng ƒëi·ªán t·ª≠, c·∫≠p nh·∫≠t ph·∫ßn m·ªÅm




# 7. T·∫†O S·ªê NG·∫™U NHI√äN AN TO√ÄN

crypto.randomBytes(16).toString('hex'); // ‚Üí kh√≥a, token
crypto.randomUUID(); // ‚Üí "f47ac10b-58cc-4372-a567-0e02b2c3d479"


# T√ìM T·∫ÆT NHANH ‚Äì B·∫¢NG CHEAT SHEET

M·ª•c ƒë√≠ch,D√πng g√¨?,V√≠ d·ª•
L∆∞u m·∫≠t kh·∫©u,bcrypt ho·∫∑c scrypt + salt,"bcrypt.hash(pw, 12)"
X√°c th·ª±c API,HMAC-SHA256,"createHmac('sha256', key)"
M√£ h√≥a file,AES-256-CBC + IV ng·∫´u nhi√™n,createCipheriv
G·ª≠i key an to√†n,RSA,publicEncrypt
K√Ω tin nh·∫Øn,RSA + createSign,sign.sign(privateKey)
T·∫°o token,crypto.randomBytes(32),.toString('hex')



# L·ªúI KHUY√äN T·ª™ CHUY√äN GIA

ƒê√∫ng,Sai
D√πng bcrypt cho m·∫≠t kh·∫©u,D√πng sha256(password)
D√πng timingSafeEqual,D√πng === so s√°nh hash
T·∫°o IV ng·∫´u nhi√™n m·ªói l·∫ßn,D√πng IV c·ªë ƒë·ªãnh
D√πng randomBytes,D√πng Math.random()
D√πng scrypt/PBKDF2,D√πng md5



https://www.w3schools.com/nodejs/nodejs_timers.asp










</pre><a id='backBottom' href='../NodeJS-learning.html' style='display:none;'>üîô Quay l·∫°i danh s√°ch</a><br><button onclick='toggleTheme()'>üåô Chuy·ªÉn giao di·ªán</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>