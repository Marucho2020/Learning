<html><head><title>Lesson 29 == Crypto Module ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../NodeJS-learning.html'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><h1>Lesson 29 -- Crypto Module -//</h1><pre>
# Tá»”NG QUAN: Crypto Module lÃ  gÃ¬?

	Crypto = MÃ£ hÃ³a (Cryptography) â€“ giÃºp báº¡n báº£o vá»‡ dá»¯ liá»‡u trong á»©ng dá»¥ng.
	Node.js tÃ­ch há»£p sáºµn OpenSSL â†’ báº¡n cÃ³ thá»ƒ dÃ¹ng cÃ¡c thuáº­t toÃ¡n mÃ£ hÃ³a máº¡nh, an toÃ n, Ä‘Ã£ Ä‘Æ°á»£c kiá»ƒm chá»©ng.
	
	
const crypto = require('crypto'); // â† DÃ¹ng ngay, khÃ´ng cáº§n cÃ i



# 6 CHá»¨C NÄ‚NG CHÃNH (PHáº¢I BIáº¾T KHI ÄI LÃ€M)

Chá»©c nÄƒng,DÃ¹ng Ä‘á»ƒ lÃ m gÃ¬?,VÃ­ dá»¥ thá»±c táº¿
1. Hash,BÄƒm dá»¯ liá»‡u â†’ khÃ´ng thá»ƒ Ä‘áº£o ngÆ°á»£c,LÆ°u máº­t kháº©u
2. HMAC,XÃ¡c thá»±c + toÃ n váº¹n dá»¯ liá»‡u,"API key, webhook"
3. MÃ£ hÃ³a Ä‘á»‘i xá»©ng,MÃ£ hÃ³a/giáº£i mÃ£ dá»¯ liá»‡u,"MÃ£ hÃ³a file, tin nháº¯n"
4. MÃ£ hÃ³a báº¥t Ä‘á»‘i xá»©ng,Gá»­i dá»¯ liá»‡u an toÃ n,"HTTPS, JWT"
5. Chá»¯ kÃ½ sá»‘,XÃ¡c minh ngÆ°á»i gá»­i,KÃ½ há»£p Ä‘á»“ng Ä‘iá»‡n tá»­
6. Táº¡o sá»‘ ngáº«u nhiÃªn an toÃ n,"Táº¡o khÃ³a, salt, IV",Táº¡o token




# 1. HASH â€“ BÄƒm dá»¯ liá»‡u (KhÃ´ng thá»ƒ Ä‘áº£o ngÆ°á»£c) 

const hash = crypto.createHash('sha256')
                   .update('hello')
                   .digest('hex');
console.log(hash); 
// â†’ 2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824




	## Thuáº­t toÃ¡n nÃ o nÃªn dÃ¹ng?

Thuáº­t toÃ¡n,An toÃ n?,DÃ¹ng khi
md5,KhÃ´ng,Chá»‰ Ä‘á»ƒ checksum file
sha1,KhÃ´ng,"CÅ©, khÃ´ng dÃ¹ng"
sha256,Ráº¥t tá»‘t,Máº·c Ä‘á»‹nh dÃ¹ng
sha512,Cá»±c tá»‘t,Cáº§n Ä‘á»™ an toÃ n cao



# 2. LÆ¯U Máº¬T KHáº¨U AN TOÃ€N (QUAN TRá»ŒNG NHáº¤T!)

	KhÃ´ng bao giá» lÆ°u máº­t kháº©u dáº¡ng text hoáº·c SHA256 Ä‘Æ¡n thuáº§n!


	## Sai láº§m phá»• biáº¿n:

// Äá»ªNG LÃ€M THáº¾ NÃ€Y!
const hash = crypto.createHash('sha256').update(password).digest('hex');

	â†’ Dá»… bá»‹ rainbow table attack


	## ÄÃšNG: DÃ¹ng Salt + scrypt/bcrypt

function hashPassword(password) {
  const salt = crypto.randomBytes(16).toString('hex'); // ngáº«u nhiÃªn
  const hash = crypto.scryptSync(password, salt, 64).toString('hex');
  return { salt, hash }; // lÆ°u cáº£ 2 vÃ o DB
}

function verifyPassword(password, salt, storedHash) {
  const hash = crypto.scryptSync(password, salt, 64).toString('hex');
  return hash === storedHash;
}


	## Táº¡i sao scrypt tá»‘t?

		Cháº­m cÃ³ chá»§ Ä‘Ã­ch â†’ chá»‘ng brute-force
		DÃ¹ng bá»™ nhá»› â†’ chá»‘ng GPU attack

	ChuyÃªn gia khuyÃªn: DÃ¹ng bcrypt (thÆ° viá»‡n) thay scrypt trong production:
npm install bcrypt

const bcrypt = require('bcrypt');
const hash = await bcrypt.hash(password, 12); // 12 = Ä‘á»™ khÃ³
const isValid = await bcrypt.compare(password, hash);



# 3. HMAC â€“ XÃ¡c thá»±c tin nháº¯n (API, Webhook)

const secret = 'my-secret-key';
const message = 'user123';

const hmac = crypto.createHmac('sha256', secret)
                   .update(message)
                   .digest('hex');


	## DÃ¹ng Ä‘á»ƒ:
		XÃ¡c minh ngÆ°á»i gá»­i Ä‘Ãºng
		Äáº£m báº£o dá»¯ liá»‡u khÃ´ng bá»‹ sá»­a
		
// So sÃ¡nh an toÃ n (chá»‘ng timing attack)
crypto.timingSafeEqual(Buffer.from(a), Buffer.from(b))



# 4. MÃƒ HÃ“A Äá»I Xá»¨NG (AES) â€“ MÃ£ hÃ³a file, tin nháº¯n

	CÃ¹ng 1 key Ä‘á»ƒ mÃ£ hÃ³a + giáº£i mÃ£

function encrypt(text, password) {
  const key = crypto.scryptSync(password, 'salt', 32); // 256-bit key
  const iv = crypto.randomBytes(16); // IV pháº£i ngáº«u nhiÃªn má»—i láº§n!

  const cipher = crypto.createCipheriv('aes-256-cbc', key, iv);
  let encrypted = cipher.update(text, 'utf8', 'hex');
  encrypted += cipher.final('hex');

  return { iv: iv.toString('hex'), data: encrypted };
}

function decrypt(encrypted, iv, password) {
  const key = crypto.scryptSync(password, 'salt', 32);
  const decipher = crypto.createDecipheriv('aes-256-cbc', key, Buffer.from(iv, 'hex'));
  let decrypted = decipher.update(encrypted, 'hex', 'utf8');
  decrypted += decipher.final('utf8');
  return decrypted;
}


	LÆ°u Ã½ vÃ ng:
		IV pháº£i ngáº«u nhiÃªn má»—i láº§n
		KhÃ´ng bao giá» dÃ¹ng láº¡i IV + key


# 5. MÃƒ HÃ“A Báº¤T Äá»I Xá»¨NG (RSA) â€“ Gá»­i key an toÃ n

		Public key: mÃ£ hÃ³a
		Private key: giáº£i mÃ£

// Táº¡o cáº·p khÃ³a
const { publicKey, privateKey } = crypto.generateKeyPairSync('rsa', {
  modulusLength: 2048,
  publicKeyEncoding: { type: 'spki', format: 'pem' },
  privateKeyEncoding: { type: 'pkcs8', format: 'pem' }
});

// MÃ£ hÃ³a báº±ng public key
const encrypted = crypto.publicEncrypt(publicKey, Buffer.from('secret')).toString('base64');

// Giáº£i mÃ£ báº±ng private key
const decrypted = crypto.privateDecrypt(privateKey, Buffer.from(encrypted, 'base64')).toString();


	DÃ¹ng khi nÃ o?
		Gá»­i session key qua máº¡ng
		KÃ½ JWT, chá»¯ kÃ½ sá»‘



# 6. CHá»® KÃ Sá» â€“ XÃ¡c minh ngÆ°á»i gá»­i

const sign = crypto.createSign('sha256');
sign.update('data');
const signature = sign.sign(privateKey, 'base64');

const verify = crypto.createVerify('sha256');
verify.update('data');
const isValid = verify.verify(publicKey, signature, 'base64');

	â†’ DÃ¹ng trong: há»£p Ä‘á»“ng Ä‘iá»‡n tá»­, cáº­p nháº­t pháº§n má»m




# 7. Táº O Sá» NGáºªU NHIÃŠN AN TOÃ€N

crypto.randomBytes(16).toString('hex'); // â†’ khÃ³a, token
crypto.randomUUID(); // â†’ "f47ac10b-58cc-4372-a567-0e02b2c3d479"


# TÃ“M Táº®T NHANH â€“ Báº¢NG CHEAT SHEET

Má»¥c Ä‘Ã­ch,DÃ¹ng gÃ¬?,VÃ­ dá»¥
LÆ°u máº­t kháº©u,bcrypt hoáº·c scrypt + salt,"bcrypt.hash(pw, 12)"
XÃ¡c thá»±c API,HMAC-SHA256,"createHmac('sha256', key)"
MÃ£ hÃ³a file,AES-256-CBC + IV ngáº«u nhiÃªn,createCipheriv
Gá»­i key an toÃ n,RSA,publicEncrypt
KÃ½ tin nháº¯n,RSA + createSign,sign.sign(privateKey)
Táº¡o token,crypto.randomBytes(32),.toString('hex')



# Lá»œI KHUYÃŠN Tá»ª CHUYÃŠN GIA

ÄÃºng,Sai
DÃ¹ng bcrypt cho máº­t kháº©u,DÃ¹ng sha256(password)
DÃ¹ng timingSafeEqual,DÃ¹ng === so sÃ¡nh hash
Táº¡o IV ngáº«u nhiÃªn má»—i láº§n,DÃ¹ng IV cá»‘ Ä‘á»‹nh
DÃ¹ng randomBytes,DÃ¹ng Math.random()
DÃ¹ng scrypt/PBKDF2,DÃ¹ng md5





</pre><a id='backBottom' href='../NodeJS-learning.html' style='display:none;'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><button onclick='toggleTheme()'>ğŸŒ™ Chuyá»ƒn giao diá»‡n</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>