<html><head><title>Lesson 8 == Event Loop ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../NodeJS-learning.html'>üîô Quay l·∫°i danh s√°ch</a><br><h1>Lesson 8 -- Event Loop -//</h1><pre>
# T·ªïng Quan Ph·∫ßn "Node.js Event Loop"				
				
	M·ª•c ti√™u: Hi·ªÉu event loop ‚Äì c∆° ch·∫ø gi√∫p Node.js non-blocking v√† hi·ªáu qu·∫£, bao g·ªìm			
				
		- Event Loop l√† g√¨? Th√†nh ph·∫ßn qu·∫£n l√Ω c√°c t√°c v·ª• b·∫•t ƒë·ªìng b·ªô, cho ph√©p x·ª≠ l√Ω nhi·ªÅu k·∫øt n·ªëi ƒë·ªìng th·ªùi.
		- C√°ch ho·∫°t ƒë·ªông: C√°c giai ƒëo·∫°n (phases) c·ªßa event loop v√† th·ª© t·ª± ∆∞u ti√™n.
		- V√≠ d·ª• th·ª±c t·∫ø: Minh h·ªça th·ª© t·ª± th·ª±c thi c·ªßa synchronous code, microtasks, timers, v√† c√°c callback kh√°c.
		- T·∫°i sao quan tr·ªçng? Gi·∫£i th√≠ch l√Ω do Node.js ph√π h·ª£p cho real-time apps, APIs, v√† streaming.
		- T√≥m t·∫Øt: T·ªïng k·∫øt l·ª£i √≠ch c·ªßa m√¥ h√¨nh non-blocking.				
				
				
	T·∫°i sao quan tr·ªçng? Event loop l√† n·ªÅn t·∫£ng c·ªßa hi·ªáu su·∫•t Node.js. Hi·ªÉu n√≥ gi√∫p b·∫°n:			
				
		Vi·∫øt code b·∫•t ƒë·ªìng b·ªô hi·ªáu qu·∫£, tr√°nh ch·∫∑n lu·ªìng ch√≠nh.
		Debug c√°c v·∫•n ƒë·ªÅ li√™n quan ƒë·∫øn th·ª© t·ª± th·ª±c thi.
		T·ªëi ∆∞u ·ª©ng d·ª•ng ƒë·ªÉ x·ª≠ l√Ω nhi·ªÅu k·∫øt n·ªëi (nh∆∞ server API ho·∫∑c chat app).				


	C√°ch ch·∫°y v√≠ d·ª•:

		- T·∫°o file .js (v√≠ d·ª•: eventloop.js) v√† ch·∫°y b·∫±ng node eventloop.js.
		- D√πng terminal ho·∫∑c VS Code ƒë·ªÉ ki·ªÉm tra output.
		- Kh√¥ng c·∫ßn file ph·ª• tr·ª£ (nh∆∞ myfile.txt) v√¨ c√°c v√≠ d·ª• ƒë·ªÅu d√πng timers v√† Promises.


# 1. What is the Event Loop?

	Event loop l√† c∆° ch·∫ø gi√∫p Node.js non-blocking v√† hi·ªáu qu·∫£.
	
	N√≥ giao c√°c t√°c v·ª• cho h·ªá th·ªëng (qua Libuv) v√† x·ª≠ l√Ω k·∫øt qu·∫£ qua callbacks, cho ph√©p qu·∫£n l√Ω h√†ng ngh√¨n k·∫øt n·ªëi ƒë·ªìng th·ªùi tr√™n m·ªôt lu·ªìng duy nh·∫•t.

	## Gi·∫£i th√≠ch chi ti·∫øt:

		Event Loop l√† g√¨? Event loop l√† m·ªôt v√≤ng l·∫∑p v√¥ h·∫°n (infinite loop) trong Node.js, li√™n t·ª•c ki·ªÉm tra v√† x·ª≠ l√Ω c√°c s·ª± ki·ªán (events) t·ª´ Event Queue v√† Callback Queue. N√≥ ƒë∆∞·ª£c tri·ªÉn khai b·ªüi Libuv, kh√¥ng ph·∫£i V8.
		
		Non-blocking: Thay v√¨ ch·ªù m·ªôt t√°c v·ª• I/O (nh∆∞ ƒë·ªçc file, request HTTP) ho√†n t·∫•t, event loop giao vi·ªác cho h·ªá th·ªëng v√† ti·∫øp t·ª•c x·ª≠ l√Ω t√°c v·ª• kh√°c. Khi I/O xong, callback ƒë∆∞·ª£c ƒë∆∞a v√†o queue ƒë·ªÉ x·ª≠ l√Ω.
		
		Single-threaded: Event loop ch·∫°y tr√™n lu·ªìng ch√≠nh (main thread), nh∆∞ng v·∫´n x·ª≠ l√Ω nhi·ªÅu k·∫øt n·ªëi nh·ªù giao c√°c t√°c v·ª• n·∫∑ng (nh∆∞ I/O) cho Thread Pool c·ªßa Libuv.
		
		V√≠ d·ª• th·ª±c t·∫ø: M·ªôt server Node.js c√≥ th·ªÉ x·ª≠ l√Ω 10,000 request HTTP c√πng l√∫c v√¨ event loop kh√¥ng ƒë·ª£i t·ª´ng request ho√†n t·∫•t m√† x·∫øp ch√∫ng v√†o queue v√† x·ª≠ l√Ω d·∫ßn.
		
		Ng·ªØ c·∫£nh: Event loop l√† l√Ω do Node.js ph√π h·ª£p cho c√°c ·ª©ng d·ª•ng nh∆∞ chat (WebSocket), streaming video, ho·∫∑c API REST.
		
	## 	H√¨nh dung ƒë∆°n gi·∫£n:
		
			- Server nh·∫≠n request ‚Üí ƒê∆∞a v√†o Event Queue.
			- Event Loop l·∫•y request ‚Üí Giao t√°c v·ª• n·∫∑ng (nh∆∞ ƒë·ªçc file) cho Thread Pool.
			- Thread Pool ho√†n t·∫•t ‚Üí ƒê∆∞a callback v√†o Callback Queue.
			- Event Loop ch·∫°y callback ‚Üí G·ª≠i response cho client.		
		
		
		
# 	2. How the Event Loop Works	
		
	## 	0. Th·ª±c thi code ƒë·ªìng b·ªô (synchronous code).
		
			X·ª≠ l√Ω microtasks (process.nextTick, Promises).
			Th·ª±c thi timers (setTimeout, setInterval).
			Ch·∫°y I/O callbacks (file, network).
			X·ª≠ l√Ω setImmediate callbacks.
			X·ª≠ l√Ω close events (socket.on('close')).		
		
		
				- B∆∞·ªõc 0 - Synchronous Code: Code kh√¥ng b·∫•t ƒë·ªìng b·ªô (nh∆∞ console.log) ch·∫°y ngay l·∫≠p t·ª©c trong main thread.
				- B∆∞·ªõc 1 - Microtasks: Bao g·ªìm process.nextTick (∆∞u ti√™n cao nh·∫•t) v√† Promise callbacks (.then, .catch). Ch√∫ng ch·∫°y ngay sau synchronous code v√† tr∆∞·ªõc c√°c giai ƒëo·∫°n kh√°c.
				- B∆∞·ªõc 2 - Timers: X·ª≠ l√Ω c√°c callback c·ªßa setTimeout v√† setInterval khi th·ªùi gian ch·ªù h·∫øt.
				- B∆∞·ªõc 3 - I/O Callbacks: X·ª≠ l√Ω c√°c callback t·ª´ I/O ho√†n t·∫•t (nh∆∞ fs.readFile, HTTP response).
				- B∆∞·ªõc 4 - Poll Phase: Ki·ªÉm tra I/O m·ªõi v√† ch·∫°y callback n·∫øu c√≥.
				- B∆∞·ªõc 5 - Check Phase: Ch·∫°y c√°c callback c·ªßa setImmediate.
				- B∆∞·ªõc 6 - Close Phase: X·ª≠ l√Ω cleanup (nh∆∞ socket ƒë√≥ng).		
		
			L∆∞u √Ω: Sau m·ªói giai ƒëo·∫°n, event loop ki·ªÉm tra microtasks queue (process.nextTick, Promises) tr∆∞·ªõc khi sang giai ƒëo·∫°n ti·∫øp theo.
		
console.log('First');
setTimeout(() => console.log('Third'), 0);
Promise.resolve().then(() => console.log('Second'));
console.log('Fourth');		
		
First
Fourth
Second
Third	
		
		
		
	Synchronous code: console.log('First') v√† console.log('Fourth') ch·∫°y ngay, in First v√† Fourth.
	Microtasks: Promise.resolve().then(...) ƒë∆∞·ª£c x·∫øp v√†o microtask queue, ch·∫°y ngay sau synchronous code, in Second.
	Timers: setTimeout(..., 0) x·∫øp v√†o timer queue, ch·∫°y sau microtasks, in Third.
	T·∫°i sao setTimeout ch·∫°y sau d√π delay l√† 0? V√¨ setTimeout thu·ªôc Timer phase, c√≥ ∆∞u ti√™n th·∫•p h∆°n microtasks.		
		


# 3. Event Loop Phases
	T√†i li·ªáu li·ªát k√™ c√°c giai ƒëo·∫°n:

	## 0. Timers: setTimeout, setInterval.

		- I/O Callbacks: Callback t·ª´ I/O (file, network).
		- Poll: Ki·ªÉm tra I/O m·ªõi.
		- Check: setImmediate.
		- Close: Cleanup callbacks (socket.on('close')).

	Microtasks: process.nextTick v√† Promises ch·∫°y gi·ªØa c√°c giai ƒëo·∫°n.


console.log('1. Start');

// Next tick queue
process.nextTick(() => console.log('2. Next tick'));

// Microtask queue (Promise)
Promise.resolve().then(() => console.log('3. Promise'));

// Timer phase
setTimeout(() => console.log('4. Timeout'), 0);

// Check phase
setImmediate(() => console.log('5. Immediate'));

console.log('6. End');

1. Start
6. End
2. Next tick
3. Promise
4. Timeout
5. Immediate


	## Gi·∫£i th√≠ch chi ti·∫øt:

		Synchronous code: 1. Start v√† 6. End ch·∫°y ngay.
		Microtasks
			process.nextTick c√≥ ∆∞u ti√™n cao nh·∫•t, in 2. Next tick.
			Promise .then ch·∫°y ti·∫øp, in 3. Promise.
		Timer phase: setTimeout(..., 0) ch·∫°y, in 4. Timeout.	
		Check phase: setImmediate ch·∫°y, in 5. Immediate.	
			
			process.nextTick lu√¥n ch·∫°y tr∆∞·ªõc t·∫•t c·∫£ (ngay c·∫£ Promises).
			Microtasks (Promises) ch·∫°y tr∆∞·ªõc c√°c giai ƒëo·∫°n event loop.
			Timer phase ch·∫°y tr∆∞·ªõc Check phase.			
			
			
			
	## 	Ng·ªØ c·∫£nh th·ª±c t·∫ø:
			
		- Trong server API, HTTP requests ƒë∆∞·ª£c x·∫øp v√†o Poll phase.
		- Trong chat app, WebSocket events c≈©ng v√†o Poll phase.
		- setImmediate h·ªØu √≠ch khi b·∫°n mu·ªën ch·∫°y code sau I/O nh∆∞ng tr∆∞·ªõc timers ti·∫øp theo.			
		
		
		
# 4. Why is the Event Loop Important?		
		
	Event loop cho ph√©p Node.js x·ª≠ l√Ω h√†ng ngh√¨n k·∫øt n·ªëi ƒë·ªìng th·ªùi v·ªõi m·ªôt lu·ªìng duy nh·∫•t, ph√π h·ª£p cho:	
		
		- Real-time applications: Chat, notifications, collaboration tools.
		- APIs v√† microservices: REST, GraphQL.
		- Data streaming: Video, file transfer.
		- Chat applications: WebSocket-based apps.		
		
		
	Gi·∫£i th√≠ch chi ti·∫øt:	
		
		H√†ng ngh√¨n k·∫øt n·ªëi: Event loop kh√¥ng ch·ªù I/O (nh∆∞ ƒë·ªçc file, query database), n√™n server c√≥ th·ªÉ x·ª≠ l√Ω nhi·ªÅu request c√πng l√∫c. V√≠ d·ª•, m·ªôt server Express.js c√≥ th·ªÉ ph·ª•c v·ª• 10,000 client m√† ch·ªâ d√πng ~100MB RAM.
		
		
			Real-time: WebSocket (nh∆∞ Socket.IO) t·∫≠n d·ª•ng Poll phase ƒë·ªÉ x·ª≠ l√Ω message li√™n t·ª•c.
			APIs: REST/GraphQL API d√πng event loop ƒë·ªÉ tr·∫£ response nhanh, ngay c·∫£ khi query database.
			Streaming: Event loop x·ª≠ l√Ω t·ª´ng chunk d·ªØ li·ªáu (nh∆∞ video streaming) m√† kh√¥ng ch·∫∑n.	
		
		V√≠ d·ª• th·ª±c t·∫ø:
		
			Chat app: Client g·ª≠i tin nh·∫Øn ‚Üí Event Queue ‚Üí Event Loop x·ª≠ l√Ω ‚Üí G·ª≠i qua WebSocket.
			API: Client g·ªçi /users ‚Üí Event Loop query database (I/O) ‚Üí Tr·∫£ JSON response.		
		
		
		
# 5. Summary
		
			- Node.js d√πng event loop ƒë·ªÉ x·ª≠ l√Ω t√°c v·ª• b·∫•t ƒë·ªìng b·ªô.
			- C√°c lo·∫°i callback c√≥ ∆∞u ti√™n kh√°c nhau (microtasks > timers > I/O > setImmediate > close).
			- Microtasks (process.nextTick, Promises) ch·∫°y tr∆∞·ªõc m·ªói giai ƒëo·∫°n.
			- M√¥ h√¨nh non-blocking cho ph√©p x·ª≠ l√Ω cao ƒë·ªô ƒë·ªìng th·ªùi.		
			
			
			Non-blocking: Event loop ƒë·∫£m b·∫£o main thread kh√¥ng b·ªã ch·∫∑n, ngay c·∫£ khi c√≥ t√°c v·ª• n·∫∑ng (I/O ƒë∆∞·ª£c giao cho Thread Pool).
			∆Øu ti√™n: Hi·ªÉu th·ª© t·ª± ∆∞u ti√™n gi√∫p b·∫°n d·ª± ƒëo√°n th·ª© t·ª± th·ª±c thi code, tr√°nh l·ªói logic.
			Hi·ªáu su·∫•t: M√¥ h√¨nh n√†y l√†m Node.js l√Ω t∆∞·ªüng cho ·ª©ng d·ª•ng I/O-heavy, nh∆∞ng c·∫ßn c·∫©n th·∫≠n v·ªõi CPU-heavy tasks (d√πng Worker Threads n·∫øu c·∫ßn).		
		
		
		
		
https://www.w3schools.com/nodejs/nodejs_async.asp


</pre><a id='backBottom' href='../NodeJS-learning.html' style='display:none;'>üîô Quay l·∫°i danh s√°ch</a><br><button onclick='toggleTheme()'>üåô Chuy·ªÉn giao di·ªán</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>