<html><head><title>Lesson 26 == Events ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../NodeJS-learning.html'>ðŸ”™ Quay láº¡i danh sÃ¡ch</a><br><h1>Lesson 26 -- Events -//</h1><pre>

# 1. Events LÃ  GÃ¬? Táº¡i Sao Quan Trá»ng?
	Má»i thá»© trong Node.js Ä‘á»u lÃ  event:

Sá»± kiá»‡n,VÃ­ dá»¥
CÃ³ káº¿t ná»‘i má»›i,"server.on('connection', ...)"
CÃ³ request Ä‘áº¿n,"req.on('data', ...)"
File Ä‘á»c xong,"readStream.on('end', ...)"
Lá»—i xáº£y ra,"emitter.on('error', ...)"

	â†’ EventEmitter lÃ  class giÃºp báº¡n táº¡o ra cÃ¡c event riÃªng vÃ  pháº£n há»“i khi event xáº£y ra.

const EventEmitter = require('events');
const myEmitter = new EventEmitter();



# 2. Cáº¥u TrÃºc CÆ¡ Báº£n Cá»§a EventEmitter

const EventEmitter = require('events');
const emitter = new EventEmitter();

// 1. ÄÄƒng kÃ½ listener (nghe event)
emitter.on('tÃªn_event', () => {
  console.log('Event xáº£y ra!');
});

// 2. KÃ­ch hoáº¡t event
emitter.emit('tÃªn_event'); // â†’ In ra: Event xáº£y ra!



# 3 PhÆ°Æ¡ng Thá»©c Quan Trá»ng Nháº¥t

PhÆ°Æ¡ng thá»©c,MÃ´ táº£,VÃ­ dá»¥
"on(event, listener)",Nghe event (cÃ³ thá»ƒ nhiá»u láº§n),"emitter.on('data', handler)"
"once(event, listener)",Nghe chá»‰ 1 láº§n,"emitter.once('connect', handler)"
"emit(event, ...args)",KÃ­ch hoáº¡t event,"emitter.emit('userJoined', 'John')"
"off(event, listener)",Gá»¡ listener,"emitter.off('data', handler)"




# 3. VÃ­ Dá»¥ Thá»±c Táº¿: Chat Room DÃ¹ng EventEmitter

const EventEmitter = require('events');

class ChatRoom extends EventEmitter {
  join(username) {
    console.log(`${username} Ä‘Ã£ vÃ o phÃ²ng chat`);
    this.emit('join', username);
  }

  sendMessage(username, message) {
    console.log(`[${username}]: ${message}`);
    this.emit('message', { username, message, time: new Date() });
  }

  leave(username) {
    console.log(`${username} Ä‘Ã£ rá»i phÃ²ng`);
    this.emit('leave', username);
  }
}

const chat = new ChatRoom();

// ÄÄƒng kÃ½ cÃ¡c listener
chat.on('join', (user) => {
  console.log(`ChÃ o má»«ng ${user} Ä‘áº¿n vá»›i phÃ²ng chat!`);
});

chat.on('message', (data) => {
  console.log(`Tin nháº¯n má»›i: ${data.message} tá»« ${data.username}`);
});

chat.once('leave', (user) => {
  console.log(`Táº¡m biá»‡t ${user}! Hy vá»ng gáº·p láº¡i!`);
});

// Sá»­ dá»¥ng
chat.join('Alice');
chat.sendMessage('Alice', 'Xin chÃ o má»i ngÆ°á»i!');
chat.sendMessage('Bob', 'ChÃ o Alice!');
chat.leave('Alice');
chat.leave('Alice'); // KhÃ´ng in "Táº¡m biá»‡t" láº§n 2 vÃ¬ dÃ¹ng once()


Alice Ä‘Ã£ vÃ o phÃ²ng chat
ChÃ o má»«ng Alice Ä‘áº¿n vá»›i phÃ²ng chat!
[Alice]: Xin chÃ o má»i ngÆ°á»i!
Tin nháº¯n má»›i: Xin chÃ o má»i ngÆ°á»i! tá»« Alice
[Bob]: ChÃ o Alice!
Tin nháº¯n má»›i: ChÃ o Alice! tá»« Bob
Alice Ä‘Ã£ rá»i phÃ²ng
Táº¡m biá»‡t Alice! Hy vá»ng gáº·p láº¡i!




# 4. EventEmitter Trong CÃ¡c Module Core

Báº¡n Ä‘Ã£ dÃ¹ng EventEmitter hÃ ng ngÃ y mÃ  khÃ´ng biáº¿t!

Module,DÃ¹ng EventEmitter
http.Server,"server.on('request', ...)"
fs.ReadStream,"stream.on('data', ...)"
net.Socket,"socket.on('data', ...)"
process,"process.on('exit', ...)"

	â†’ Táº¥t cáº£ Ä‘á»u káº¿ thá»«a tá»« EventEmitter!

const http = require('http');
const server = http.createServer();

server.on('request', (req, res) => {
  res.end('Hello World');
});

server.on('connection', (socket) => {
  console.log('CÃ³ káº¿t ná»‘i má»›i!');
});




# 5. Best Practices â€“ Nhá»¯ng Äiá»u CHUYÃŠN GIA LuÃ´n LÃ m

	## 1. LuÃ´n xá»­ lÃ½ event 'error' 
	
emitter.on('error', (err) => {
  console.error('Lá»—i:', err.message);
  // Gá»­i log, alert, hoáº·c graceful shutdown
});

// Náº¿u khÃ´ng cÃ³ listener cho 'error' â†’ Node.js sáº½ crash!
emitter.emit('error', new Error('Boom!')); // Unhandled error â†’ crash

	Quy táº¯c vÃ ng: Má»i EventEmitter pháº£i cÃ³ listener cho 'error'



	## Quy táº¯c vÃ ng: Má»i EventEmitter pháº£i cÃ³ listener cho 'error'

// Xáº¤U
emitter.on('data', (data) => { ... });

// Tá»T
function handleData(data) {
  console.log('Data:', data);
}
emitter.on('data', handleData);

// Dá»… debug, dá»… gá»¡ listener
emitter.off('data', handleData);



	## 3. Gá»¡ listener khi khÃ´ng cáº§n ná»¯a (trÃ¡nh memory leak)

const interval = setInterval(() => {
  emitter.emit('tick');
}, 1000);

// Sau 10 giÃ¢y, gá»¡ listener
setTimeout(() => {
  clearInterval(interval);
  emitter.off('tick', onTick); // QUAN TRá»ŒNG!
}, 10000);




	## 4. Giá»›i háº¡n sá»‘ listener (máº·c Ä‘á»‹nh 10)
	
emitter.setMaxListeners(20); // TÄƒng giá»›i háº¡n
console.log(emitter.getMaxListeners()); // 20

// Kiá»ƒm tra sá»‘ listener hiá»‡n táº¡i
console.log(emitter.listenerCount('data'));
console.log(emitter.listeners('data')); // Array cÃ¡c function






# 6. NÃ¢ng Cao: Táº¡o Custom Event Emitter Class

const EventEmitter = require('events');

class Logger extends EventEmitter {
  log(message) {
    console.log(`[LOG] ${message}`);
    this.emit('log', { message, timestamp: new Date() });
  }

  error(err) {
    console.error(`[ERROR] ${err.message}`);
    this.emit('error', err);
  }
}

const logger = new Logger();

logger.on('log', (data) => {
  // Gá»­i log Ä‘áº¿n file, database, Slack, v.v.
  console.log('ÄÃ£ ghi log:', data);
});

logger.on('error', (err) => {
  // Gá»­i alert Ä‘áº¿n monitoring system
  console.log('ÄÃ£ ghi lá»—i:', err.message);
});

logger.log('Server khá»Ÿi Ä‘á»™ng');
logger.error(new Error('Database connection failed'));



# 7. So SÃ¡nh: Callback vs Event vs Promise

CÃ¡ch,Æ¯u Ä‘iá»ƒm,NhÆ°á»£c Ä‘iá»ƒm,DÃ¹ng khi
Callback,ÄÆ¡n giáº£n,Callback hell,I/O Ä‘Æ¡n
Promise,"Clean, chainable",KhÃ´ng tá»‘t cho stream,HTTP request
EventEmitter,"Real-time, nhiá»u listener",Phá»©c táº¡p hÆ¡n,"Stream, server, real-time"

	## Káº¿t há»£p tá»‘t nháº¥t:

// Stream (Event) â†’ Promise
function readFileAsPromise(path) {
  return new Promise((resolve, reject) => {
    const stream = fs.createReadStream(path);
    let data = '';
    stream.on('data', chunk => data += chunk);
    stream.on('end', () => resolve(data));
    stream.on('error', reject);
  });
}





</pre><a id='backBottom' href='../NodeJS-learning.html' style='display:none;'>ðŸ”™ Quay láº¡i danh sÃ¡ch</a><br><button onclick='toggleTheme()'>ðŸŒ™ Chuyá»ƒn giao diá»‡n</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>