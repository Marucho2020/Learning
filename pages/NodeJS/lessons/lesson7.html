<html><head><title>Lesson 7 == NodeJS Architecture ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../NodeJS-learning.html'>üîô Quay l·∫°i danh s√°ch</a><br><h1>Lesson 7 -- NodeJS Architecture -//</h1><pre>

#	T·ªïng Quan Ph·∫ßn "Node.js Architecture"

	M·ª•c ti√™u: Hi·ªÉu ki·∫øn tr√∫c c·ªßa Node.js, bao g·ªìm:

		- Ki·∫øn tr√∫c t·ªïng th·ªÉ: Single-threaded, event-driven, non-blocking I/O.
		- Lu·ªìng x·ª≠ l√Ω request: T·ª´ client request ƒë·∫øn response qua event queue v√† event loop.
		- Non-blocking vs Blocking: C√°ch Node.js x·ª≠ l√Ω t√°c v·ª• hi·ªáu qu·∫£.
		- Khi n√†o d√πng Node.js: C√°c ·ª©ng d·ª•ng ph√π h·ª£p v√† kh√¥ng ph√π h·ª£p.
		- L·ª£i √≠ch ch√≠nh: Hi·ªáu su·∫•t cao, x·ª≠ l√Ω nhi·ªÅu k·∫øt n·ªëi ƒë·ªìng th·ªùi, d·ªÖ d√πng v·ªõi JavaScript

	T·∫°i sao quan tr·ªçng? Hi·ªÉu ki·∫øn tr√∫c gi√∫p b·∫°n:
	
		- Vi·∫øt code t·∫≠n d·ª•ng t·ªëi ƒëa hi·ªáu su·∫•t c·ªßa Node.js.
		- Tr√°nh c√°c l·ªói ph·ªï bi·∫øn nh∆∞ ch·∫∑n event loop.
		- Ch·ªçn ƒë√∫ng c√¥ng c·ª• cho d·ª± √°n (v√≠ d·ª•: Node.js cho API, kh√¥ng cho CPU-heavy tasks).

		T·∫°o file .js (v√≠ d·ª•: arch.js) v√† ch·∫°y b·∫±ng node arch.js.
		C·∫ßn file myfile.txt cho c√°c v√≠ d·ª• v·ªÅ ƒë·ªçc file.
		D√πng terminal ho·∫∑c VS Code ƒë·ªÉ ki·ªÉm tra output.


# 1. What is Node.js Architecture?

	Node.js s·ª≠ d·ª•ng ki·∫øn tr√∫c single-threaded, event-driven, ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ x·ª≠ l√Ω nhi·ªÅu k·∫øt n·ªëi ƒë·ªìng th·ªùi m√† kh√¥ng ch·∫∑n lu·ªìng ch√≠nh.

	Ph√π h·ª£p cho scalable network applications, real-time apps, v√† APIs.
	
	ƒê·∫∑c ƒëi·ªÉm ch√≠nh: Non-blocking I/O, event-driven, single-threaded v·ªõi event loop, th·ª±c thi b·∫•t ƒë·ªìng b·ªô.	
	
	
	# Gi·∫£i th√≠ch chi ti·∫øt:
	
		Single-threaded: Node.js ch·ªâ d√πng m·ªôt lu·ªìng ch√≠nh (main thread) ƒë·ªÉ ch·∫°y code JavaScript, kh√°c v·ªõi c√°c ng√¥n ng·ªØ nh∆∞ Java (multi-threaded). Tuy nhi√™n, n√≥ v·∫´n x·ª≠ l√Ω nhi·ªÅu t√°c v·ª• ƒë·ªìng th·ªùi nh·ªù event loop v√† non-blocking I/O.
	
		Event-driven: Node.js ho·∫°t ƒë·ªông theo m√¥ h√¨nh s·ª± ki·ªán (event). Khi c√≥ s·ª± ki·ªán (nh∆∞ request HTTP, ƒë·ªçc file), Node.js g·ªçi callback t∆∞∆°ng ·ª©ng thay v√¨ ch·ªù ho√†n th√†nh.
	
		Non-blocking I/O: C√°c t√°c v·ª• I/O (nh∆∞ ƒë·ªçc file, query database) kh√¥ng ch·∫∑n lu·ªìng ch√≠nh. Node.js giao c√°c t√°c v·ª• n·∫∑ng cho h·ªá ƒëi·ªÅu h√†nh v√† ti·∫øp t·ª•c x·ª≠ l√Ω t√°c v·ª• kh√°c.
	
		V√≠ d·ª• th·ª±c t·∫ø: M·ªôt server Node.js c√≥ th·ªÉ x·ª≠ l√Ω h√†ng ngh√¨n request HTTP c√πng l√∫c (nh∆∞ chat app) m√† kh√¥ng c·∫ßn ch·ªù t·ª´ng request ho√†n t·∫•t.
	
	Ng·ªØ c·∫£nh: Ki·∫øn tr√∫c n√†y l√†m Node.js l√Ω t∆∞·ªüng cho ·ª©ng d·ª•ng c·∫ßn x·ª≠ l√Ω nhi·ªÅu k·∫øt n·ªëi (nh∆∞ server API, streaming), nh∆∞ng kh√¥ng t·ªët cho t√°c v·ª• n·∫∑ng v·ªÅ CPU (nh∆∞ x·ª≠ l√Ω h√¨nh ·∫£nh).





# 2. Node.js Architecture Diagram
T√†i li·ªáu m√¥ t·∫£ lu·ªìng x·ª≠ l√Ω request:

	## 1. Client Request Phase: 
	
		Client g·ª≠i request ƒë·∫øn server Node.js.
		M·ªói request ƒë∆∞·ª£c th√™m v√†o Event Queue.


	## 2. Event Loop Phase:

		Event Loop li√™n t·ª•c ki·ªÉm tra Event Queue.
		L·∫•y t·ª´ng request m·ªôt ƒë·ªÉ x·ª≠ l√Ω.


	## 3. Request Processing:

		T√°c v·ª• ƒë∆°n gi·∫£n (non-blocking) ƒë∆∞·ª£c x·ª≠ l√Ω ngay b·ªüi main thread.
		T√°c v·ª• ph·ª©c t·∫°p (blocking) ƒë∆∞·ª£c giao cho Thread Pool.


	## 4. Response Phase

		Khi t√°c v·ª• blocking ho√†n t·∫•t, callback ƒë∆∞·ª£c ƒë∆∞a v√†o Callback Queue.
		Event Loop x·ª≠ l√Ω callback v√† g·ª≠i response v·ªÅ client.


# Gi·∫£i th√≠ch chi ti·∫øt:

		Event Queue: H√†ng ƒë·ª£i l∆∞u c√°c s·ª± ki·ªán (nh∆∞ request HTTP, file I/O). V√≠ d·ª•, khi 100 client g·ª≠i request c√πng l√∫c, ch√∫ng x·∫øp h√†ng trong Event Queue.
		
		Event Loop: Th√†nh ph·∫ßn c·ªët l√µi c·ªßa Node.js (d√πng th∆∞ vi·ªán Libuv), li√™n t·ª•c ki·ªÉm tra Event Queue v√† Callback Queue. N√≥ x·ª≠ l√Ω c√°c t√°c v·ª• non-blocking tr·ª±c ti·∫øp v√† giao t√°c v·ª• blocking cho Thread Pool.
		
		Thread Pool: M·ªôt t·∫≠p h·ª£p lu·ªìng ph·ª• (th∆∞·ªùng 4 lu·ªìng m·∫∑c ƒë·ªãnh) x·ª≠ l√Ω t√°c v·ª• n·∫∑ng (nh∆∞ ƒë·ªçc file l·ªõn, m√£ h√≥a). Thread Pool ƒë∆∞·ª£c Libuv qu·∫£n l√Ω, kh√¥ng ph·∫£i V8.
		Callback Queue: L∆∞u c√°c callback t·ª´ t√°c v·ª• blocking sau khi ho√†n t·∫•t. Event Loop l·∫•y callback t·ª´ ƒë√¢y ƒë·ªÉ th·ª±c thi.
		
		V√≠ d·ª• th·ª±c t·∫ø: Khi client g·ª≠i request ƒë·∫øn server Node.js, Event Loop x·ª≠ l√Ω request ngay n·∫øu l√† t√≠nh to√°n ƒë∆°n gi·∫£n (nh∆∞ tr·∫£ v·ªÅ "Hello World"). N·∫øu c·∫ßn ƒë·ªçc file, n√≥ giao cho Thread Pool v√† ti·∫øp t·ª•c x·ª≠ l√Ω request kh√°c.



# H√¨nh dung lu·ªìng:


	1.Client g·ª≠i 3 request: R1, R2, R3 ‚Üí Event Queue: [R1, R2, R3].
	2.Event Loop l·∫•y R1:
	
		N·∫øu R1 l√† t√≠nh to√°n ƒë∆°n gi·∫£n ‚Üí X·ª≠ l√Ω ngay, g·ª≠i response.
		N·∫øu R1 c·∫ßn ƒë·ªçc file ‚Üí Giao Thread Pool, ti·∫øp t·ª•c l·∫•y R2.
	
	
	3.Thread Pool ho√†n t·∫•t R1, ƒë·∫©y callback v√†o Callback Queue.
	4.Event Loop l·∫•y callback, g·ª≠i response cho R1.



# 3. Non-blocking Examples

	## 3.1. Non-blocking File Read


const fs = require('fs');

console.log('Before file read');

fs.readFile('myfile.txt', 'utf8', (err, data) => {
  if (err) throw err;
  console.log('File contents:', data);
});

console.log('After file read');



		### Gi·∫£i th√≠ch chi ti·∫øt:
		
			fs.readFile: H√†m b·∫•t ƒë·ªìng b·ªô (non-blocking) trong module fs. N√≥ ƒë·ªçc file myfile.txt v√† g·ªçi callback khi ho√†n t·∫•t.
		
			Lu·ªìng th·ª±c thi:
		
				- In Before file read.
				- fs.readFile giao t√°c v·ª• ƒë·ªçc file cho Thread Pool (Libuv), main thread kh√¥ng ƒë·ª£i.
				- In After file read ngay l·∫≠p t·ª©c.
				- Khi file ƒë·ªçc xong, callback ch·∫°y, in File contents: Hello!.		
		
			T·∫°i sao non-blocking? Main thread ti·∫øp t·ª•c ch·∫°y m√† kh√¥ng ch·ªù ƒë·ªçc file, nh·ªù event loop giao vi·ªác cho Thread Pool.
			
			Ng·ªØ c·∫£nh: H·ªØu √≠ch trong server khi c·∫ßn ƒë·ªçc file (nh∆∞ config) m√† kh√¥ng l√†m ch·∫≠m c√°c request kh√°c.
		
		
		
		
		
	## 	3.2. Blocking vs Non-blocking Code
		
// Blocking code example
console.log('Start of blocking code');
const data = fs.readFileSync('myfile.txt', 'utf8'); // Blocks here
console.log('Blocking operation completed');

// Non-blocking code example
console.log('Start of non-blocking code');
fs.readFile('myfile.txt', 'utf8', (err, data) => {
  if (err) throw err;
  console.log('Non-blocking operation completed');
});
console.log('This runs before the file is read');		
		
		
		
Start of blocking code
Blocking operation completed
Start of non-blocking code
This runs before the file is read
Non-blocking operation completed	
		
		
		
		
		### 	Gi·∫£i th√≠ch chi ti·∫øt:
		
			### Blocking (fs.readFileSync):
		
				- H√†m ƒë·ªìng b·ªô (synchronous), ch·∫∑n main thread cho ƒë·∫øn khi ƒë·ªçc file xong.
				- Lu·ªìng: In Start, ch·ªù ƒë·ªçc file, in Blocking operation completed.
				- Nh∆∞·ª£c ƒëi·ªÉm: N·∫øu file l·ªõn ho·∫∑c nhi·ªÅu request, server s·∫Ω ch·∫≠m v√¨ main thread b·ªã ch·∫∑n.
				
				
				
				
			### Non-blocking (fs.readFile):
				
				- H√†m b·∫•t ƒë·ªìng b·ªô, giao vi·ªác cho Thread Pool, main thread ti·∫øp t·ª•c ch·∫°y.
				- Lu·ªìng: In Start, in This runs before, callback ch·∫°y sau khi file ƒë·ªçc xong.
				- ∆Øu ƒëi·ªÉm: Server v·∫´n x·ª≠ l√Ω request kh√°c trong l√∫c ch·ªù ƒë·ªçc file.				
				
				
		Ng·ªØ c·∫£nh: Lu√¥n ∆∞u ti√™n non-blocking (fs.readFile, setTimeout, v.v.) trong Node.js ƒë·ªÉ t·∫≠n d·ª•ng event loop.		
				
				
				

# 4. When to Use Node.js			
				
	Node.js ph√π h·ª£p cho:			
				
		- I/O-bound applications: File operations, database queries, network requests.
		- Real-time applications: Chat apps, live notifications, collaboration tools.
		- APIs: RESTful services, GraphQL APIs.
		- Microservices: C√°c d·ªãch v·ª• nh·ªè, ƒë·ªôc l·∫≠p.				
				
	Kh√¥ng ph√π h·ª£p cho:			
				
		CPU-intensive tasks (nh∆∞ x·ª≠ l√Ω h√¨nh ·∫£nh, t√≠nh to√°n ph·ª©c t·∫°p) v√¨ ch·∫∑n event loop.		
		Gi·∫£i ph√°p:		
				
			D√πng Worker Threads ƒë·ªÉ ch·∫°y t√°c v·ª• CPU-heavy trong lu·ªìng ri√™ng.
			T√°ch th√†nh microservice b·∫±ng ng√¥n ng·ªØ kh√°c (nh∆∞ Python, Go).
			D√πng native add-ons (C++ modules).	
				
	## 	Gi·∫£i th√≠ch chi ti·∫øt:		
				
			- I/O-bound: Node.js gi·ªèi x·ª≠ l√Ω t√°c v·ª• ch·ªù I/O (nh∆∞ ƒë·ªçc file, query MongoDB) nh·ªù non-blocking. V√≠ d·ª•: Server API tr·∫£ JSON t·ª´ database.
			- Real-time: Event loop gi√∫p x·ª≠ l√Ω WebSocket (nh∆∞ chat) hi·ªáu qu·∫£. V√≠ d·ª•: Socket.IO cho ·ª©ng d·ª•ng chat.
			- APIs/Microservices: Node.js v·ªõi Express.js t·∫°o REST/GraphQL API nhanh ch√≥ng, d·ªÖ m·ªü r·ªông.
			- CPU-intensive: T√°c v·ª• nh∆∞ m√£ h√≥a video ho·∫∑c machine learning l√†m ch·∫≠m event loop v√¨ V8 ch·∫°y single-threaded. Worker Threads (t·ª´ Node.js 12.x) gi√∫p c·∫£i thi·ªán, nh∆∞ng v·∫´n kh√¥ng t·ªëi ∆∞u b·∫±ng ng√¥n ng·ªØ multi-threaded.				
				
				
				
</pre><a id='backBottom' href='../NodeJS-learning.html' style='display:none;'>üîô Quay l·∫°i danh s√°ch</a><br><button onclick='toggleTheme()'>üåô Chuy·ªÉn giao di·ªán</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>