<html><head><title>Lesson 28 == Buffer ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../NodeJS-learning.html'>üîô Quay l·∫°i danh s√°ch</a><br><h1>Lesson 28 -- Buffer -//</h1><pre>
# 1. Buffer l√† g√¨? T·∫°i sao c·∫ßn n√≥?

	-Trong browser JavaScript: ch·ªâ l√†m vi·ªác v·ªõi chu·ªói (string), kh√¥ng c√≥ c√°ch x·ª≠ l√Ω d·ªØ li·ªáu nh·ªã ph√¢n (binary) tr·ª±c ti·∫øp.
	-Trong Node.js: b·∫°n ph·∫£i ƒë·ªçc file, nh·∫≠n d·ªØ li·ªáu t·ª´ m·∫°ng, x·ª≠ l√Ω ·∫£nh, video, m√£ h√≥a‚Ä¶ ‚Üí c·∫ßn l√†m vi·ªác v·ªõi d·ªØ li·ªáu th√¥ (raw binary).
	-Buffer ch√≠nh l√† m·∫£ng c√°c byte (0-255) ƒë∆∞·ª£c c·∫•p ph√°t ngo√†i V8 heap ‚Üí nhanh, kh√¥ng b·ªã garbage collector qu·∫•y r·∫ßy.

	Buffer = Array c·ªßa s·ªë nguy√™n 0-255, ƒë·∫°i di·ªán cho 1 ƒëo·∫°n b·ªô nh·ªõ th√¥.

	Buffer l√† global, kh√¥ng c·∫ßn require():

const buf = Buffer.from('Hello');
console.log(buf); // <Buffer 48 65 6c 6c 6f>



# 2. 3 c√°ch t·∫°o Buffer (QUAN TR·ªåNG NH·∫§T)

	1. Buffer.alloc(size),
	R·∫•t an to√†n,
	Lu√¥n d√πng khi t·∫°o buffer m·ªõi
	
	
	2. Buffer.allocUnsafe(size),
	Kh√¥ng an to√†nR·∫•t nhanh,
	Ch·ªâ d√πng khi c·∫ßn t·ªëc ƒë·ªô c·ª±c cao v√† b·∫°n s·∫Ω ghi ƒë√® ngay
	
	
	3. Buffer.from(data),
	An to√†n,Nhanh,
	"T·∫°o t·ª´ string, array, buffer kh√°c"
	

	## V√≠ d·ª• th·ª±c t·∫ø:

// 1. An to√†n nh·∫•t - lu√¥n d√πng c√°i n√†y khi b·∫Øt ƒë·∫ßu
const buf1 = Buffer.alloc(10);        // 10 byte = 0
// 2. Nhanh nh∆∞ng nguy hi·ªÉm (c√≥ th·ªÉ ch·ª©a d·ªØ li·ªáu c≈©)
const buf2 = Buffer.allocUnsafe(10);  // c√≥ th·ªÉ ch·ª©a password c≈© c·ªßa ai ƒë√≥!
// 3. T·ª´ d·ªØ li·ªáu c√≥ s·∫µn
const buf3 = Buffer.from('Xin ch√†o'); // UTF-8
const buf4 = Buffer.from([65,66,67]); // ABC

	L·ªùi khuy√™n chuy√™n gia: 99% tr∆∞·ªùng h·ª£p d√πng Buffer.alloc() ho·∫∑c Buffer.from(). Ch·ªâ d√πng allocUnsafe trong server si√™u cao t·∫£i v√† b·∫°n ch·∫Øc ch·∫Øn s·∫Ω ghi ƒë√® to√†n b·ªô.



# 3. ƒê·ªçc & Ghi Buffer


const buf = Buffer.alloc(20);

buf.write('Hello');        // ghi t·ª´ v·ªã tr√≠ 0
buf.write('World', 6);     // ghi t·ª´ v·ªã tr√≠ 6
console.log(buf.toString()); // "Hello World"

// Ghi t·ª´ng byte
buf[0] = 72; // 'H' trong ASCII


	## ƒê·ªçc t·ª´ng ph·∫ßn

const buf = Buffer.from('Node.js r·∫•t hay!');

console.log(buf.toString());           // to√†n b·ªô
console.log(buf.toString('utf8', 0, 4)); // "Node"
console.log(buf[0]);                   // 78 (byte ƒë·∫ßu)





# 4. C√°c ph∆∞∆°ng th·ª©c hay d√πng


| Ph∆∞∆°ng th·ª©c                                             | M√¥ t·∫£                       | V√≠ d·ª•                  |
| ------------------------------------------------------- | --------------------------- | ---------------------- |
| `buf.toString([encoding], [start], [end])`              | Chuy·ªÉn buffer ‚Üí string      | `buf.toString('hex')`  |
| `Buffer.concat(list, [totalLength])`                    | N·ªëi nhi·ªÅu buffer            | `Buffer.concat([a,b])` |
| `buf.slice(start, end)`                                 | C·∫Øt buffer (c√πng v√πng nh·ªõ!) | `buf.slice(0,5)`       |
| `buf.copy(target, targetStart, sourceStart, sourceEnd)` | Copy d·ªØ li·ªáu                | ‚Äî                      |
| `buf.equals(other)`                                     | So s√°nh n·ªôi dung            | ‚Äî                      |
| `buf.indexOf(value)`                                    | T√¨m v·ªã tr√≠ byte ho·∫∑c chu·ªói  | `buf.indexOf('Node')`  |


	C·∫£nh b√°o slice: slice kh√¥ng copy m√† tr·ªè c√πng v√πng nh·ªõ ‚Üí s·ª≠a slice s·∫Ω s·ª≠a lu√¥n buffer g·ªëc!


const orig = Buffer.from('Hello');
const slice = orig.slice(0,3); // "Hel"
slice[0] = 88; // 'X'
console.log(orig.toString()); // "Xello" ‚Üê b·ªã thay ƒë·ªïi!




# 5. Encoding (M√£ h√≥a) - Si√™u quan tr·ªçng


const str = 'Xin ch√†o';

// String ‚Üí Buffer
const utf8 = Buffer.from(str, 'utf8');
const base64 = utf8.toString('base64');
console.log(base64); // "WGluIGNow6Bv"

// Buffer ‚Üí String
const back = Buffer.from(base64, 'base64').toString('utf8');
console.log(back); // "Xin ch√†o"


	## C√°c encoding hay g·∫∑p: 
	
		utf8 (m·∫∑c ƒë·ªãnh)
		hex (m·ªói byte ‚Üí 2 k√Ω t·ª± hex)
		base64 (d√πng trong email, JWT)
		ascii, latin1



# 6. Buffer v·ªõi File System & Stream

const fs = require('fs');

// Ghi file
fs.writeFileSync('test.txt', Buffer.from('Hello Buffer'));

// ƒê·ªçc file ‚Üí t·ª± ƒë·ªông tr·∫£ v·ªÅ Buffer
const data = fs.readFileSync('test.txt');
console.log(data.toString());


	##Stream c≈©ng d√πng Buffer:

readStream.on('data', chunk => {
  console.log(chunk); // ‚Üê l√† Buffer
});




#7. B·∫£o m·∫≠t - ƒêI·ªÄU QUAN TR·ªåNG NH·∫§T khi ƒëi l√†m

	1.Kh√¥ng d√πng allocUnsafe n·∫øu kh√¥ng c·∫ßn thi·∫øt
	2. X√≥a d·ªØ li·ªáu nh·∫°y c·∫£m ngay sau khi d√πng


function hashPassword(pw) {
  const buf = Buffer.from(pw);
  const hash = require('crypto').createHash('sha256').update(buf).digest('hex');
  
  buf.fill(0); // X√ìA M·∫¨T KH·∫®U KH·ªéI B·ªò NH·ªö
  return hash;
}


# 8. T·ªëi ∆∞u hi·ªáu nƒÉng (d√†nh cho senior)

// Buffer pool cho server nh·∫≠n h√†ng ngh√¨n request/gi√¢y
class FastBufferPool {
  constructor(size, count) {
    this.size = size;
    this.pool = [];
    for (let i = 0; i < count; i++) {
      this.pool.push(Buffer.allocUnsafe(size));
    }
  }
  get() { return this.pool.pop() || Buffer.allocUnsafe(this.size); }
  release(buf) { buf.fill(0); this.pool.push(buf); }
}


# 9. T√≥m t·∫Øt nhanh


B·∫°n c·∫ßn l√†m g√¨?,D√πng l·ªánh n√†o?
T·∫°o buffer r·ªóng an to√†n,Buffer.alloc(n)
T·∫°o t·ª´ string/array,Buffer.from(...)
Chuy·ªÉn buffer ‚Üí string,buf.toString()
Chuy·ªÉn string ‚Üí buffer,Buffer.from(str)
N·ªëi nhi·ªÅu buffer,"Buffer.concat([a,b])"
C·∫Øt buffer (c√πng nh·ªõ),buf.slice()
Copy an to√†n,source.copy(target)
X√≥a d·ªØ li·ªáu nh·∫°y c·∫£m,buf.fill(0)












</pre><a id='backBottom' href='../NodeJS-learning.html' style='display:none;'>üîô Quay l·∫°i danh s√°ch</a><br><button onclick='toggleTheme()'>üåô Chuy·ªÉn giao di·ªán</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>