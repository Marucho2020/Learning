<html><head><title>Lesson 13 == Modules ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../NodeJS-learning.html'>üîô Quay l·∫°i danh s√°ch</a><br><h1>Lesson 13 -- Modules -//</h1><pre>
# Modules trong Node.js l√† g√¨?

	Modules l√† c√°c ƒë∆°n v·ªã code ƒë·ªôc l·∫≠p, cho ph√©p b·∫°n chia nh·ªè ·ª©ng d·ª•ng th√†nh c√°c th√†nh ph·∫ßn c√≥ th·ªÉ t√°i s·ª≠ d·ª•ng. Trong Node.js, m·ªói file .js l√† m·ªôt module. L·ª£i √≠ch ch√≠nh c·ªßa modules bao g·ªìm:

		T·ªï ch·ª©c code: Chia code th√†nh c√°c file nh·ªè, d·ªÖ qu·∫£n l√Ω.
		ƒê√≥ng g√≥i (encapsulation): ·∫®n chi ti·∫øt tri·ªÉn khai, ch·ªâ expose nh·ªØng g√¨ c·∫ßn thi·∫øt.
		Tr√°nh xung ƒë·ªôt namespace: Kh√¥ng ƒë·ªÉ bi·∫øn/h√†m global g√¢y xung ƒë·ªôt.
		TƒÉng t√≠nh t√°i s·ª≠ d·ª•ng: C√≥ th·ªÉ import module v√†o nhi·ªÅu d·ª± √°n.

	Node.js h·ªó tr·ª£ hai h·ªá th·ªëng module:

		- CommonJS: H·ªá th·ªëng m·∫∑c ƒë·ªãnh, d√πng require() v√† module.exports. B√†i n√†y t·∫≠p trung v√†o CommonJS.
		- ES Modules (ESM): Chu·∫©n m·ªõi (t·ª´ ES6), d√πng import/export. ƒê∆∞·ª£c ƒë·ªÅ c·∫≠p trong b√†i kh√°c.

	Insight: CommonJS v·∫´n ph·ªï bi·∫øn trong h·ªá sinh th√°i Node.js, ƒë·∫∑c bi·ªát v·ªõi c√°c th∆∞ vi·ªán c≈© v√† core modules. Tuy nhi√™n, ESM ƒëang ƒë∆∞·ª£c ∆∞a chu·ªông trong c√°c d·ª± √°n m·ªõi nh·ªù c√∫ ph√°p hi·ªán ƒë·∫°i v√† h·ªó tr·ª£ tree-shaking.


# Built-in Modules (Core Modules)

	Node.js cung c·∫•p nhi·ªÅu module t√≠ch h·ª£p s·∫µn (compiled v√†o binary), kh√¥ng c·∫ßn c√†i ƒë·∫∑t. M·ªôt s·ªë module ph·ªï bi·∫øn:

		fs: Thao t√°c file (ƒë·ªçc, ghi, x√≥a, v.v.).
		http: T·∫°o server/client HTTP.
		path: X·ª≠ l√Ω ƒë∆∞·ªùng d·∫´n file.
		os: Th√¥ng tin h·ªá ƒëi·ªÅu h√†nh (CPU, memory, v.v.).
		events, util, crypto, url, querystring, v.v.
	ƒê·ªÉ s·ª≠ d·ª•ng, ch·ªâ c·∫ßn g·ªçi require('<module-name>').

	V√≠ d·ª•: T·∫°o HTTP Server ƒë∆°n gi·∫£n

const http = require('http');

http.createServer((req, res) => {
  res.writeHead(200, { 'Content-Type': 'text/html' });
  res.end('Hello World!');
}).listen(8080);


require('http'): Import module http t√≠ch h·ª£p s·∫µn.
http.createServer: T·∫°o server, x·ª≠ l√Ω request/response.
res.writeHead: Set HTTP status code (200) v√† headers.
Output: Truy c·∫≠p http://localhost:8080, b·∫°n s·∫Ω th·∫•y "Hello World!" tr√™n tr√¨nh duy·ªát.


	Insight: Trong th·ª±c t·∫ø, b·∫°n hi·∫øm khi d√πng http tr·ª±c ti·∫øp m√† s·∫Ω d√πng framework nh∆∞ Express.js ƒë·ªÉ x·ª≠ l√Ω routing, middleware, v√† c√°c t√≠nh nƒÉng ph·ª©c t·∫°p h∆°n. Core modules nh∆∞ fs v√† path r·∫•t ph·ªï bi·∫øn khi l√†m vi·ªác v·ªõi file ho·∫∑c ƒë∆∞·ªùng d·∫´n.



# T·∫°o v√† Export Modules

	Trong Node.js, m·ªói file .js l√† m·ªôt module. B·∫°n c√≥ th·ªÉ export h√†m, object, class, ho·∫∑c b·∫•t k·ª≥ gi√° tr·ªã n√†o t·ª´ module ƒë·ªÉ s·ª≠ d·ª•ng ·ªü file kh√°c. C√≥ hai c√°ch export ch√≠nh trong CommonJS:


	## 1. Export nhi·ªÅu m·ª•c (Multiple Exports)
	
		S·ª≠ d·ª•ng exports (ho·∫∑c module.exports) ƒë·ªÉ export nhi·ªÅu h√†m/object.

	V√≠ d·ª•: utils.js



const getCurrentDate = () => new Date().toISOString();

const formatCurrency = (amount, currency = 'USD') => {
  return new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: currency,
  }).format(amount);
};

// C√°ch 1: G√°n t·ª´ng thu·ªôc t√≠nh v√†o exports
exports.getCurrentDate = getCurrentDate;
exports.formatCurrency = formatCurrency;

// C√°ch 2: Export object (c√°ch ng·∫Øn g·ªçn h∆°n)
// module.exports = { getCurrentDate, formatCurrency };


	## Gi·∫£i th√≠ch:

		- getCurrentDate: Tr·∫£ v·ªÅ ng√†y gi·ªù hi·ªán t·∫°i d∆∞·ªõi d·∫°ng ISO string.
		- formatCurrency: Format s·ªë th√†nh ti·ªÅn t·ªá (e.g., 99.99 -> $99.99).
		- exports.<t√™n>: G√°n h√†m v√†o object exports ƒë·ªÉ export.
		- C√°ch 2 d√πng module.exports ƒë·ªÉ export m·ªôt object ch·ª©a nhi·ªÅu thu·ªôc t√≠nh, ng·∫Øn g·ªçn h∆°n khi export nhi·ªÅu th·ª©.





# 2. Export m·ªôt m·ª•c (Single Export)
	D√πng module.exports ƒë·ªÉ export m·ªôt gi√° tr·ªã duy nh·∫•t (h√†m, class, object, v.v.).
	V√≠ d·ª•: logger.js

class Logger {
  constructor(name) {
    this.name = name;
  }

  log(message) {
    console.log(`[${this.name}] ${message}`);
  }

  error(error) {
    console.error(`[${this.name}] ERROR:`, error.message);
  }
}

module.exports = Logger;


	Logger: Class ƒë·ªÉ log message v·ªõi t√™n prefix.
	module.exports = Logger: Export to√†n b·ªô class ƒë·ªÉ file kh√°c c√≥ th·ªÉ t·∫°o instance.



# 3. S·ª≠ d·ª•ng Custom Modules

	Import module b·∫±ng require() v·ªõi ƒë∆∞·ªùng d·∫´n t∆∞∆°ng ƒë·ªëi (./) ho·∫∑c tuy·ªát ƒë·ªëi.
	V√≠ d·ª•: app.js

const http = require('http');
const path = require('path');
const { getCurrentDate, formatCurrency } = require('./utils');
const Logger = require('./logger');

const logger = new Logger('App');

const server = http.createServer((req, res) => {
  try {
    logger.log(`Request received for ${req.url}`);
    res.writeHead(200, { 'Content-Type': 'text/html' });
    res.write(`<h1>Welcome to our app!</h1>`);
    res.write(`<p>Current date: ${getCurrentDate()}</p>`);
    res.write(`<p>Formatted amount: ${formatCurrency(99.99)}</p>`);
    res.end();
  } catch (error) {
    logger.error(error);
    res.writeHead(500, { 'Content-Type': 'text/plain' });
    res.end('Internal Server Error');
  }
});

const PORT = process.env.PORT || 3000;
server.listen(PORT, () => {
  logger.log(`Server running at http://localhost:${PORT}`);
});


	- require('./utils'): Import getCurrentDate v√† formatCurrency t·ª´ utils.js b·∫±ng destructuring.
	- require('./logger'): Import class Logger v√† t·∫°o instance.
	- Server tr·∫£ v·ªÅ HTML v·ªõi ng√†y gi·ªù v√† s·ªë ti·ªÅn format, x·ª≠ l√Ω l·ªói b·∫±ng try/catch.

	Output (khi truy c·∫≠p http://localhost:3000)

[App] Server running at http://localhost:3000
[App] Request received for /

	Insight: Trong d·ª± √°n th·ª±c t·∫ø, t·ªï ch·ª©c module t·ªët l√† ch√¨a kh√≥a. V√≠ d·ª•, b·∫°n c√≥ th·ªÉ t·∫°o th∆∞ m·ª•c utils/ ch·ª©a nhi·ªÅu file nh∆∞ date.js, currency.js, v√† d√πng index.js ƒë·ªÉ re-export t·∫•t c·∫£. ƒêi·ªÅu n√†y gi√∫p code modular v√† d·ªÖ scale.



# Module Loading v√† Caching
	Node.js c√≥ c∆° ch·∫ø caching ƒë·ªÉ t·ªëi ∆∞u hi·ªáu su·∫•t:

		Khi require() m·ªôt module l·∫ßn ƒë·∫ßu, Node.js t·∫£i v√† th·ª±c thi n√≥, r·ªìi l∆∞u v√†o cache.
		C√°c l·∫ßn require() sau tr·∫£ v·ªÅ instance t·ª´ cache, kh√¥ng reload file.

	V√≠ d·ª• minh h·ªça caching:

// counter.js
let count = 0;
module.exports = {
  increment: () => count++,
  getCount: () => count,
};

// app.js
const counter1 = require('./counter');
const counter2 = require('./counter');

counter1.increment();
console.log(counter1.getCount()); // 1
console.log(counter2.getCount()); // 1 (same instance)


	Gi·∫£i th√≠ch: C·∫£ counter1 v√† counter2 tr·ªè ƒë·∫øn c√πng instance c·ªßa module counter trong cache, n√™n count ƒë∆∞·ª£c chia s·∫ª.

	## Module Resolution
		Khi g·ªçi require('<module>'), Node.js t√¨m module theo th·ª© t·ª±:

			- Core modules: fs, http, v.v.
			- node_modules: T√¨m trong th∆∞ m·ª•c node_modules (c·ª•c b·ªô ho·∫∑c global).
			- Local files: T√¨m file v·ªõi ƒë∆∞·ªùng d·∫´n t∆∞∆°ng ƒë·ªëi (./) ho·∫∑c tuy·ªát ƒë·ªëi.

		Insight: Caching gi√∫p ti·∫øt ki·ªám t√†i nguy√™n, nh∆∞ng c√≥ th·ªÉ g√¢y v·∫•n ƒë·ªÅ n·∫øu module l∆∞u tr·∫°ng th√°i (nh∆∞ count ·ªü tr√™n). Trong tr∆∞·ªùng h·ª£p c·∫ßn instance m·ªõi m·ªói l·∫ßn require, b·∫°n c√≥ th·ªÉ export factory function ho·∫∑c x√≥a cache (hi·∫øm d√πng, b·∫±ng delete require.cache).



# Best Practices (Th·ª±c h√†nh t·ªët nh·∫•t)


	## Module Organization 

		- Single responsibility: M·ªói module ch·ªâ n√™n l√†m m·ªôt vi·ªác (e.g., utils.js ch·ªâ x·ª≠ l√Ω ti·ªán √≠ch).
		- T√™n file/th∆∞ m·ª•c r√µ r√†ng: D√πng t√™n nh∆∞ logger.js, utils/date.js ƒë·ªÉ d·ªÖ hi·ªÉu.
		- Nh√≥m ch·ª©c nƒÉng li√™n quan: T·∫°o th∆∞ m·ª•c nh∆∞ controllers/, services/ trong d·ª± √°n l·ªõn.
		- D√πng index.js: L√† entry point c·ªßa th∆∞ m·ª•c, re-export c√°c module con:

// utils/index.js
module.exports = {
  date: require('./date'),
  currency: require('./currency'),
};


	## Export Patterns

		- Named exports (exports.<t√™n>): D√πng cho utilities ho·∫∑c nhi·ªÅu h√†m.
		- Default exports (module.exports = ...): D√πng cho class ho·∫∑c object ch√≠nh.
		- Document API: D√πng JSDoc ƒë·ªÉ m√¥ t·∫£ module:

/**
 * Formats a number as currency
 * @param {number} amount - Amount to format
 * @param {string} [currency=USD] - Currency code
 * @returns {string} Formatted currency string
 */
const formatCurrency = (amount, currency = 'USD') => { ... };

	Kh·ªüi t·∫°o module n·∫øu c·∫ßn: V√≠ d·ª•, truy·ªÅn config khi import:



// db.js
module.exports = (dbConfig) => {
  return {
    connect: () => console.log(`Connected to ${dbConfig.host}`),
  };
};

// app.js
const db = require('./db')({ host: 'localhost' });


	Insight: Trong d·ª± √°n l·ªõn, t·ªï ch·ª©c module theo feature (e.g., user/controller.js, user/service.js) thay v√¨ type (e.g., controllers/user.js). ƒêi·ªÅu n√†y gi√∫p d·ªÖ scale v√† maintain. D√πng ESM trong d·ª± √°n m·ªõi ƒë·ªÉ t·∫≠n d·ª•ng import/export v√† top-level await


# T·ªïng k·∫øt v√† L·ªùi khuy√™n
	Modules l√† n·ªÅn t·∫£ng c·ªßa ·ª©ng d·ª•ng Node.js, gi√∫p code c√≥ t·ªï ch·ª©c v√† t√°i s·ª≠ d·ª•ng. Key takeaways:


		CommonJS: D√πng require v√† module.exports, ph√π h·ª£p v·ªõi core modules v√† d·ª± √°n c≈©.
		Built-in modules: fs, http, path, v.v., l√† c√¥ng c·ª• m·∫°nh m·∫Ω ƒë·ªÉ x√¢y d·ª±ng ·ª©ng d·ª•ng.
		Custom modules: T·∫°o file .js v√† export b·∫±ng exports ho·∫∑c module.exports.
		Caching: Module ch·ªâ load m·ªôt l·∫ßn, l∆∞u √Ω khi l√†m vi·ªác v·ªõi tr·∫°ng th√°i.
		Best practices: T·ªï ch·ª©c module r√µ r√†ng, d√πng named/default exports h·ª£p l√Ω, document API.


	## V√≠ d·ª• th·ª±c t·∫ø v·ªõi Express: 
	

// routes/users.js
const express = require('express');
const router = express.Router();
const { getCurrentDate } = require('../utils');

router.get('/:id', (req, res) => {
  res.json({
    id: req.params.id,
    lastAccess: getCurrentDate(),
  });
});

module.exports = router;

// app.js
const express = require('express');
const app = express();
const userRoutes = require('./routes/users');

app.use('/users', userRoutes);
app.listen(3000, () => console.log('Server running'));



</pre><a id='backBottom' href='../NodeJS-learning.html' style='display:none;'>üîô Quay l·∫°i danh s√°ch</a><br><button onclick='toggleTheme()'>üåô Chuy·ªÉn giao di·ªán</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>