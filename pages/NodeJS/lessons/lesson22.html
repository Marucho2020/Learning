<html><head><title>Lesson 22 == File System Module ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../NodeJS-learning.html'>üîô Quay l·∫°i danh s√°ch</a><br><h1>Lesson 22 -- File System Module -//</h1><pre>
# 1. Introduction to Node.js File System

	ƒê·ªãnh nghƒ©a: fs module cung c·∫•p APIs ƒë·ªÉ l√†m vi·ªác v·ªõi files/directories: sync/async, callback/promise. Core module, no npm install.

const fs = require('fs');  // CommonJS
// ho·∫∑c import fs from 'fs';  // ESM (package.json: "type": "module")


	## Promise-based (recommended cho async/await):
	const fs = require('fs').promises;  // Ho·∫∑c import { readFile } from 'fs/promises';



	## Common Use Cases (m·ªü r·ªông):

		- File Ops: ƒê·ªçc/ghi JSON config, logs, images.
		- Dir Ops: Qu·∫£n l√Ω uploads, cache, backups.
		- Advanced: Streams cho big data (e.g., video streaming), watchers cho hot-reload (nh∆∞ Nodemon d√πng fs.watch).

	Performance Tip: V·ªõi large files (>100MB), d√πng streams ƒë·ªÉ tr√°nh load to√†n b·ªô v√†o RAM (OOM errors). NƒÉm 2025, fs h·ªó tr·ª£ Web Streams API cho browser-like code.



# 2. Reading Files

	Ph∆∞∆°ng th·ª©c ch√≠nh: fs.readFile(path, options, callback) ‚Äì async, tr·∫£ Buffer/string.

	## Callback-based:
const fs = require('fs');
fs.readFile('myfile.txt', 'utf8', (err, data) => {
  if (err) return console.error(err);
  console.log(data);  // String n·∫øu utf8, Buffer n·∫øu kh√¥ng
});



	## Promise-based (Modern):
const fs = require('fs').promises;
async function read() {
  try {
    const data = await fs.readFile('myfile.txt', 'utf8');
    console.log(data);
  } catch (err) {
    console.error(err);
  }
}
read();



	## Sync (ch·ªâ cho scripts ƒë∆°n gi·∫£n): 
try {
  const data = fs.readFileSync('myfile.txt', 'utf8');
} catch (err) {}

	Chuy√™n gia s√¢u: Lu√¥n specify encoding ('utf8') ƒë·ªÉ tr√°nh Buffer. Handle errors (ENOENT: file not exist). V·ªõi binary (images), omit encoding. Security: Sanitize paths ƒë·ªÉ tr√°nh path traversal (e.g., d√πng path.resolve()).


# 3. Creating and Writing Files
	## writeFile: T·∫°o/overwrite file.

const fs = require('fs').promises;
async function write() {
  await fs.writeFile('myfile.txt', 'Hello World', 'utf8');
}


	## appendFile: Append m√† kh√¥ng overwrite.
await fs.appendFile('log.txt', `\n${new Date()}: Event`, 'utf8');




	## File Handles (low-level, cho control cao):
const handle = await fs.open('file.txt', 'w');
await handle.write('Content');
await handle.close();  // Lu√¥n close!

	## Streams cho Large Files:

const writable = fs.createWriteStream('bigfile.txt');
writable.write('Chunk 1');
writable.end('End');  // Auto close


	S√¢u s·∫Øc: Flags nh∆∞ 'w' (write, create if not exist), 'a' (append). V·ªõi JSON, d√πng JSON.stringify(data, null, 2) cho pretty-print. Performance: Streams pipe() cho copy large files (e.g., readStream.pipe(writeStream)). Security: Set permissions (mode: 0o600) ƒë·ªÉ tr√°nh unauthorized access.



# 4. Deleting Files and Directories

	## unlink (x√≥a file):
		await fs.unlink('file.txt');  // Throw n·∫øu kh√¥ng exist, d√πng access() ƒë·ªÉ check


	## Multiple Files:
		await Promise.all(files.map(f => fs.unlink(f).catch(e => {})));



	## Directories: fs.rm(dir, { recursive: true, force: true }) (Node 14+).
		await fs.rm('dir', { recursive: true });


	## Empty Dir (kh√¥ng x√≥a dir):

		Loop readdir() v√† unlink/rm recursive.
		Chuy√™n gia: force: true ignore non-exist errors. Security: Validate paths ƒë·ªÉ tr√°nh x√≥a root (e.g., d√πng path.normalize()). NƒÉm 2025, fs.rm t·ªët h∆°n rmdir (deprecated).



	## 5. Renaming and Moving Files
	
		rename (rename/move):
await fs.rename('old.txt', 'new.txt');  // Same dir
await fs.rename('file.txt', 'newdir/file.txt');  // Move
	
	
	
	
		 Cross-Device (n·∫øu EXDEV error):
			Copy r·ªìi unlink (nh∆∞ v√≠ d·ª• fallback).
	
	
		Batch Rename:
			Loop readdir(), match pattern, rename.
	
		
		Atomic Operations (an to√†n cho critical files):
			Write temp, rename temp to target (atomic tr√™n Unix).
	
			S√¢u: rename atomic tr√™n same filesystem. V·ªõi Windows, fallback copy. Security: Check existence tr∆∞·ªõc rename ƒë·ªÉ tr√°nh overwrite accidental.	
	
	
	## 6. Best Practices & Advanced Tips (M·ªü R·ªông)
		Async Priority: Tr√°nh sync tr·ª´ CLI tools ‚Äì async gi·ªØ app responsive.
		Error Handling: Catch codes nh∆∞ ENOENT, EACCES (permissions). D√πng fs.access() ƒë·ªÉ check exist/permissions.	
		Permissions: D√πng fs.chmod(path, 0o755) ‚Äì octal mode (owner/group/other).
		Watching: fs.watch('file.txt', (event, filename) => {}) cho real-time changes (e.g., live reload).
		Stats: fs.stat(path) tr·∫£ size, mtime, isDirectory(), etc.
		Symbolic Links: fs.symlink(target, path) cho shortcuts.
		Performance: V·ªõi dirs l·ªõn, d√πng readdir withFileTypes. Streams cho I/O heavy.	
	
		Security
	
			- Path sanitization: path.resolve(__dirname, userInput) tr√°nh ../ attacks.
			- Umask: Set default permissions.
			- NƒÉm 2025: K·∫øt h·ª£p fs v·ªõi WASI (WebAssembly System Interface) cho secure sandboxes.	
	
		Common Pitfalls: Qu√™n close handles (leak FDs), kh√¥ng handle large files (OOM), ignore encoding (garbage text).
	
	
# 	7. T√≥m T·∫Øt V√† L·ªùi Khuy√™n Chuy√™n Gia
	fs l√† c√¥ng c·ª• m·∫°nh m·∫Ω cho file ops, nh∆∞ng d√πng c·∫©n th·∫≠n ƒë·ªÉ tr√°nh data loss/security issues. B·∫Øt ƒë·∫ßu v·ªõi promises/async cho modern code. Trong real apps, k·∫øt h·ª£p v·ªõi Express cho file uploads (multer middleware).	
	
	
	
https://www.w3schools.com/nodejs/nodejs_path.asp	
	
</pre><a id='backBottom' href='../NodeJS-learning.html' style='display:none;'>üîô Quay l·∫°i danh s√°ch</a><br><button onclick='toggleTheme()'>üåô Chuy·ªÉn giao di·ªán</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>