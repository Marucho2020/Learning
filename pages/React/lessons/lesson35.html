<html><head><title>Lesson 35 == useReduce ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../react-learning-list.html'>ðŸ”™ Quay láº¡i danh sÃ¡ch</a><br><h1>Lesson 35 -- useReduce -//</h1><pre>
# Giá»›i Thiá»‡u Vá» Hook useReducer Trong React (Má»©c Äá»™ Senior)

	useReducer lÃ  má»™t hook máº¡nh máº½ trong React, Ä‘Æ°á»£c giá»›i thiá»‡u tá»« phiÃªn báº£n 16.8, cho phÃ©p quáº£n lÃ½ tráº¡ng thÃ¡i phá»©c táº¡p má»™t cÃ¡ch cÃ³ cáº¥u trÃºc, tÆ°Æ¡ng tá»± nhÆ° Redux nhÆ°ng á»Ÿ cáº¥p Ä‘á»™ component. KhÃ´ng giá»‘ng useState chá»‰ phÃ¹ há»£p cho tráº¡ng thÃ¡i Ä‘Æ¡n giáº£n, useReducer lÃ½ tÆ°á»Ÿng khi tráº¡ng thÃ¡i phá»¥ thuá»™c vÃ o logic phá»©c táº¡p, nhiá»u actions, hoáº·c khi báº¡n cáº§n tÃ¡ch biá»‡t logic cáº­p nháº­t tráº¡ng thÃ¡i khá»i component UI. á»ž má»©c Ä‘á»™ senior, chÃºng ta cáº§n hiá»ƒu sÃ¢u vá» cÆ¡ cháº¿ reducer pattern (inspired by Redux), cÃ¡ch tá»‘i Æ°u hÃ³a performance, tÃ­ch há»£p vá»›i cÃ¡c hook khÃ¡c (nhÆ° useContext, useEffect), xá»­ lÃ½ async actions, vÃ  trÃ¡nh cÃ¡c pitfalls nhÆ° stale closures hoáº·c over-fetching.


# 1. CÆ¡ Cháº¿ Hoáº¡t Äá»™ng Ná»™i Bá»™ Cá»§a useReducer 

	Äá»‹nh nghÄ©a cÆ¡ báº£n: useReducer(reducer, initialArg, init?) nháº­n reducer function (pure function nháº­n state hiá»‡n táº¡i vÃ  action, tráº£ vá» state má»›i), initialArg (giÃ¡ trá»‹ ban Ä‘áº§u hoáº·c argument cho init), vÃ  optional init function (Ä‘á»ƒ lazy init state). Hook tráº£ vá» [state, dispatch], nÆ¡i dispatch lÃ  function gá»­i action Ä‘áº¿n reducer.


	Reducer Pattern: Reducer pháº£i lÃ  pure (khÃ´ng side effects, khÃ´ng mutate state trá»±c tiáº¿p), luÃ´n tráº£ vá» state má»›i (immutable update). React so sÃ¡nh state má»›i vá»›i cÅ© (shallow compare) Ä‘á»ƒ quyáº¿t Ä‘á»‹nh re-render. Náº¿u state lÃ  object/array, dÃ¹ng spread operator hoáº·c libraries nhÆ° Immer Ä‘á»ƒ immutable updates.


	## So sÃ¡nh vá»›i useState:
		useState: PhÃ¹ há»£p tráº¡ng thÃ¡i Ä‘Æ¡n giáº£n, setter mutate trá»±c tiáº¿p. Dá»… gÃ¢y code lá»™n xá»™n náº¿u nhiá»u updaters.

		useReducer: Táº­p trung logic vÃ o reducer, dá»… test/debug, scale tá»‘t cho complex state (nhÆ° forms vá»›i validation, multi-step wizards). Tuy nhiÃªn, verbose hÆ¡n cho state Ä‘Æ¡n giáº£n.

	Lifecycle vÃ  Performance: State persist qua renders, dispatch stable (khÃ´ng thay Ä‘á»•i). React batch updates tá»« dispatch Ä‘á»ƒ tá»‘i Æ°u. á»ž senior level: DÃ¹ng vá»›i React.memo hoáº·c useMemo Ä‘á»ƒ trÃ¡nh re-renders khÃ´ng cáº§n; reducer nÃªn hiá»‡u quáº£ (O(n) hoáº·c tá»‘t hÆ¡n).


	## Pitfalls chuyÃªn sÃ¢u 

		- Mutable state: KhÃ´ng mutate state trá»±c tiáº¿p trong reducer (gÃ¢y bugs khÃ³ debug).
		- Async trong reducer: Reducer pháº£i sync; xá»­ lÃ½ async qua useEffect + dispatch.
		- Stale closures: Náº¿u capture state trong callback, cÃ³ thá»ƒ Ä‘á»c giÃ¡ trá»‹ cÅ©; luÃ´n dÃ¹ng dispatch Ä‘á»ƒ update.
		- Over-dispatch: TrÃ¡nh dispatch liÃªn tá»¥c gÃ¢y re-renders; batch actions náº¿u cÃ³ thá»ƒ.
		- Memory: Vá»›i state lá»›n, dÃ¹ng reducer Ä‘á»ƒ quáº£n lÃ½, nhÆ°ng theo dÃµi allocations.


# VÃ­ dá»¥ cÆ¡ báº£n Quáº£n lÃ½ score cá»§a players.


import { useReducer } from 'react';

const initialScore = [
  { id: 1, score: 0, name: "John" },
  { id: 2, score: 0, name: "Sally" },
];

const reducer = (state, action) => {
  switch (action.type) {
    case "INCREASE":
      return state.map(player => 
        player.id === action.id ? { ...player, score: player.score + 1 } : player
      );
    case "RESET":
      return initialScore; // Reset toÃ n bá»™
    default:
      return state;
  }
};

function ScoreTracker() {
  const [score, dispatch] = useReducer(reducer, initialScore);

  return (
    <>
      {score.map(player => (
        <div key={player.id}>
          <button onClick={() => dispatch({ type: "INCREASE", id: player.id })}>
            TÄƒng {player.name}
          </button>
          <span>{player.score}</span>
        </div>
      ))}
      <button onClick={() => dispatch({ type: "RESET" })}>Reset</button>
    </>
  );
}


# 2. Syntax Chi Tiáº¿t VÃ  Lazy Initialization

	Syntax Ä‘áº§y Ä‘á»§: const [state, dispatch] = useReducer(reducer, initialArg, init);

		- reducer: (state, action) => newState
		- initialArg: GiÃ¡ trá»‹ ban Ä‘áº§u hoáº·c arg cho init.
		- init: Optional function nháº­n initialArg, tráº£ vá» initialState. DÃ¹ng Ä‘á»ƒ lazy compute (vÃ­ dá»¥: parse localStorage) chá»‰ khi mount.	

	Lá»£i Ã­ch init: TrÃ¡nh compute náº·ng má»—i render; chá»‰ cháº¡y láº§n Ä‘áº§u.

	VÃ­ dá»¥ vá»›i Lazy Init: Load initial state tá»« localStorage.


import { useReducer } from 'react';

const reducer = (state, action) => {
  switch (action.type) {
    case "TOGGLE":
      return { ...state, active: !state.active };
    default:
      return state;
  }
};

const init = (initialActive) => {
  const saved = localStorage.getItem('active');
  return { active: saved ? JSON.parse(saved) : initialActive };
};

function ToggleButton() {
  const [state, dispatch] = useReducer(reducer, false, init); // false lÃ  initialArg

  const handleToggle = () => {
    dispatch({ type: "TOGGLE" });
    localStorage.setItem('active', JSON.stringify(!state.active));
  };

  return <button onClick={handleToggle}>{state.active ? 'On' : 'Off'}</button>;
}

	Giáº£i thÃ­ch: Init cháº¡y chá»‰ láº§n Ä‘áº§u, load tá»« storage. Reducer update state, side effect trong handler.


# 3. Use Case NÃ¢ng Cao: Quáº£n LÃ½ Tráº¡ng ThÃ¡i Phá»©c Táº¡p (Forms Vá»›i Validation)

	## VÃ­ dá»¥: Form Login Vá»›i Validation: 
	
import { useReducer } from 'react';

const initialState = { username: '', password: '', errors: {} };

const reducer = (state, action) => {
  switch (action.type) {
    case "UPDATE_FIELD":
      return { ...state, [action.field]: action.value, errors: { ...state.errors, [action.field]: '' } };
    case "VALIDATE":
      const errors = {};
      if (!state.username) errors.username = 'Username required';
      if (state.password.length < 6) errors.password = 'Password too short';
      return { ...state, errors };
    case "SUBMIT":
      // Giáº£ láº­p submit success
      return initialState;
    default:
      return state;
  }
};

function LoginForm() {
  const [state, dispatch] = useReducer(reducer, initialState);

  const handleChange = (e) => {
    dispatch({ type: "UPDATE_FIELD", field: e.target.name, value: e.target.value });
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    dispatch({ type: "VALIDATE" });
    if (Object.keys(state.errors).length === 0) {
      dispatch({ type: "SUBMIT" });
      alert('Login success!');
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      <input name="username" value={state.username} onChange={handleChange} />
      {state.errors.username && <p>{state.errors.username}</p>}
      <input name="password" type="password" value={state.password} onChange={handleChange} />
      {state.errors.password && <p>{state.errors.password}</p>}
      <button type="submit">Login</button>
    </form>
  );
}	
	
	
	
	
	
# 4. Use Case NÃ¢ng Cao: Xá»­ LÃ½ Async Actions (API Calls)	
	
	Reducer sync, nÃªn dÃ¹ng useEffect cho async, dispatch káº¿t quáº£.	
	
	import { useReducer, useEffect } from 'react';

const initialState = { data: [], loading: false, error: null };

const reducer = (state, action) => {
  switch (action.type) {
    case "FETCH_START":
      return { ...state, loading: true, error: null };
    case "FETCH_SUCCESS":
      return { ...state, loading: false, data: action.payload };
    case "FETCH_ERROR":
      return { ...state, loading: false, error: action.error };
    default:
      return state;
  }
};

function DataFetcher() {
  const [state, dispatch] = useReducer(reducer, initialState);

  useEffect(() => {
    dispatch({ type: "FETCH_START" });
    fetch('https://jsonplaceholder.typicode.com/posts')
      .then(res => res.json())
      .then(data => dispatch({ type: "FETCH_SUCCESS", payload: data.slice(0, 5) }))
      .catch(err => dispatch({ type: "FETCH_ERROR", error: err.message }));
  }, []); // Chá»‰ fetch láº§n Ä‘áº§u

  if (state.loading) return <p>Loading...</p>;
  if (state.error) return <p>Error: {state.error}</p>;

  return (
    <ul>
      {state.data.map(post => <li key={post.id}>{post.title}</li>)}
    </ul>
  );
}
	
	
	
# 5. Use Case NÃ¢ng Cao: TÃ­ch Há»£p Vá»›i useContext (Global State)	
	DÃ¹ng cho app-wide state nhÆ° Redux lite.	
	
		Giáº£i thÃ­ch: Context cung cáº¥p state/dispatch cho subtree. LÃ½ tÆ°á»Ÿng cho medium apps, trÃ¡nh prop drilling
	
import { createContext, useContext, useReducer } from 'react';

const CounterContext = createContext();

const reducer = (state, action) => {
  switch (action.type) {
    case "INCREMENT": return { count: state.count + 1 };
    case "DECREMENT": return { count: state.count - 1 };
    default: return state;
  }
};

function CounterProvider({ children }) {
  const [state, dispatch] = useReducer(reducer, { count: 0 });
  return (
    <CounterContext.Provider value={{ state, dispatch }}>
      {children}
    </CounterContext.Provider>
  );
}

function CounterDisplay() {
  const { state } = useContext(CounterContext);
  return <h1>Count: {state.count}</h1>;
}

function CounterButtons() {
  const { dispatch } = useContext(CounterContext);
  return (
    <>
      <button onClick={() => dispatch({ type: "INCREMENT" })}>+</button>
      <button onClick={() => dispatch({ type: "DECREMENT" })}>-</button>
    </>
  );
}

// Usage in App:
function App() {
  return (
    <CounterProvider>
      <CounterDisplay />
      <CounterButtons />
    </CounterProvider>
  );
}	
	
# 6. Use Case NÃ¢ng Cao: Custom Hooks Vá»›i useReducer
	VÃ­ dá»¥: useCounter Custom Hook:

import { useReducer } from 'react';

function useCounter(initialCount = 0) {
  const reducer = (state, action) => {
    switch (action.type) {
      case "INCREMENT": return { count: state.count + (action.payload || 1) };
      case "DECREMENT": return { count: state.count - (action.payload || 1) };
      case "RESET": return { count: initialCount };
      default: return state;
    }
  };

  const [state, dispatch] = useReducer(reducer, { count: initialCount });

  return [state.count, dispatch];
}

function Counter() {
  const [count, dispatch] = useCounter(5);

  return (
    <>
      <h1>{count}</h1>
      <button onClick={() => dispatch({ type: "INCREMENT", payload: 2 })}>+2</button>
      <button onClick={() => dispatch({ type: "DECREMENT" })}>-1</button>
      <button onClick={() => dispatch({ type: "RESET" })}>Reset</button>
    </>
  );
}





https://www.w3schools.com/react/react_usecallback.asp




</pre><a id='backBottom' href='../react-learning-list.html' style='display:none;'>ðŸ”™ Quay láº¡i danh sÃ¡ch</a><br><button onclick='toggleTheme()'>ðŸŒ™ Chuyá»ƒn giao diá»‡n</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>