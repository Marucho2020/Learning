<html><head><title>Lesson 36 == User Callback ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../react-learning-list.html'>üîô Quay l·∫°i danh s√°ch</a><br><h1>Lesson 36 -- User Callback -//</h1><pre>
#  Gi·ªõi Thi·ªáu V·ªÅ Hook useCallback Trong React (M·ª©c ƒê·ªô Senior)

	useCallback l√† m·ªôt hook quan tr·ªçng trong React, ƒë∆∞·ª£c gi·ªõi thi·ªáu t·ª´ phi√™n b·∫£n 16.8, d√πng ƒë·ªÉ memoize (l∆∞u cache) c√°c callback functions, gi√∫p tr√°nh vi·ªác recreate function kh√¥ng c·∫ßn thi·∫øt trong m·ªói render. ƒêi·ªÅu n√†y c·∫£i thi·ªán performance b·∫±ng c√°ch gi·∫£m re-renders c·ªßa child components, ƒë·∫∑c bi·ªát khi k·∫øt h·ª£p v·ªõi React.memo ho·∫∑c useMemo. ·ªû m·ª©c ƒë·ªô senior, ch√∫ng ta c·∫ßn hi·ªÉu s√¢u v·ªÅ referential equality (so s√°nh tham chi·∫øu), c√°ch hook ho·∫°t ƒë·ªông trong closure v√† dependency array, t√≠ch h·ª£p v·ªõi c√°c hook kh√°c ƒë·ªÉ tr√°nh stale closures ho·∫∑c infinite loops, v√† c√°c t√¨nh hu·ªëng t·ªëi ∆∞u h√≥a trong large-scale apps (nh∆∞ v·ªõi Context, Redux, ho·∫∑c heavy computations). Memoization ·ªü ƒë√¢y d·ª±a tr√™n shallow compare c·ªßa dependencies, t∆∞∆°ng t·ª± useMemo, nh∆∞ng t·∫≠p trung v√†o functions.



# 1. C∆° Ch·∫ø Ho·∫°t ƒê·ªông N·ªôi B·ªô C·ªßa useCallback 

	ƒê·ªãnh nghƒ©a c∆° b·∫£n: useCallback(callback, dependencies) nh·∫≠n m·ªôt callback function v√† m·∫£ng dependencies, tr·∫£ v·ªÅ version memoized c·ªßa callback. Callback ch·ªâ ƒë∆∞·ª£c recreate khi deps thay ƒë·ªïi (shallow compare). N·∫øu deps l√† [], callback stable m√£i m√£i.	

	Memoization v√† Referential Equality: Trong React, m·ªói render t·∫°o m·ªõi functions (v√¨ JS functions l√† objects). ƒêi·ªÅu n√†y l√†m props thay ƒë·ªïi theo referential (!==), g√¢y re-render child d√π gi√° tr·ªã logic kh√¥ng ƒë·ªïi. useCallback cache function instance, gi·ªØ reference ·ªïn ƒë·ªãnh.


	## So s√°nh v·ªõi useMemo: 

		useMemo: Memoize b·∫•t k·ª≥ value n√†o (s·ªë, object, array), d√πng cho computations n·∫∑ng.

		useCallback: L√† tr∆∞·ªùng h·ª£p ƒë·∫∑c bi·ªát c·ªßa useMemo cho functions, t∆∞∆°ng ƒë∆∞∆°ng useMemo(() => callback, deps). D√πng khi c·∫ßn pass function l√†m prop ho·∫∑c dep.

		Kh√°c bi·ªát: useMemo ch·∫°y computation m·ªói khi deps ƒë·ªïi; useCallback ch·ªâ return cached function m√† kh√¥ng ch·∫°y n√≥.



	## Lifecycle v√† Performance:
		Hook ch·∫°y ·ªü render phase, cache ·ªü React's fiber tree. Gi·∫£m re-renders b·∫±ng stable props. ·ªû senior level: Theo d√µi deps ƒë·ªÉ tr√°nh bugs (qu√™n dep g√¢y stale values); d√πng ESLint plugin (react-hooks/exhaustive-deps) ƒë·ªÉ lint deps.	
	
	## Pitfalls chuy√™n s√¢u
	
		- Missing deps: N·∫øu qu√™n dep, callback capture stale values t·ª´ closure c≈©.
		- Over-memoization: Memoize m·ªçi th·ª© g√¢y memory overhead; ch·ªâ d√πng khi c·∫ßn (v√≠ d·ª•: child re-render costly).
		- Infinite loops: N·∫øu dep bao g·ªìm state t·ª´ setter trong callback, g√¢y loop.
		- Kh√¥ng mutate: Callback n√™n pure n·∫øu c√≥ th·ªÉ, tr√°nh side effects ngo√†i dispatch.
	
# 	V√≠ d·ª• c∆° b·∫£n
	
	// App.js (kh√¥ng useCallback - v·∫•n ƒë·ªÅ)
import { useState } from 'react';
import Todos from './Todos';

function App() {
  const [count, setCount] = useState(0);
  const [todos, setTodos] = useState([]);

  const increment = () => setCount(c => c + 1);
  const addTodo = () => setTodos(t => [...t, 'New Todo']); // Recreate m·ªói render

  console.log('App render');
  return (
    <>
      <Todos todos={todos} addTodo={addTodo} />
      <hr />
      <div>Count: {count} <button onClick={increment}>+</button></div>
    </>
  );
}

// Todos.js
import { memo } from 'react';

const Todos = memo(({ todos, addTodo }) => {
  console.log('Todos render'); // Re-render d√π todos kh√¥ng ƒë·ªïi
  return (
    <>
      <h2>My Todos</h2>
      {todos.map((todo, index) => <p key={index}>{todo}</p>)}
      <button onClick={addTodo}>Add Todo</button>
    </>
  );
});
	
	Gi·∫£i th√≠ch: Khi click "+", App re-render, addTodo recreate (reference m·ªõi), Todos re-render d√π todos kh√¥ng ƒë·ªïi v√¨ memo shallow compare props.	
	
	
	## Gi·∫£i ph√°p v·ªõi useCallback:
	
// App.js (v·ªõi useCallback)
import { useState, useCallback } from 'react';
import Todos from './Todos';

function App() {
  const [count, setCount] = useState(0);
  const [todos, setTodos] = useState([]);

  const increment = () => setCount(c => c + 1);
  const addTodo = useCallback(() => setTodos(t => [...t, 'New Todo']), [setTodos]); // Memoize, deps r·ªóng n·∫øu setTodos stable

  console.log('App render');
  return (
    <>
      <Todos todos={todos} addTodo={addTodo} />
      <hr />
      <div>Count: {count} <button onClick={increment}>+</button></div>
    </>
  );
}

	Gi·∫£i th√≠ch: addTodo stable tr·ª´ khi deps ƒë·ªïi (·ªü ƒë√¢y [], n√™n stable m√£i). Todos ch·ªâ re-render khi todos ƒë·ªïi. L∆∞u √Ω: deps n√™n bao g·ªìm todos n·∫øu callback d√πng n√≥, nh∆∞ng ·ªü ƒë√¢y d√πng updater function n√™n kh√¥ng c·∫ßn.



# 2. Use Case N√¢ng Cao: T√≠ch H·ª£p V·ªõi useEffect V√† Debounce

	D√πng ƒë·ªÉ stable callback trong deps c·ªßa useEffect, tr√°nh re-run effect kh√¥ng c·∫ßn.
	V√≠ d·ª•: Debounce Search V·ªõi useCallback (T·ªëi ∆∞u API calls):
import { useState, useCallback, useEffect } from 'react';

function DebouncedSearch() {
  const [query, setQuery] = useState('');
  const [results, setResults] = useState([]);

  // Memoize debounce function
  const debouncedSearch = useCallback((q) => {
    const timer = setTimeout(() => {
      // Gi·∫£ l·∫≠p API call
      console.log(`Searching for: ${q}`);
      setResults([`K·∫øt qu·∫£ 1 cho ${q}`, `K·∫øt qu·∫£ 2 cho ${q}`]);
    }, 500);
    return () => clearTimeout(timer);
  }, []); // Deps r·ªóng, stable debounce

  useEffect(() => {
    if (query) {
      return debouncedSearch(query); // Cleanup previous timeout
    }
  }, [query, debouncedSearch]); // debouncedSearch stable nh·ªù useCallback

  return (
    <>
      <input value={query} onChange={e => setQuery(e.target.value)} placeholder="T√¨m ki·∫øm..." />
      <ul>{results.map((res, idx) => <li key={idx}>{res}</li>)}</ul>
    </>
  );
}

	Gi·∫£i th√≠ch: useCallback gi·ªØ debouncedSearch stable, useEffect ch·ªâ re-run khi query ƒë·ªïi, tr√°nh recreate timeout m·ªói render. Kh√¥ng useCallback, debouncedSearch recreate, g√¢y useEffect loop.



# 3. Use Case N√¢ng Cao: Pass Callback Qua Context Ho·∫∑c Custom Hooks


	Trong Context, callback c·∫ßn stable ƒë·ªÉ tr√°nh re-render consumers.
	V√≠ d·ª•: Global Counter V·ªõi Context V√† useCallback:
import { createContext, useContext, useState, useCallback } from 'react';

const CounterContext = createContext();

function CounterProvider({ children }) {
  const [count, setCount] = useState(0);

  const increment = useCallback(() => setCount(c => c + 1), []); // Stable
  const decrement = useCallback(() => setCount(c => c - 1), []);

  return (
    <CounterContext.Provider value={{ count, increment, decrement }}>
      {children}
    </CounterContext.Provider>
  );
}

function CounterDisplay() {
  const { count } = useContext(CounterContext);
  return <h1>Count: {count}</h1>;
}

function CounterButtons() {
  const { increment, decrement } = useContext(CounterContext);
  console.log('Buttons render'); // Kh√¥ng re-render kh√¥ng c·∫ßn
  return (
    <>
      <button onClick={increment}>+</button>
      <button onClick={decrement}>-</button>
    </>
  );
}

// App.js
function App() {
  return (
    <CounterProvider>
      <CounterDisplay />
      <CounterButtons />
    </CounterProvider>
  );
}

	Gi·∫£i th√≠ch: useCallback gi·ªØ increment/decrement stable, tr√°nh re-render CounterButtons khi Provider re-render (v√≠ d·ª•: th√™m state kh√°c). ·ªû senior, d√πng cho performance trong large context trees.


# 4. Use Case N√¢ng Cao: T√≠ch H·ª£p V·ªõi React.memo V√† Heavy Child
	D√πng cho child v·ªõi expensive renders.
	V√≠ d·ª•: Expensive List V·ªõi Filter Callback:

import { useState, useCallback, memo } from 'react';

const ExpensiveItem = memo(({ item, onSelect }) => {
  console.log(`Render item ${item}`); // Heavy render gi·∫£ l·∫≠p
  return <li onClick={() => onSelect(item)}>{item}</li>;
});

function FilteredList() {
  const [filter, setFilter] = useState('');
  const items = ['Apple', 'Banana', 'Cherry', 'Date', 'Elderberry'];

  const handleSelect = useCallback((selected) => {
    alert(`Selected: ${selected}`);
  }, []); // Stable callback

  const filteredItems = items.filter(item => item.toLowerCase().includes(filter.toLowerCase()));

  return (
    <>
      <input value={filter} onChange={e => setFilter(e.target.value)} placeholder="L·ªçc..." />
      <ul>
        {filteredItems.map(item => (
          <ExpensiveItem key={item} item={item} onSelect={handleSelect} />
        ))}
      </ul>
    </>
  );
}



# 5. Use Case N√¢ng Cao: Custom Hook V·ªõi useCallback
	Encapsulate logic reusable.
	V√≠ d·ª•: useLogger Custom Hook:

import { useCallback } from 'react';

function useLogger(prefix) {
  // Memoize logger ƒë·ªÉ stable trong deps kh√°c
  const log = useCallback((message) => {
    console.log(`${prefix}: ${message}`);
  }, [prefix]);

  return log;
}

function Component() {
  const logger = useLogger('MyComponent');

  // S·ª≠ d·ª•ng trong effect ho·∫∑c callback kh√°c
  return <button onClick={() => logger('Clicked')}>Log</button>;
}


# K·∫øt Lu·∫≠n V√† Best Practices (M·ª©c Chuy√™n Gia)

	Khi d√πng useCallback: Callback pass l√†m prop, deps trong useEffect, debounce/throttle, context values. Ch·ªâ d√πng n·∫øu re-render costly (measure v·ªõi React Profiler).
	Tr√°nh: Memoize primitive callbacks ƒë∆°n gi·∫£n (overhead > l·ª£i √≠ch); qu√™n deps g√¢y stale data.
	T√≠ch h·ª£p: V·ªõi useMemo cho values, useEffect cho side effects, React.memo cho components.
	Performance tip: Deps minimum, d√πng updater functions (c => c + 1) ƒë·ªÉ tr√°nh deps tr√™n state. Trong TS, type callback v·ªõi React.FC ho·∫∑c generics.
	Debug: React DevTools inspect memoized functions; console.log check renders.
	Advanced: K·∫øt h·ª£p Immer/Proxy cho immutable, ho·∫∑c libs nh∆∞ ahooks cho pre-built memoized utils.



</pre><a id='backBottom' href='../react-learning-list.html' style='display:none;'>üîô Quay l·∫°i danh s√°ch</a><br><button onclick='toggleTheme()'>üåô Chuy·ªÉn giao di·ªán</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>