<html><head><title>Lesson 38 == Custom Hook ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../react-learning-list.html'>üîô Quay l·∫°i danh s√°ch</a><br><h1>Lesson 38 -- Custom Hook -//</h1><pre>
	Custom Hooks trong React l√† c√°ch ƒë·ªÉ t√°i s·ª≠ d·ª•ng logic tr·∫°ng th√°i (stateful logic) gi·ªØa c√°c component, gi√∫p code DRY (Don't Repeat Yourself), d·ªÖ maintain, v√† tƒÉng t√≠nh t√°i s·ª≠ d·ª•ng. Ch√∫ng l√† c√°c function JavaScript b·∫Øt ƒë·∫ßu b·∫±ng t·ª´ kh√≥a use (theo convention c·ªßa React) v√† c√≥ th·ªÉ s·ª≠ d·ª•ng c√°c built-in hooks nh∆∞ useState, useEffect, useRef, useCallback, useMemo, v.v. ƒë·ªÉ ƒë√≥ng g√≥i logic ph·ª©c t·∫°p. ·ªû m·ª©c ƒë·ªô senior, ch√∫ng ta c·∫ßn hi·ªÉu s√¢u v·ªÅ c√°ch custom hooks ho·∫°t ƒë·ªông trong React's reconciliation, c√°ch chia s·∫ª logic hi·ªáu qu·∫£, qu·∫£n l√Ω lifecycle, tr√°nh memory leaks, t√≠ch h·ª£p v·ªõi TypeScript, v√† x·ª≠ l√Ω c√°c edge cases nh∆∞ async operations ho·∫∑c context dependencies.


# 1. C∆° Ch·∫ø Ho·∫°t ƒê·ªông N·ªôi B·ªô C·ªßa Custom Hooks

	## ƒê·ªãnh nghƒ©a c∆° b·∫£n: 
		Custom hook l√† m·ªôt function JavaScript b·∫Øt ƒë·∫ßu b·∫±ng use, s·ª≠ d·ª•ng built-in hooks ƒë·ªÉ qu·∫£n l√Ω logic, v√† tr·∫£ v·ªÅ gi√° tr·ªã (state, functions, refs, v.v.) ƒë·ªÉ component s·ª≠ d·ª•ng. Ch√∫ng kh√¥ng ch·ª©a JSX m√† ch·ªâ ƒë√≥ng g√≥i logic t√°i s·ª≠ d·ª•ng.
	
	
	## T·∫°i sao c·∫ßn custom hooks: 
		
		- T√°i s·ª≠ d·ª•ng logic: Thay v√¨ copy-paste logic (nh∆∞ fetch data, form handling, timers) gi·ªØa components, custom hooks gom logic v√†o m·ªôt n∆°i.
		- T√°ch bi·ªát concerns: Gi·ªØ component UI-focused, logic ·ªü hooks, d·ªÖ test v√† debug.
		- Composition: K·∫øt h·ª£p nhi·ªÅu hooks trong m·ªôt custom hook ƒë·ªÉ x·ª≠ l√Ω complex scenarios (nh∆∞ form validation + API calls).

	## Lifecycle v√† Scope: 
		Custom hooks ch·∫°y trong render phase c·ªßa component g·ªçi ch√∫ng, k·∫ø th·ª´a lifecycle c·ªßa component ƒë√≥. M·ªói instance c·ªßa custom hook trong component l√† ƒë·ªôc l·∫≠p (state/refs ri√™ng bi·ªát). Cleanup trong useEffect c·ªßa hook ƒë·∫£m b·∫£o kh√¥ng leak memory.

	## So s√°nh v·ªõi HOCs/Render Props:

		- HOCs: Wrap component, th√™m logic qua props, nh∆∞ng g√¢y wrapper hell v√† kh√≥ debug.
		- Render Props: Pass logic qua render function, nh∆∞ng verbose v√† kh√≥ share stateful logic.
		- Custom Hooks: Elegant, native v·ªõi functional components, d·ªÖ compose, kh√¥ng c·∫ßn wrapper.


	## Pitfalls chuy√™n s√¢u:
		
		- Qu√™n cleanup: useEffect trong hook c·∫ßn return cleanup ƒë·ªÉ tr√°nh leaks (timers, subscriptions).
		- Stale closures: Capture state/props c≈© n·∫øu kh√¥ng qu·∫£n l√Ω deps ƒë√∫ng trong useEffect/useCallback.
		- Over-abstraction: ƒê·ª´ng t·∫°o hook cho logic qu√° ƒë∆°n gi·∫£n (overhead > l·ª£i √≠ch).
		- Naming: Ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng use ƒë·ªÉ React tooling (ESLint, DevTools) nh·∫≠n di·ªán.
		- Testing: Test hooks v·ªõi @testing-library/react-hooks ho·∫∑c trong components.



# V√≠ d·ª• c∆° b·∫£n (t·ª´ W3Schools, m·ªü r·ªông v·ªõi error handling): Custom hook fetch data.

// useFetch.js
import { useState, useEffect } from 'react';

const useFetch = (url) => {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    setLoading(true);
    fetch(url)
      .then(res => {
        if (!res.ok) throw new Error('Fetch failed');
        return res.json();
      })
      .then(data => setData(data))
      .catch(err => setError(err.message))
      .finally(() => setLoading(false));
  }, [url]);

  return { data, loading, error }; // Object thay v√¨ array cho readability
};

// Home.js
import useFetch from './useFetch';

function Home() {
  const { data, loading, error } = useFetch('https://jsonplaceholder.typicode.com/todos');

  if (loading) return <p>Loading...</p>;
  if (error) return <p>Error: {error}</p>;

  return (
    <>
      {data && data.map(item => <p key={item.id}>{item.title}</p>)}
    </>
  );
}

	Gi·∫£i th√≠ch: useFetch ƒë√≥ng g√≥i logic fetch (state, effect, error handling). Component ch·ªâ lo render UI. Object return thay array tƒÉng readability v√† d·ªÖ destructure.

# 2. Use Case N√¢ng Cao: Custom Hook V·ªõi Form Handling
	D√πng ƒë·ªÉ qu·∫£n l√Ω forms ph·ª©c t·∫°p, validation, v√† reset.
	V√≠ d·ª•: useForm Hook:

// useForm.js
import { useState, useCallback } from 'react';

const useForm = (initialValues) => {
  const [values, setValues] = useState(initialValues);
  const [errors, setErrors] = useState({});

  const handleChange = useCallback((e) => {
    const { name, value } = e.target;
    setValues(prev => ({ ...prev, [name]: value }));
    setErrors(prev => ({ ...prev, [name]: '' }));
  }, []);

  const validate = useCallback(() => {
    const newErrors = {};
    Object.keys(values).forEach(key => {
      if (!values[key]) newErrors[key] = `${key} is required`;
    });
    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  }, [values]);

  const reset = useCallback(() => setValues(initialValues), [initialValues]);

  return { values, errors, handleChange, validate, reset };
};

// LoginForm.js
import useForm from './useForm';

function LoginForm() {
  const { values, errors, handleChange, validate, reset } = useForm({
    username: '',
    password: '',
  });

  const handleSubmit = (e) => {
    e.preventDefault();
    if (validate()) {
      console.log('Submit:', values);
      reset();
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      <input name="username" value={values.username} onChange={handleChange} />
      {errors.username && <p>{errors.username}</p>}
      <input name="password" type="password" value={values.password} onChange={handleChange} />
      {errors.password && <p>{errors.password}</p>}
      <button type="submit">Login</button>
      <button type="button" onClick={reset}>Reset</button>
    </form>
  );
}
	Gi·∫£i th√≠ch: useForm qu·∫£n l√Ω form state, validation, v√† reset logic. useCallback stable handlers, tr√°nh recreate. Hook reusable cho b·∫•t k·ª≥ form n√†o.


# 3. Use Case N√¢ng Cao: Custom Hook V·ªõi Async Operations
	D√πng ƒë·ªÉ fetch data v·ªõi retry, cancel, ho·∫∑c pagination.

// useAsyncFetch.js
import { useState, useEffect, useCallback } from 'react';

const useAsyncFetch = (url, maxRetries = 3) => {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const [retryCount, setRetryCount] = useState(0);

  const fetchData = useCallback(async () => {
    setLoading(true);
    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error('Fetch failed');
      const result = await res.json();
      setData(result);
      setError(null);
    } catch (err) {
      if (retryCount < maxRetries) {
        setRetryCount(prev => prev + 1);
      } else {
        setError(err.message);
      }
    } finally {
      setLoading(false);
    }
  }, [url, retryCount, maxRetries]);

  useEffect(() => {
    fetchData();
  }, [fetchData]);

  const retry = useCallback(() => {
    setRetryCount(0);
    fetchData();
  }, [fetchData]);

  return { data, loading, error, retry };
};

// Posts.js
import useAsyncFetch from './useAsyncFetch';

function Posts() {
  const { data, loading, error, retry } = useAsyncFetch('https://jsonplaceholder.typicode.com/posts');

  if (loading) return <p>Loading...</p>;
  if (error) return (
    <>
      <p>Error: {error}</p>
      <button onClick={retry}>Retry</button>
    </>
  );

  return (
    <ul>
      {data && data.slice(0, 5).map(post => <li key={post.id}>{post.title}</li>)}
    </ul>
  );
}



# 4. Use Case N√¢ng Cao: Custom Hook V·ªõi Context Integration

	D√πng ƒë·ªÉ share logic v·ªõi context, tr√°nh prop drilling.
	V√≠ d·ª•: useAuth Hook V·ªõi Context:

// AuthContext.js
import { createContext, useContext, useState } from 'react';

const AuthContext = createContext();

export function AuthProvider({ children }) {
  const [user, setUser] = useState(null);
  return <AuthContext.Provider value={{ user, setUser }}>{children}</AuthContext.Provider>;
}

// useAuth.js
import { useContext, useCallback } from 'react';
import { AuthContext } from './AuthContext';

const useAuth = () => {
  const { user, setUser } = useContext(AuthContext);

  const login = useCallback(async (credentials) => {
    // Gi·∫£ l·∫≠p API login
    const response = await new Promise(resolve => setTimeout(() => resolve({ id: 1, name: 'User' }), 1000));
    setUser(response);
  }, [setUser]);

  const logout = useCallback(() => setUser(null), [setUser]);

  return { user, login, logout };
};

// Profile.js
import { AuthProvider } from './AuthContext';
import useAuth from './useAuth';

function Profile() {
  const { user, login, logout } = useAuth();

  return (
    <>
      {user ? (
        <>
          <p>Welcome, {user.name}</p>
          <button onClick={logout}>Logout</button>
        </>
      ) : (
        <button onClick={() => login({ username: 'test' })}>Login</button>
      )}
    </>
  );
}

// App.js
function App() {
  return (
    <AuthProvider>
      <Profile />
    </AuthProvider>
  );
}


# 5. Use Case N√¢ng Cao: Custom Hook V·ªõi useReducer

// useCounter.js
import { useReducer } from 'react';

const reducer = (state, action) => {
  switch (action.type) {
    case 'INCREMENT': return { count: state.count + (action.payload || 1) };
    case 'DECREMENT': return { count: state.count - (action.payload || 1) };
    case 'RESET': return { count: action.initialCount };
    default: return state;
  }
};

const useCounter = (initialCount = 0) => {
  const [state, dispatch] = useReducer(reducer, { count: initialCount });

  const increment = useCallback(() => dispatch({ type: 'INCREMENT' }), []);
  const decrement = useCallback(() => dispatch({ type: 'DECREMENT' }), []);
  const reset = useCallback(() => dispatch({ type: 'RESET', initialCount }), [initialCount]);

  return { count: state.count, increment, decrement, reset };
};

// Counter.js
import useCounter from './useCounter';

function Counter() {
  const { count, increment, decrement, reset } = useCounter(5);

  return (
    <>
      <h1>Count: {count}</h1>
      <button onClick={increment}>+1</button>
      <button onClick={decrement}>-1</button>
      <button onClick={reset}>Reset</button>
    </>
  );
}

# K·∫øt Lu·∫≠n V√† Best Practices (M·ª©c Chuy√™n Gia)

	Khi d√πng custom hooks: Logic t√°i s·ª≠ d·ª•ng (fetch, forms, timers, auth), complex state management, ho·∫∑c context integration.
	Tr√°nh: Logic qu√° ƒë∆°n gi·∫£n (d√πng inline), vi ph·∫°m Rules of Hooks, ho·∫∑c kh√¥ng cleanup side effects.
	T√≠ch h·ª£p: V·ªõi useState, useEffect, useCallback, useMemo, useReducer, context ƒë·ªÉ x·ª≠ l√Ω m·ªçi scenario.
	Performance tip: Stable return values v·ªõi useCallback/useMemo, cleanup effects, t·ªëi ∆∞u deps. Trong TS, type hooks v·ªõi interfaces/generics.
	Debug: Test hooks v·ªõi @testing-library/react-hooks, inspect v·ªõi React DevTools.
	Advanced: D√πng libraries nh∆∞ ahooks, react-query (TanStack Query), ho·∫∑c zustand ƒë·ªÉ h·ªçc c√°ch thi·∫øt k·∫ø hooks.


https://www.w3schools.com/react/react_compiler.asp
</pre><a id='backBottom' href='../react-learning-list.html' style='display:none;'>üîô Quay l·∫°i danh s√°ch</a><br><button onclick='toggleTheme()'>üåô Chuy·ªÉn giao di·ªán</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>