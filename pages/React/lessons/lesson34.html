<html><head><title>Lesson 34 == Use Ref ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../react-learning-list.html'>üîô Quay l·∫°i danh s√°ch</a><br><h1>Lesson 34 -- Use Ref -//</h1><pre>
# Kh√°i ni·ªám 
	useRef l√† m·ªôt trong nh·ªØng hook m·∫°nh m·∫Ω nh·∫•t trong React, ƒë∆∞·ª£c gi·ªõi thi·ªáu t·ª´ phi√™n b·∫£n 16.8, cho ph√©p b·∫°n l∆∞u tr·ªØ c√°c gi√° tr·ªã mutable (c√≥ th·ªÉ thay ƒë·ªïi) m√† kh√¥ng g√¢y ra vi·ªác re-render component. Kh√¥ng gi·ªëng nh∆∞ useState hay useReducer, useRef kh√¥ng k√≠ch ho·∫°t c·∫≠p nh·∫≠t UI khi gi√° tr·ªã thay ƒë·ªïi, l√†m cho n√≥ l√Ω t∆∞·ªüng cho c√°c t√¨nh hu·ªëng c·∫ßn duy tr√¨ tr·∫°ng th√°i "·∫©n" ho·∫∑c truy c·∫≠p tr·ª±c ti·∫øp v√†o DOM. ·ªû m·ª©c ƒë·ªô senior, ch√∫ng ta c·∫ßn hi·ªÉu s√¢u v·ªÅ c∆° ch·∫ø ho·∫°t ƒë·ªông n·ªôi b·ªô c·ªßa n√≥, c√°c ·ª©ng d·ª•ng n√¢ng cao, v√† c√°ch t√≠ch h·ª£p v·ªõi c√°c hook kh√°c ƒë·ªÉ t·ªëi ∆∞u h√≥a hi·ªáu su·∫•t, tr√°nh memory leak, v√† x·ª≠ l√Ω c√°c v·∫•n ƒë·ªÅ ph·ª©c t·∫°p nh∆∞ stale closures.

	ƒê·ªãnh nghƒ©a c∆° b·∫£n: useRef(initialValue) tr·∫£ v·ªÅ m·ªôt object mutable c√≥ thu·ªôc t√≠nh current. Gi√° tr·ªã initialValue ch·ªâ ƒë∆∞·ª£c g√°n l·∫ßn ƒë·∫ßu ti√™n khi component mount, v√† sau ƒë√≥ b·∫°n c√≥ th·ªÉ ƒë·ªçc/ghi tr·ª±c ti·∫øp v√†o current m√† kh√¥ng g√¢y re-render.

	## So s√°nh v·ªõi useState 
		useState l∆∞u tr·ªØ tr·∫°ng th√°i v√† g√¢y re-render khi setter ƒë∆∞·ª£c g·ªçi, ph√π h·ª£p cho d·ªØ li·ªáu hi·ªÉn th·ªã tr√™n UI.
	
		useRef kh√¥ng g√¢y re-render, n√™n d√πng cho d·ªØ li·ªáu "ph·ª•" nh∆∞ counter render, DOM refs, ho·∫∑c l∆∞u gi√° tr·ªã t·∫°m th·ªùi. N·∫øu d√πng useState cho counter render, b·∫°n s·∫Ω g·∫∑p infinite loop v√¨ m·ªói update l·∫°i g√¢y render m·ªõi.

	## Mutable vs Immutable:
		Ref object l√† mutable, nghƒ©a l√† b·∫°n c√≥ th·ªÉ thay ƒë·ªïi ref.current m√† React kh√¥ng theo d√µi thay ƒë·ªïi n√†y trong dependency array c·ªßa useEffect. ƒêi·ªÅu n√†y gi√∫p tr√°nh re-run effect kh√¥ng c·∫ßn thi·∫øt, nh∆∞ng c≈©ng c√≥ th·ªÉ d·∫´n ƒë·∫øn stale values n·∫øu kh√¥ng c·∫©n th·∫≠n (v√≠ d·ª•: closure capture gi√° tr·ªã c≈©).
	
		Lifecycle: Ref t·ªìn t·∫°i su·ªët lifecycle c·ªßa component, ch·ªâ b·ªã destroy khi unmount. Kh√¥ng gi·ªëng variables th√¥ng th∆∞·ªùng b·ªã reset m·ªói render.
	
	
		Stale closures: N·∫øu b·∫°n capture ref trong callback, gi√° tr·ªã c√≥ th·ªÉ c≈© n·∫øu kh√¥ng ƒë·ªçc tr·ª±c ti·∫øp t·ª´ ref.current.
		Memory leak: N·∫øu l∆∞u instance l·ªõn (nh∆∞ WebSocket) v√†o ref m√† kh√¥ng cleanup, c√≥ th·ªÉ leak memory.
		Kh√¥ng n√™n l·∫°m d·ª•ng: Ch·ªâ d√πng khi c·∫ßn mutable m√† kh√¥ng re-render; n·∫øu c·∫ßn re-render, d√πng useState.
	
	
# 	V√≠ d·ª• c∆° b·∫£n 
	
import { useState, useRef, useEffect } from 'react';

function RenderCounter() {
  const [inputValue, setInputValue] = useState('');
  const renderCount = useRef(0); // Kh·ªüi t·∫°o ref v·ªõi gi√° tr·ªã 0

  useEffect(() => {
    renderCount.current += 1; // C·∫≠p nh·∫≠t ref m√† kh√¥ng re-render
    console.log(`Render l·∫ßn th·ª©: ${renderCount.current}`);
  }); // Kh√¥ng dependency, ch·∫°y sau m·ªói render

  return (
    <>
      <input
        type="text"
        value={inputValue}
        onChange={(e) => setInputValue(e.target.value)}
      />
      <h1>S·ªë l·∫ßn render: {renderCount.current}</h1> // ƒê·ªçc tr·ª±c ti·∫øp t·ª´ ref.current
    </>
  );
}	
	
	Gi·∫£i th√≠ch chi ti·∫øt: useEffect ch·∫°y sau m·ªói render (post-render phase), c·∫≠p nh·∫≠t ref m√† kh√¥ng trigger render m·ªõi. N·∫øu d√πng useState, setter s·∫Ω g√¢y render loop.	
	
	

# 2. Use Case N√¢ng Cao: Truy C·∫≠p V√† Thao T√°c DOM Tr·ª±c Ti·∫øp 

	useRef th∆∞·ªùng d√πng ƒë·ªÉ t·∫°o ref cho DOM elements qua thu·ªôc t√≠nh ref trong JSX. ƒêi·ªÅu n√†y thay th·∫ø cho createRef trong class components, v√† m·∫°nh h∆°n v√¨ ref t·ªìn t·∫°i su·ªët lifecycle.

	Chuy√™n s√¢u: Trong React, DOM manipulation n√™n h·∫°n ch·∫ø (declarative paradigm), nh∆∞ng useRef c·∫ßn thi·∫øt cho imperative code nh∆∞ focus, scroll, measure dimensions (v√≠ d·ª•: d√πng getBoundingClientRect()). K·∫øt h·ª£p v·ªõi useEffect ƒë·ªÉ ch·∫°y sau khi DOM ready.

	Forward Refs: ƒê·ªÉ forward ref t·ª´ parent sang child component, d√πng React.forwardRef. ƒêi·ªÅu n√†y h·ªØu √≠ch trong HOCs ho·∫∑c libraries nh∆∞ Material-UI


# V√≠ d·ª• 1 (t·ª´ W3Schools, m·ªü r·ªông v·ªõi focus v√† validation): 

import { useRef } from 'react';

function FocusInput() {
  const inputRef = useRef(null); // Kh·ªüi t·∫°o ref cho DOM element

  const handleFocus = () => {
    inputRef.current.focus(); // Truy c·∫≠p DOM method
    if (inputRef.current.value.length < 5) {
      inputRef.current.style.border = '2px solid red'; // Manipulate style
      console.warn('Gi√° tr·ªã qu√° ng·∫Øn!');
    }
  };

  return (
    <>
      <input type="text" ref={inputRef} /> // Attach ref v√†o element
      <button onClick={handleFocus}>Focus v√† Validate</button>
    </>
  );
}



# V√≠ d·ª• 2 (N√¢ng cao: Scroll to bottom trong chat app):

import { useState, useRef, useEffect } from 'react';

function ChatBox() {
  const [messages, setMessages] = useState([]);
  const chatRef = useRef(null);

  const addMessage = () => {
    setMessages((prev) => [...prev, `Tin nh·∫Øn m·ªõi ${prev.length + 1}`]);
  };

  useEffect(() => {
    if (chatRef.current) {
      chatRef.current.scrollTop = chatRef.current.scrollHeight; // Scroll to bottom
    }
  }, [messages]); // Dependency tr√™n messages ƒë·ªÉ ch·∫°y khi c√≥ tin m·ªõi

  return (
    <div>
      <div ref={chatRef} style={{ height: '200px', overflowY: 'scroll' }}>
        {messages.map((msg, idx) => <p key={idx}>{msg}</p>)}
      </div>
      <button onClick={addMessage}>G·ª≠i tin nh·∫Øn</button>
    </div>
  );
}

	Gi·∫£i th√≠ch: Ref d√πng ƒë·ªÉ measure v√† manipulate DOM sau update. Tr√°nh d√πng document.querySelector v√¨ kh√¥ng React-way.


# 3. Use Case N√¢ng Cao: L∆∞u Tr·ªØ Gi√° Tr·ªã Tr∆∞·ªõc ƒê√≥ (Previous State)

	useRef c√≥ th·ªÉ l∆∞u previous values ƒë·ªÉ so s√°nh, h·ªØu √≠ch trong animation, undo/redo, ho·∫∑c logging changes.

import { useState, useRef, useEffect } from 'react';

function TrackPrevious() {
  const [value, setValue] = useState('');
  const prevValueRef = useRef('');

  useEffect(() => {
    prevValueRef.current = value; // C·∫≠p nh·∫≠t sau khi value thay ƒë·ªïi
  }, [value]); // Dependency tr√™n value

  const handleChange = (e) => {
    setValue(e.target.value);
    console.log(`Thay ƒë·ªïi t·ª´ "${prevValueRef.current}" sang "${e.target.value}"`);
  };

  return (
    <>
      <input type="text" value={value} onChange={handleChange} />
      <h2>Gi√° tr·ªã hi·ªán t·∫°i: {value}</h2>
      <h2>Gi√° tr·ªã tr∆∞·ªõc: {prevValueRef.current}</h2>
    </>
  );
}



# 4. Use Case N√¢ng Cao: L∆∞u Tr·ªØ Mutable Values Kh√¥ng Re-Render (Timers, Instances)

	Chuy√™n s√¢u: D√πng cho intervals, timeouts, WebSockets, ho·∫∑c instances (nh∆∞ new Map()). Cleanup trong useEffect return ƒë·ªÉ tr√°nh leak.
	
	Performance: Gi·∫£m re-renders kh√¥ng c·∫ßn thi·∫øt, c·∫£i thi·ªán FPS trong apps ph·ª©c t·∫°p


	## V√≠ d·ª• 1: Interval Timer Kh√¥ng Re-Render: 
import { useRef, useEffect } from 'react';

function Timer() {
  const intervalRef = useRef(null);
  const countRef = useRef(0);

  useEffect(() => {
    intervalRef.current = setInterval(() => {
      countRef.current += 1;
      console.log(`ƒê·∫øm: ${countRef.current}`); // Kh√¥ng re-render
    }, 1000);

    return () => clearInterval(intervalRef.current); // Cleanup
  }, []); // Ch·ªâ mount l·∫ßn ƒë·∫ßu

  return <h1>Timer ch·∫°y ng·∫ßm (ki·ªÉm tra console)</h1>;
}



	## V√≠ d·ª• 2: Debounce Input V·ªõi Ref (N√¢ng cao cho search optimization):

import { useState, useRef, useEffect } from 'react';

function DebouncedSearch() {
  const [query, setQuery] = useState('');
  const timeoutRef = useRef(null);

  const handleChange = (e) => {
    const value = e.target.value;
    if (timeoutRef.current) clearTimeout(timeoutRef.current); // Clear timeout c≈©
    timeoutRef.current = setTimeout(() => {
      setQuery(value); // Ch·ªâ update sau 500ms
      console.log(`T√¨m ki·∫øm: ${value}`);
    }, 500);
  };

  useEffect(() => {
    return () => clearTimeout(timeoutRef.current); // Cleanup on unmount
  }, []);

  return (
    <>
      <input type="text" onChange={handleChange} placeholder="T√¨m ki·∫øm..." />
      <h2>K·∫øt qu·∫£: {query}</h2>
    </>
  );
}


# 5. Use Case N√¢ng Cao: Forward Refs V√† Custom Hooks


	## Forward Refs: Cho ph√©p parent component ref child DOM. 
import { forwardRef, useRef } from 'react';

const ChildInput = forwardRef((props, ref) => (
  <input ref={ref} type="text" {...props} />
));

function Parent() {
  const childRef = useRef(null);

  const focusChild = () => childRef.current.focus();

  return (
    <>
      <ChildInput ref={childRef} />
      <button onClick={focusChild}>Focus Child</button>
    </>
  );
}	
	
	Gi·∫£i th√≠ch: forwardRef expose ref ra ngo√†i, h·ªØu √≠ch cho reusable components.

	## Custom Hook V·ªõi useRef: T·∫°o useInterval ƒë·ªÉ encapsulate logic.

import { useRef, useEffect } from 'react';

function useInterval(callback, delay) {
  const savedCallback = useRef(callback); // L∆∞u callback ƒë·ªÉ tr√°nh stale

  useEffect(() => {
    savedCallback.current = callback; // Update callback m·ªõi nh·∫•t
  }, [callback]);

  useEffect(() => {
    const id = setInterval(() => savedCallback.current(), delay);
    return () => clearInterval(id);
  }, [delay]);
}

// S·ª≠ d·ª•ng:
function Counter() {
  useInterval(() => console.log('Tick'), 1000);
  return <h1>Interval custom hook</h1>;
}



# K·∫øt Lu·∫≠n V√† Best Practices (M·ª©c Chuy√™n Gia)

	- Khi d√πng useRef: Cho DOM refs, mutable non-UI data, previous states, instances c·∫ßn persist.
	- Tr√°nh: D√πng cho state c·∫ßn re-render; thay v√†o ƒë√≥ d√πng useState.
	- T√≠ch h·ª£p: Th∆∞·ªùng k·∫øt h·ª£p useEffect cho side effects.
	- Debug: S·ª≠ d·ª•ng React DevTools ƒë·ªÉ inspect refs.
	- Performance tip: Trong large apps, useRef gi·∫£m re-renders, nh∆∞ng theo d√µi memory usage.




https://www.w3schools.com/react/react_usereducer.asp







</pre><a id='backBottom' href='../react-learning-list.html' style='display:none;'>üîô Quay l·∫°i danh s√°ch</a><br><button onclick='toggleTheme()'>üåô Chuy·ªÉn giao di·ªán</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>