<html><head><title>Lesson 22 == React Suspense ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../react-learning-list.html'>üîô Quay l·∫°i danh s√°ch</a><br><h1>Lesson 22 -- React Suspense -//</h1><pre>
React Suspense l√† m·ªôt t√≠nh nƒÉng m·∫°nh m·∫Ω trong React (t·ª´ phi√™n b·∫£n 16.6), cho ph√©p ·ª©ng d·ª•ng "treo" (suspend) vi·ªác render m·ªôt ph·∫ßn UI trong khi ch·ªù d·ªØ li·ªáu ho·∫∑c code t·∫£i, ƒë·ªìng th·ªùi hi·ªÉn th·ªã fallback UI (nh∆∞ "Loading...") ƒë·ªÉ duy tr√¨ tr·∫£i nghi·ªám m∆∞·ª£t m√†. Kh√¥ng ch·ªâ l√† c√¥ng c·ª• loading, Suspense ƒë·∫°i di·ªán cho tri·∫øt l√Ω concurrent rendering c·ªßa React, n∆°i ·ª©ng d·ª•ng c√≥ th·ªÉ ∆∞u ti√™n c√°c nhi·ªám v·ª• quan tr·ªçng, tr√°nh blocking UI v√† n√¢ng cao hi·ªáu su·∫•t. N√≥ t√≠ch h·ª£p s√¢u v·ªõi lazy loading v√† data fetching, gi√∫p x√¢y d·ª±ng ·ª©ng d·ª•ng responsive, ƒë·∫∑c bi·ªát trong c√°c app l·ªõn v·ªõi network latency cao.

# 1. C√°ch Ho·∫°t ƒê·ªông N·ªôi B·ªô C·ªßa Suspense (Deeper Mechanics)
	Suspense ho·∫°t ƒë·ªông d·ª±a tr√™n c∆° ch·∫ø "suspending" ‚Äì khi m·ªôt component con "throw" m·ªôt Promise (thay v√¨ throw error th√¥ng th∆∞·ªùng), React s·∫Ω t·∫°m d·ª´ng render subtree ƒë√≥ v√† fallback ƒë·∫øn UI thay th·∫ø. ƒêi·ªÅu n√†y t·∫≠n d·ª•ng concurrent rendering: React c√≥ th·ªÉ ∆∞u ti√™n render c√°c ph·∫ßn kh√°c c·ªßa UI m√† kh√¥ng block to√†n b·ªô app. N·ªôi b·ªô, React s·ª≠ d·ª•ng fiber architecture ƒë·ªÉ schedule tasks, n∆°i suspended trees ƒë∆∞·ª£c "hidden" v√† ch·ªâ reveal khi Promise resolve.

	## Props C·ªßa <suspense></suspense> 
		
		- children: Ph·∫ßn UI ch√≠nh c·∫ßn render. N·∫øu children suspend, Suspense s·∫Ω k√≠ch ho·∫°t fallback.
		- fallback: UI thay th·∫ø (c√≥ th·ªÉ l√† component, text, ho·∫∑c b·∫•t k·ª≥ JSX valid). N·∫øu fallback c≈©ng suspend, n√≥ s·∫Ω propagate l√™n Suspense cha g·∫ßn nh·∫•t.


	## Caveats Chuy√™n Gia: 
		State kh√¥ng ƒë∆∞·ª£c preserve n·∫øu component suspend tr∆∞·ªõc khi mount l·∫ßn ƒë·∫ßu ‚Äì React s·∫Ω retry render t·ª´ scratch khi data s·∫µn, tr√°nh stale data nh∆∞ng c√≥ th·ªÉ d·∫´n ƒë·∫øn redundant computations n·∫øu kh√¥ng optimize.

		Khi content suspend sau khi ƒë√£ reveal, fallback s·∫Ω hi·ªÉn th·ªã l·∫°i tr·ª´ khi update ƒë∆∞·ª£c mark l√† non-urgent qua startTransition ho·∫∑c useDeferredValue (React 18+), gi√∫p gi·ªØ responsiveness.
		
		React cleanup layout effects khi hide suspended content v√† refire ch√∫ng khi reveal, ƒë·∫£m b·∫£o DOM measurements ch√≠nh x√°c (v√≠ d·ª•: t√≠nh height c·ªßa element sau load)



# 2. T√≠ch H·ª£p V·ªõi Lazy Loading (Code Splitting) 
	
	Suspense th∆∞·ªùng k·∫øt h·ª£p v·ªõi React.lazy() ƒë·ªÉ t·∫£i ƒë·ªông code, gi·∫£m initial bundle size (th∆∞·ªùng 20-50% ·ªü app l·ªõn), ƒë·∫∑c bi·ªát h·ªØu √≠ch cho routes √≠t d√πng. W3Schools nh·∫•n m·∫°nh fallback hi·ªÉn th·ªã ngay c·∫£ v·ªõi loading nhanh

	## V√≠ D·ª• C∆° B·∫£n (T·ª´ W3Schools): Lazy load m·ªôt component ƒë∆°n gi·∫£n 
		
import { createRoot } from 'react-dom/client';
import { Suspense, lazy } from 'react';

const Cars = lazy(() => import('./Cars')); // ./Cars l√† file ri√™ng, t·∫£i ƒë·ªông

function App() {
  return (
    <div>
      <Suspense fallback={<div>Loading...</div>}>
        <Cars />
      </Suspense>
    </div>
  );
}

createRoot(document.getElementById('root')).render(<App />);

	Ph√¢n T√≠ch: Khi import('./Cars') throw Promise (ƒëang t·∫£i code), Suspense fallback. Trong th·ª±c t·∫ø, tr√™n m·∫°ng ch·∫≠m (3G), fallback visible r√µ r·ªát. Chuy√™n gia khuy√™n d√πng webpack ho·∫∑c Vite cho code splitting ƒë·ªÉ bundle nh·ªè h∆°n.




	## V√≠ D·ª• N√¢ng Cao: Multiple Lazy Components: M·ªôt Suspense bao qu√°t nhi·ªÅu child, reveal c√πng l√∫c ƒë·ªÉ tr√°nh flicker.

import { createRoot } from 'react-dom/client';
import { Suspense, lazy } from 'react';

const Header = lazy(() => import('./Header'));
const Content = lazy(() => import('./Content'));
const Sidebar = lazy(() => import('./Sidebar'));

function App() {
  return (
    <div>
      <Suspense fallback={<div>Loading all sections...</div>}>
        <Header />
        <div style={{ display: 'flex' }}>
          <Sidebar />
          <Content />
        </div>
      </Suspense>
    </div>
  );
}

createRoot(document.getElementById('root')).render(<App />);


	Ph√¢n T√≠ch S√¢u: ƒêi·ªÅu n√†y th√∫c ƒë·∫©y "grouping" ƒë·ªÉ reveal ƒë·ªìng b·ªô, nh∆∞ng n·∫øu m·ªôt child ch·∫≠m, to√†n b·ªô delay. Gi·∫£i ph√°p: Nesting Suspense (xem ph·∫ßn 4) ƒë·ªÉ fallback granular.



# 3. T√≠ch H·ª£p V·ªõi Data Fetching (Render-As-You-Fetch) 

	Suspense chuy·ªÉn ƒë·ªïi data fetching t·ª´ imperative (useEffect + loading state) sang declarative: Component suspend n·∫øu data ch∆∞a s·∫µn. T·ª´ React 18+, d√πng use hook ƒë·ªÉ read Promise tr·ª±c ti·∫øp, tr√°nh waterfall fetching (sequential waits
	
	## V√≠ D·ª• C∆° B·∫£n V·ªõi Fetch: Suspend khi fetch data 
		
import { Suspense } from 'react';

function Albums({ artistId }) {
  const dataPromise = fetch(`https://api.example.com/artists/${artistId}/albums`)
    .then(res => res.json());
  const albums = use(dataPromise); // use throw Promise n·∫øu pending
  return <ul>{albums.map(album => <li key={album.id}>{album.title}</li>)}</ul>;
}

function ArtistPage({ artist }) {
  return (
    <>
      <h1>{artist.name}</h1>
      <Suspense fallback={<h2>üåÄ Loading albums...</h2>}>
        <Albums artistId={artist.id} />
      </Suspense>
    </>
  );
}
	
	Ph√¢n T√≠ch: use read Promise, suspend component n·∫øu pending. L√Ω t∆∞·ªüng cho SSR: Fetch ·ªü Server Component, pass Promise sang Client ƒë·ªÉ suspend client-side. Tr√°nh t·∫°o Promise m·ªõi m·ªói render b·∫±ng c√°ch wrap ·ªü parent.
	

	
	## V√≠ D·ª• V·ªõi Server/Client Components (Next.js Style): Streaming data 
	
// Server Component
import { fetchMessage } from './lib.js';
import { Message } from './Message.js'; // Client Component

export default function App() {
  const messagePromise = fetchMessage(); // Fetch tr√™n server
  return (
    <Suspense fallback={<p>Waiting for message...</p>}>
      <Message messagePromise={messagePromise} />
    </Suspense>
  );
}

// Message.js (Client Component)
'use client';
import { use } from 'react';

export function Message({ messagePromise }) {
  const messageContent = use(messagePromise); // Suspend n·∫øu pending
  return <p>Here is the message: {messageContent}</p>;
}	
	
	Ph√¢n T√≠ch S√¢u: ƒêi·ªÅu n√†y cho ph√©p streaming SSR ‚Äì server g·ª≠i HTML partial v·ªõi fallback, client hydrate d·∫ßn. Chuy√™n gia: Gi·∫£m TTFB (Time to First Byte) 30-50% ·ªü app data-heavy, nh∆∞ng y√™u c·∫ßu serializable data (no functions).
	
	
	
	## 	V√≠ D·ª• V·ªõi Th∆∞ Vi·ªán (React Query): S·ª≠ d·ª•ng suspense-enabled queries. 
	
	import { Suspense } from 'react';
import { useSuspenseQuery } from '@tanstack/react-query';

function Todos() {
  const { data } = useSuspenseQuery({ queryKey: ['todos'], queryFn: fetchTodos });
  return <ul>{data.map(todo => <li key={todo.id}>{todo.title}</li>)}</ul>;
}

function App() {
  return (
    <Suspense fallback={<div>Loading todos...</div>}>
      <Todos />
    </Suspense>
  );
}
		
		Ph√¢n T√≠ch: Th∆∞ vi·ªán nh∆∞ React Query ho·∫∑c SWR wrap fetch th√†nh Promise suspensible, t·ª± ƒë·ªông cache v√† refetch. Deeper: Tr√°nh over-fetching b·∫±ng stale-while-revalidate.




# 4. Nested Suspense V√† Revealing Sequentially

	ƒê·ªÉ fallback c·ª• th·ªÉ, nest Suspense: Outer cho critical content nhanh, inner cho slow

	## V√≠ D·ª• Nested 
		
import { Suspense } from 'react';

export default function ArtistPage({ artist }) {
  return (
    <>
      <h1>{artist.name}</h1>
      <Suspense fallback={<BigSpinner />}>
        <Biography artistId={artist.id} /> {/* Load nhanh, reveal s·ªõm */}
        <Suspense fallback={<AlbumsGlimmer />}> {/* Placeholder cho albums */}
          <Albums artistId={artist.id} /> {/* Load ch·∫≠m */}
        </Suspense>
      </Suspense>
    </>
  );
}

function BigSpinner() { return <h2>üåÄ Loading...</h2>; }
function AlbumsGlimmer() { return <div>Albums placeholder...</div>; }


	Ph√¢n T√≠ch: Biography reveal tr∆∞·ªõc, albums fallback ri√™ng. Chuy√™n gia: S·ª≠ d·ª•ng cho progressive loading, c·∫£i thi·ªán perceived performance (ng∆∞·ªùi d√πng th·∫•y ti·∫øn tri·ªÉn).



# 5. Error Handling V·ªõi Suspense

	Suspense kh√¥ng handle error tr·ª±c ti·∫øp; d√πng ErrorBoundary cho rejected Promises.

	## V√≠ D·ª• V·ªõi ErrorBoundary: 
	
import { Suspense, use } from 'react';
import { ErrorBoundary } from 'react-error-boundary';

function MessageContainer({ messagePromise }) {
  return (
    <ErrorBoundary fallback={<p>‚ö†Ô∏è Something went wrong</p>}>
      <Suspense fallback={<p>‚åõ Downloading...</p>}>
        <Message messagePromise={messagePromise} />
      </Suspense>
    </ErrorBoundary>
  );
}

function Message({ messagePromise }) {
  const content = use(messagePromise); // Reject s·∫Ω throw l√™n ErrorBoundary
  return <p>Here is the message: {content}</p>;
}
	
	
	Ph√¢n T√≠ch: ErrorBoundary catch error t·ª´ rejected Promise. Alternative: S·ª≠ d·ª•ng .catch() tr√™n Promise ƒë·ªÉ fallback value. Trong SSR, Suspense handle server errors b·∫±ng retry client-side
	
	
	
	## V√≠ D·ª• Client-Only Component: Tr√°nh render server-side 
	
<Suspense fallback={<Loading />}>
  <Chat />
</Suspense>

function Chat() {
  if (typeof window === 'undefined') {
    throw Error('Chat only on client.');
  }
  // Client logic...
}	
	
	Ph√¢n T√≠ch: Server render fallback, client replace. L√Ω t∆∞·ªüng cho features nh∆∞ WebSockets.
	
	



#6. Best Practices V√† Kh√°i Ni·ªám Li√™n Quan (Expert Insights)


	## Best Practices: 
	
		- Nesting: S·ª≠ d·ª•ng multi-level ƒë·ªÉ fallback chi ti·∫øt, tr√°nh single fallback l·ªõn g√¢y UX k√©m.
		- Transitions: K·∫øt h·ª£p startTransition cho non-blocking updates: startTransition(() => setState(newValue)) ‚Äì suspended updates kh√¥ng show fallback ngay, gi·ªØ UI responsive.
		- SSR V√† Streaming: Trong Next.js, Suspense enable selective hydration ‚Äì hydrate parts d·∫ßn, gi·∫£m JavaScript t·∫£i ban ƒë·∫ßu.
		- Performance: Test tr√™n slow networks; s·ª≠ d·ª•ng preload (e.g., link rel="preload") cho resources. Tr√°nh overuse Suspense cho sync operations.
		- Accessibility: Fallback n√™n c√≥ ARIA (e.g., role="progressbar"), th√¥ng b√°o screen readers.

	## Related Concepts: 
	
		- Concurrent Mode: Suspense l√† ph·∫ßn c·ªßa n√≥, cho ph√©p interruptible rendering.
		- useDeferredValue: Defer low-priority values ƒë·ªÉ tr√°nh suspend frequent.
		- Limitations: Hi·ªán t·∫°i, data fetching native ch∆∞a ·ªïn ƒë·ªãnh; ph·ª• thu·ªôc frameworks. T∆∞∆°ng lai: Full Suspense cho t·∫•t c·∫£ async ops.		


	T·ªïng th·ªÉ, Suspense ƒë·ªãnh h√¨nh React h∆∞·ªõng t·ªõi app resilient v·ªõi uncertainties (network, code load), gi·∫£m boilerplate code 30-40% so v·ªõi manual handling. Trong app enterprise, n√≥ enable micro-frontends v√† better scalability, nh∆∞ng ƒë√≤i h·ªèi hi·ªÉu s√¢u v·ªÅ concurrency ƒë·ªÉ tr√°nh pitfalls nh∆∞ infinite suspend loops.









https://www.w3schools.com/react/react_css_styling.asp






 
</pre><a id='backBottom' href='../react-learning-list.html' style='display:none;'>üîô Quay l·∫°i danh s√°ch</a><br><button onclick='toggleTheme()'>üåô Chuy·ªÉn giao di·ªán</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>