<html><head><title>Lesson 22 == React Suspense ==========//</title><style>body { font-family: Arial, sans-serif; transition: background 0.3s, color 0.3s; }.dark-mode { background-color: #121212; color: #e0e0e0; }.light-mode { background-color: #ffffff; color: #333333; }h1 { text-align: center; color: #73d9f5; }pre { padding: 15px; border-radius: 5px;       white-space: pre-wrap; word-wrap: break-word;       overflow-x: auto; max-width: 100%;       transition: background 0.3s, color 0.3s; }.dark-mode pre { background: #1e1e1e; color: #e0e0e0; }.light-mode pre { background: #f5f5f5; color: #333333; }#backTop, #backBottom {    font-size: 2em; padding: 20px 40px;    background: #bb86fc; color: white; text-decoration: none;    border-radius: 10px; display: inline-block; text-align: center; }#backTop:hover, #backBottom:hover { background: #9b67e2; }button { font-size: 1.5em; padding: 15px 30px;    background: #03dac6; color: #121212; border: none;    cursor: pointer; border-radius: 5px; display: block; margin: 10px auto; }button:hover { background: #02b8a3; }.dark-mode a { color: #03dac6; } .light-mode a { color: #007bff; }</style></head><body onload='applyTheme(); checkPageHeight()'><div class='container'><a id='backTop' href='../react-learning-list.html'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><h1>Lesson 22 -- React Suspense -//</h1><pre>
React Suspense lÃ  má»™t tÃ­nh nÄƒng máº¡nh máº½ trong React (tá»« phiÃªn báº£n 16.6), cho phÃ©p á»©ng dá»¥ng "treo" (suspend) viá»‡c render má»™t pháº§n UI trong khi chá» dá»¯ liá»‡u hoáº·c code táº£i, Ä‘á»“ng thá»i hiá»ƒn thá»‹ fallback UI (nhÆ° "Loading...") Ä‘á»ƒ duy trÃ¬ tráº£i nghiá»‡m mÆ°á»£t mÃ . KhÃ´ng chá»‰ lÃ  cÃ´ng cá»¥ loading, Suspense Ä‘áº¡i diá»‡n cho triáº¿t lÃ½ concurrent rendering cá»§a React, nÆ¡i á»©ng dá»¥ng cÃ³ thá»ƒ Æ°u tiÃªn cÃ¡c nhiá»‡m vá»¥ quan trá»ng, trÃ¡nh blocking UI vÃ  nÃ¢ng cao hiá»‡u suáº¥t. NÃ³ tÃ­ch há»£p sÃ¢u vá»›i lazy loading vÃ  data fetching, giÃºp xÃ¢y dá»±ng á»©ng dá»¥ng responsive, Ä‘áº·c biá»‡t trong cÃ¡c app lá»›n vá»›i network latency cao.

# 1. CÃ¡ch Hoáº¡t Äá»™ng Ná»™i Bá»™ Cá»§a Suspense (Deeper Mechanics)
	Suspense hoáº¡t Ä‘á»™ng dá»±a trÃªn cÆ¡ cháº¿ "suspending" â€“ khi má»™t component con "throw" má»™t Promise (thay vÃ¬ throw error thÃ´ng thÆ°á»ng), React sáº½ táº¡m dá»«ng render subtree Ä‘Ã³ vÃ  fallback Ä‘áº¿n UI thay tháº¿. Äiá»u nÃ y táº­n dá»¥ng concurrent rendering: React cÃ³ thá»ƒ Æ°u tiÃªn render cÃ¡c pháº§n khÃ¡c cá»§a UI mÃ  khÃ´ng block toÃ n bá»™ app. Ná»™i bá»™, React sá»­ dá»¥ng fiber architecture Ä‘á»ƒ schedule tasks, nÆ¡i suspended trees Ä‘Æ°á»£c "hidden" vÃ  chá»‰ reveal khi Promise resolve.

	## Props Cá»§a <suspense></suspense> 
		
		- children: Pháº§n UI chÃ­nh cáº§n render. Náº¿u children suspend, Suspense sáº½ kÃ­ch hoáº¡t fallback.
		- fallback: UI thay tháº¿ (cÃ³ thá»ƒ lÃ  component, text, hoáº·c báº¥t ká»³ JSX valid). Náº¿u fallback cÅ©ng suspend, nÃ³ sáº½ propagate lÃªn Suspense cha gáº§n nháº¥t.


	## Caveats ChuyÃªn Gia: 
		State khÃ´ng Ä‘Æ°á»£c preserve náº¿u component suspend trÆ°á»›c khi mount láº§n Ä‘áº§u â€“ React sáº½ retry render tá»« scratch khi data sáºµn, trÃ¡nh stale data nhÆ°ng cÃ³ thá»ƒ dáº«n Ä‘áº¿n redundant computations náº¿u khÃ´ng optimize.

		Khi content suspend sau khi Ä‘Ã£ reveal, fallback sáº½ hiá»ƒn thá»‹ láº¡i trá»« khi update Ä‘Æ°á»£c mark lÃ  non-urgent qua startTransition hoáº·c useDeferredValue (React 18+), giÃºp giá»¯ responsiveness.
		
		React cleanup layout effects khi hide suspended content vÃ  refire chÃºng khi reveal, Ä‘áº£m báº£o DOM measurements chÃ­nh xÃ¡c (vÃ­ dá»¥: tÃ­nh height cá»§a element sau load)



# 2. TÃ­ch Há»£p Vá»›i Lazy Loading (Code Splitting) 
	
	Suspense thÆ°á»ng káº¿t há»£p vá»›i React.lazy() Ä‘á»ƒ táº£i Ä‘á»™ng code, giáº£m initial bundle size (thÆ°á»ng 20-50% á»Ÿ app lá»›n), Ä‘áº·c biá»‡t há»¯u Ã­ch cho routes Ã­t dÃ¹ng. W3Schools nháº¥n máº¡nh fallback hiá»ƒn thá»‹ ngay cáº£ vá»›i loading nhanh

	## VÃ­ Dá»¥ CÆ¡ Báº£n (Tá»« W3Schools): Lazy load má»™t component Ä‘Æ¡n giáº£n 
		
import { createRoot } from 'react-dom/client';
import { Suspense, lazy } from 'react';

const Cars = lazy(() => import('./Cars')); // ./Cars lÃ  file riÃªng, táº£i Ä‘á»™ng

function App() {
  return (
    <div>
      <Suspense fallback={<div>Loading...</div>}>
        <Cars />
      </Suspense>
    </div>
  );
}

createRoot(document.getElementById('root')).render(<App />);

	PhÃ¢n TÃ­ch: Khi import('./Cars') throw Promise (Ä‘ang táº£i code), Suspense fallback. Trong thá»±c táº¿, trÃªn máº¡ng cháº­m (3G), fallback visible rÃµ rá»‡t. ChuyÃªn gia khuyÃªn dÃ¹ng webpack hoáº·c Vite cho code splitting Ä‘á»ƒ bundle nhá» hÆ¡n.




	## VÃ­ Dá»¥ NÃ¢ng Cao: Multiple Lazy Components: Má»™t Suspense bao quÃ¡t nhiá»u child, reveal cÃ¹ng lÃºc Ä‘á»ƒ trÃ¡nh flicker.

import { createRoot } from 'react-dom/client';
import { Suspense, lazy } from 'react';

const Header = lazy(() => import('./Header'));
const Content = lazy(() => import('./Content'));
const Sidebar = lazy(() => import('./Sidebar'));

function App() {
  return (
    <div>
      <Suspense fallback={<div>Loading all sections...</div>}>
        <Header />
        <div style={{ display: 'flex' }}>
          <Sidebar />
          <Content />
        </div>
      </Suspense>
    </div>
  );
}

createRoot(document.getElementById('root')).render(<App />);


	PhÃ¢n TÃ­ch SÃ¢u: Äiá»u nÃ y thÃºc Ä‘áº©y "grouping" Ä‘á»ƒ reveal Ä‘á»“ng bá»™, nhÆ°ng náº¿u má»™t child cháº­m, toÃ n bá»™ delay. Giáº£i phÃ¡p: Nesting Suspense (xem pháº§n 4) Ä‘á»ƒ fallback granular.



# 3. TÃ­ch Há»£p Vá»›i Data Fetching (Render-As-You-Fetch) 

	Suspense chuyá»ƒn Ä‘á»•i data fetching tá»« imperative (useEffect + loading state) sang declarative: Component suspend náº¿u data chÆ°a sáºµn. Tá»« React 18+, dÃ¹ng use hook Ä‘á»ƒ read Promise trá»±c tiáº¿p, trÃ¡nh waterfall fetching (sequential waits
	
	## VÃ­ Dá»¥ CÆ¡ Báº£n Vá»›i Fetch: Suspend khi fetch data 
		
import { Suspense } from 'react';

function Albums({ artistId }) {
  const dataPromise = fetch(`https://api.example.com/artists/${artistId}/albums`)
    .then(res => res.json());
  const albums = use(dataPromise); // use throw Promise náº¿u pending
  return <ul>{albums.map(album => <li key={album.id}>{album.title}</li>)}</ul>;
}

function ArtistPage({ artist }) {
  return (
    <>
      <h1>{artist.name}</h1>
      <Suspense fallback={<h2>ğŸŒ€ Loading albums...</h2>}>
        <Albums artistId={artist.id} />
      </Suspense>
    </>
  );
}
	
	PhÃ¢n TÃ­ch: use read Promise, suspend component náº¿u pending. LÃ½ tÆ°á»Ÿng cho SSR: Fetch á»Ÿ Server Component, pass Promise sang Client Ä‘á»ƒ suspend client-side. TrÃ¡nh táº¡o Promise má»›i má»—i render báº±ng cÃ¡ch wrap á»Ÿ parent.
	

	
	## VÃ­ Dá»¥ Vá»›i Server/Client Components (Next.js Style): Streaming data 
	
// Server Component
import { fetchMessage } from './lib.js';
import { Message } from './Message.js'; // Client Component

export default function App() {
  const messagePromise = fetchMessage(); // Fetch trÃªn server
  return (
    <Suspense fallback={<p>Waiting for message...</p>}>
      <Message messagePromise={messagePromise} />
    </Suspense>
  );
}

// Message.js (Client Component)
'use client';
import { use } from 'react';

export function Message({ messagePromise }) {
  const messageContent = use(messagePromise); // Suspend náº¿u pending
  return <p>Here is the message: {messageContent}</p>;
}	
	
	PhÃ¢n TÃ­ch SÃ¢u: Äiá»u nÃ y cho phÃ©p streaming SSR â€“ server gá»­i HTML partial vá»›i fallback, client hydrate dáº§n. ChuyÃªn gia: Giáº£m TTFB (Time to First Byte) 30-50% á»Ÿ app data-heavy, nhÆ°ng yÃªu cáº§u serializable data (no functions).
	
	
	
	## 	VÃ­ Dá»¥ Vá»›i ThÆ° Viá»‡n (React Query): Sá»­ dá»¥ng suspense-enabled queries. 
	
	import { Suspense } from 'react';
import { useSuspenseQuery } from '@tanstack/react-query';

function Todos() {
  const { data } = useSuspenseQuery({ queryKey: ['todos'], queryFn: fetchTodos });
  return <ul>{data.map(todo => <li key={todo.id}>{todo.title}</li>)}</ul>;
}

function App() {
  return (
    <Suspense fallback={<div>Loading todos...</div>}>
      <Todos />
    </Suspense>
  );
}
		
		PhÃ¢n TÃ­ch: ThÆ° viá»‡n nhÆ° React Query hoáº·c SWR wrap fetch thÃ nh Promise suspensible, tá»± Ä‘á»™ng cache vÃ  refetch. Deeper: TrÃ¡nh over-fetching báº±ng stale-while-revalidate.




# 4. Nested Suspense VÃ  Revealing Sequentially

	Äá»ƒ fallback cá»¥ thá»ƒ, nest Suspense: Outer cho critical content nhanh, inner cho slow

	## VÃ­ Dá»¥ Nested 
		
import { Suspense } from 'react';

export default function ArtistPage({ artist }) {
  return (
    <>
      <h1>{artist.name}</h1>
      <Suspense fallback={<BigSpinner />}>
        <Biography artistId={artist.id} /> {/* Load nhanh, reveal sá»›m */}
        <Suspense fallback={<AlbumsGlimmer />}> {/* Placeholder cho albums */}
          <Albums artistId={artist.id} /> {/* Load cháº­m */}
        </Suspense>
      </Suspense>
    </>
  );
}

function BigSpinner() { return <h2>ğŸŒ€ Loading...</h2>; }
function AlbumsGlimmer() { return <div>Albums placeholder...</div>; }


	PhÃ¢n TÃ­ch: Biography reveal trÆ°á»›c, albums fallback riÃªng. ChuyÃªn gia: Sá»­ dá»¥ng cho progressive loading, cáº£i thiá»‡n perceived performance (ngÆ°á»i dÃ¹ng tháº¥y tiáº¿n triá»ƒn).



# 5. Error Handling Vá»›i Suspense

	Suspense khÃ´ng handle error trá»±c tiáº¿p; dÃ¹ng ErrorBoundary cho rejected Promises.

	## VÃ­ Dá»¥ Vá»›i ErrorBoundary: 
	
import { Suspense, use } from 'react';
import { ErrorBoundary } from 'react-error-boundary';

function MessageContainer({ messagePromise }) {
  return (
    <ErrorBoundary fallback={<p>âš ï¸ Something went wrong</p>}>
      <Suspense fallback={<p>âŒ› Downloading...</p>}>
        <Message messagePromise={messagePromise} />
      </Suspense>
    </ErrorBoundary>
  );
}

function Message({ messagePromise }) {
  const content = use(messagePromise); // Reject sáº½ throw lÃªn ErrorBoundary
  return <p>Here is the message: {content}</p>;
}
	
	
	PhÃ¢n TÃ­ch: ErrorBoundary catch error tá»« rejected Promise. Alternative: Sá»­ dá»¥ng .catch() trÃªn Promise Ä‘á»ƒ fallback value. Trong SSR, Suspense handle server errors báº±ng retry client-side
	
	
	
	## VÃ­ Dá»¥ Client-Only Component: TrÃ¡nh render server-side 
	
<Suspense fallback={<Loading />}>
  <Chat />
</Suspense>

function Chat() {
  if (typeof window === 'undefined') {
    throw Error('Chat only on client.');
  }
  // Client logic...
}	
	
	PhÃ¢n TÃ­ch: Server render fallback, client replace. LÃ½ tÆ°á»Ÿng cho features nhÆ° WebSockets.
	
	



#6. Best Practices VÃ  KhÃ¡i Niá»‡m LiÃªn Quan (Expert Insights)


	## Best Practices: 
	
		- Nesting: Sá»­ dá»¥ng multi-level Ä‘á»ƒ fallback chi tiáº¿t, trÃ¡nh single fallback lá»›n gÃ¢y UX kÃ©m.
		- Transitions: Káº¿t há»£p startTransition cho non-blocking updates: startTransition(() => setState(newValue)) â€“ suspended updates khÃ´ng show fallback ngay, giá»¯ UI responsive.
		- SSR VÃ  Streaming: Trong Next.js, Suspense enable selective hydration â€“ hydrate parts dáº§n, giáº£m JavaScript táº£i ban Ä‘áº§u.
		- Performance: Test trÃªn slow networks; sá»­ dá»¥ng preload (e.g., link rel="preload") cho resources. TrÃ¡nh overuse Suspense cho sync operations.
		- Accessibility: Fallback nÃªn cÃ³ ARIA (e.g., role="progressbar"), thÃ´ng bÃ¡o screen readers.

	## Related Concepts: 
	
		- Concurrent Mode: Suspense lÃ  pháº§n cá»§a nÃ³, cho phÃ©p interruptible rendering.
		- useDeferredValue: Defer low-priority values Ä‘á»ƒ trÃ¡nh suspend frequent.
		- Limitations: Hiá»‡n táº¡i, data fetching native chÆ°a á»•n Ä‘á»‹nh; phá»¥ thuá»™c frameworks. TÆ°Æ¡ng lai: Full Suspense cho táº¥t cáº£ async ops.		


	Tá»•ng thá»ƒ, Suspense Ä‘á»‹nh hÃ¬nh React hÆ°á»›ng tá»›i app resilient vá»›i uncertainties (network, code load), giáº£m boilerplate code 30-40% so vá»›i manual handling. Trong app enterprise, nÃ³ enable micro-frontends vÃ  better scalability, nhÆ°ng Ä‘Ã²i há»i hiá»ƒu sÃ¢u vá» concurrency Ä‘á»ƒ trÃ¡nh pitfalls nhÆ° infinite suspend loops.









https://www.w3schools.com/react/react_css_styling.asp






 
</pre><a id='backBottom' href='../react-learning-list.html' style='display:none;'>ğŸ”™ Quay láº¡i danh sÃ¡ch</a><br><button onclick='toggleTheme()'>ğŸŒ™ Chuyá»ƒn giao diá»‡n</button></div><script>function toggleTheme() {   let mode = document.body.classList.contains('dark-mode') ? 'light-mode' : 'dark-mode';   document.body.className = mode; localStorage.setItem('theme', mode);   syncTheme();}function applyTheme() {   let savedTheme = localStorage.getItem('theme') || 'dark-mode';   document.body.className = savedTheme;   syncTheme();}function syncTheme() {   let preElement = document.querySelector('pre');   if (document.body.classList.contains('dark-mode')) { preElement.style.background = '#1e1e1e'; preElement.style.color = '#e0e0e0'; }   else { preElement.style.background = '#f5f5f5'; preElement.style.color = '#333333'; }}function checkPageHeight() {   let contentHeight = document.body.scrollHeight;   let windowHeight = window.innerHeight;   if (contentHeight > windowHeight * 1.2) {       document.getElementById('backBottom').style.display = 'block';   } else {       document.getElementById('backBottom').style.display = 'none';   }}</script></body></html>